<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
		<link rel="stylesheet" type="text/css" href="__STATIC__/product/css/common.css"/>
		<link rel="stylesheet" type="text/css" href="__STATIC__/product/css/sweetalert2.css"/>
		<script src="__STATIC__/product/js/jquery-3.3.1.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="__STATIC__/product/js/vue.min.js"></script>
		<script src="__STATIC__/product/js/common.js"></script>
		<script src="__STATIC__/product/lodop/LodopFuncs.js"></script>
		<script src="__STATIC__/product/js/print.js"></script>
		<script src="__STATIC__/product/js/printAll.js"></script>
		<script src="__STATIC__/product/js/sweet-alert/sweetalert.min.js"></script>
	</head>
	<body onselectstart="return false">
	<div id="main" v-cloak @click="closePop();isDo()">
		<div class="bgfff H120 head flexbox1 F24">
			<div class="flexbox2">
				<img src="__STATIC__/product/img/headIcon.png" class="headIcon"/>&nbsp;
				<span>City b2b</span>
			</div>
			<div class="flexbox2" v-if="is_product_permission!=2">
<!--				<img src="__STATIC__/product/img/printZCentre.png" class="systemIcon"/>&nbsp;-->
				</a><img src="__STATIC__/product/img/productCentre.png" class="systemIcon1" @click="gotoProductCentre()"/>
			</div>
		    <div class="relative hand" @click.stop="chose(1)">
				<span class="blink1">{{list.length>0?choseDate1.date+' '+choseDate1.date_day:''}}</span>
				<div class="choseCustomerBox datePop" v-show="whichPopShow==1">
					<div class="mb10 F18" v-for="(item ,index) in list" :class="currentDay==index?'colFD6921':''" @click.stop="choseDay(item,index)">{{item.date}} {{item.date_day}}</div>
				</div>
			</div>
			<div class="flexbox2 relative hand" @click.stop="chose(2)">
				{{choseDate2?choseDate2:list2[0].name}}
				<img src="__STATIC__/product/img/updown.png" class="updown"/>
				<div class="choseCustomerBox" v-show="whichPopShow==2">
					<div class="mb10 F18" v-for="(item,index) in list2" :class="current2==index?'colFD6921':''" @click.stop="choseCus(item,index)">{{item.name}}</div>
				</div>
			</div>
			<div class="flexbox2 relative hand" @click.stop="chose(3)">
				{{choseDate3?choseDate3:list3[0].name}}
				<img src="__STATIC__/product/img/updown.png" class="updown"/>
				<div class="choseCustomerBox" v-show="whichPopShow==3">
					<div class="mb10 F18" v-for="(item,index) in list3" :class="current3==index?'colFD6921':''" @click.stop="choseDriver(item,index)">
						<span v-if="index == 0">{{item.name}}</span>
						<span v-else>{{item.name}} {{item.name}}-{{item.truck_name}}-{{item.plate_number}}</span>
					</div>
				</div>
			</div>

			<div class="btn bgFD6921">{{driverOrderDoneNum}}/{{driverOrderNum}}</div>
			<div class="btn bg34C079">{{orderDoneNum}}/{{orderNum}}</div>
			<div>
				<img v-if=!fullscreen src="__STATIC__/product/img/fullscreen.png" class="systemIcon2" @click="handleFullScreen"/>
				<img v-else src="__STATIC__/product/img/normalscreen.png" class="systemIcon2" @click="handleFullScreen"/>
			</div>
		</div>

		<div class="flexbox3" style="min-height:100%;">
			<div class="left bgfff">
				<div class="colfff F18 jbBG flexbox2 goodsMenu hand" @click="returnPage(4)" v-show="currentPage==1">
					<img src="__STATIC__/product/img/goodsIcon.png" class="goodsIcon"/>
					Order Pick
					<img src="__STATIC__/product/img/arrow.png" class="arrIcon"/>
				</div>
				<div class="colfff F18 jbBG flexbox2 goodsMenu hand" @click="returnPage(2)" v-show="currentPage==1">
					<img src="__STATIC__/product/img/goodsIcon.png" class="goodsIcon"/>
					Item Sum
					<img src="__STATIC__/product/img/arrow.png" class="arrIcon"/>
				</div>
				<div class="colfff F18 jbBG flexbox2 goodsMenu hand" @click="returnPage(3)" v-show="currentPage==1">
					<img src="__STATIC__/product/img/goodsIcon.png" class="goodsIcon"/>
					Orders Sum
					<img src="__STATIC__/product/img/arrow.png" class="arrIcon"/>
				</div>
				<div class="colfff F18 jbBG flexbox2 goodsMenu hand" @click="returnPage(1)" v-show="currentPage==2||currentPage==3">
					<img src="__STATIC__/product/img/return.png" class="returnIcon"/>
					Return
				</div>
				<div class="F18 bgF1F1F1 lbtn hand" v-show="currentPage==1" @click="clickHandle">
					<span class="colFD6921" v-if="isHandle==0">Processing</span>
					<span class="col34C079" v-else-if="isHandle==1">Processed</span>
					<span class="col000" v-else>Code</span>
					<img src="__STATIC__/product/img/updown.png" class="updown"/>
				</div>
				<div v-show="currentPage==2" class="leftMenu2 J_left_menu_2">
					<div v-for="(item,index) in menudata" :class="['J_pick_cate_'+item.id,{'bgFD6921 colfff':currentMenu==index,'bgF1F1F1 col000':currentMenu!=index}]" class="F18 lbtn relative hand" @click="goto(item,index,'.J_pick_cate_'+item['id'],4)">
						{{item.category_en_name}}
						<img src="__STATIC__/product/img/menusj.png" class="menusj" v-show="currentMenu==index"/>
					</div>
				</div>
				<div v-show="currentPage==3" class="leftMenu2">
					<div :class="[{'bgFFF7F3 col5e5656':item.status==0,'bgFFF7F3 col5e5656':item.status==0,'bgFD6921':item.status==1,'bgGrey':item.status==2,'bg34C079 colfff':item.status==3}]" class="F18 lbtn2 relative" v-for="(item,index) in menudata2" @click="goto(item,index,'.J_right_cate_'+item.logistic_truck_No,5);">
						<div :class="item.status==1||item.status==2?'blink':''">
							<div v-if="item.logistic_truck_No!=0">{{item.truck_name}}-{{item.plate_number}}</div>
							<div>{{item.name}}</div>
							<!--						<div>Dep:{{item.schedule_time}}</div>-->
							<!--						<div>{{item.remain_time}}</div>-->
							<img v-if="item.status==1&&item.status==2" src="__STATIC__/product/img/suo.png" class="suo"/>
							<img src="__STATIC__/product/img/menusj.png" class="menusj" v-show="currentPage3LeftIndex==index"/>
						</div>
					</div>
				</div>

				<div v-show="currentPage==1" class="hand leftMenu J_left_menu_1">
					<div :class="[{'arrow_box':menudata2SortIndex==index,'bgFFF7F3 col5e5656':item.status==0,'bgFD6921':item.status==1,'bgGrey':item.status==2,'bg34C079 colfff':item.status==3}]" class="F18 lbtn2 relative" v-for="(item,index) in menudata2Sort" @click="clickOneCate(item,index);" @dblclick="gtouchstart(item,index,1);">
						<div class="maT5" :class="item.status==1||item.status==2?'blink':''">
							<div>{{item.category_en_name}}</div>
							<img v-if="item.status==1&&item.status==2" src="__STATIC__/product/img/suo.png" class="suo"/>
							<img src="__STATIC__/product/img/menusj.png" class="menusj" v-show="menudata2SortIndex==index"/>
						</div>
					</div>
				</div>
			</div>
			<div class="right pa10">
				<div v-show="currentPage==1">
					<div>
						<!-- 头部 -->
						<div class="flexbox1 pabt10 F18">
							<div class="bigclassify" v-if="menudata2Sort.length>0&&menudata2Sort[menudata2SortIndex].two_cate.length>0">
<!--								<div class="flexbox1 xxBox bgFD6921 colfff" @click.stop="twoCateTab(0)">-->
<!--									SEQ No<img src="__STATIC__/product/img/xxx.png" class="xxx"/>-->
<!--								</div>-->
								<div class="classify" :class="{'bgFD6921 colfff':twoCateTitleIndex==-1}" @click.stop="twoCateTitle('',-1)">All</div>
								<div class="classify" :class="{'bgFD6921 colfff':twoCateTitleIndex==index}" v-for="(item,index) in menudata2Sort[menudata2SortIndex].two_cate" @click.stop="twoCateTitle(item,index)">{{item.category_en_name}}</div>
							</div>
						</div>
						<div class="flexbox2 mb10 rsection2Box F18 J_product_cate" ref="element">
							<div :class="{'arrow_box':menudataTwoCateIndex==index,'bgFFF7F3 col5e5656':item.status==0,'bgOrange':item.status==1,'bgGreen':item.status==3,'bgGrey':item.status==2}" class="colfff rbtn7 relative mb10" v-for="(item,index) in menudataTwoCate"  @click="clickTwoCate(item,index);"  @dblclick="gtouchstart(item,index,2)">
								<div :class="item.status==1||item.status==2?'blink':''">
									<div style="text-align:left;"><span class="num">{{item.box_number}}bxs</span>{{item.finish_quantities}}/{{item.sum_quantities}}{{item.unit_en}}</div>
									<div :class="item.menu_en_name.length>12?'F13 maT5':'F18'">{{item.menu_en_name}}</div>
									<div>{{item.menu_id}}</div>
									<img v-if="item.status==1||item.status==2" src="__STATIC__/product/img/suo.png" class="suo"/>
									<img src="__STATIC__/product/img/menusj.png" class="menusjbottom" v-show="menudataTwoCateIndex==index"/>
								</div>
							</div>
						</div>
						<div class="flexbox2 rsection1 F20 J_product_cate" ref="element" v-if="menudataTwoCate.length>0&&menudataTwoCate[menudataTwoCateIndex].two_cate.length>0">
							<div :class="{'arrow_box':menudataThreeIndex==index,'bgFFF7F3 col5e5656':item.status==0,'bgOrange':item.status==1,'bgGreen':item.status==3,'bgGrey':item.status==2}" class="colfff rbtn relative mb10"  v-for="(item,index) in menudataTwoCate[menudataTwoCateIndex].two_cate"  @click="clickThreeCate(item,index);"  @dblclick="gtouchstart(item,index,3)">
								<div :class="item.status==1||item.status==2?'blink':''">
									<div>{{item.guige_name}}</div>
									<div><span class="num">{{item.box_number}}bxs</span> {{item.finish_quantities}}/{{item.sum_quantities}}{{item.unit_en}}</div>
									<img v-if="item.status==1||item.status==2" src="__STATIC__/product/img/suo.png" class="suo"/>
									<img src="__STATIC__/product/img/menusj.png" class="menusjbottom" v-show="menudataThreeIndex==index"/>
								</div>
							</div>
						</div>
						<!-- 下面开始 -->
						<div class="rsection3 bgfff F18 J_main_order" style="display: flex;flex-direction: column;" :style="mainOrderHeight">
							<!-- 头部 -->
							<div class="flexbox1 pa10">
								<div class="flexbox2">
									<div class="flexbox1 xxBox" :class="{'bgFD6921 colfff':wccSort==0}" @click.stop="tab(0)">
										SEQ No<img src="__STATIC__/product/img/xxx.png" class="xxx"/>
									</div>
									<div class="flexbox1 xxBox" :class="{'bgFD6921 colfff':wccSort==1}" @click.stop="tab(1)">
										Processing<img src="__STATIC__/product/img/xxx.png" class="xxx"/>
									</div>
									<div class="flexbox1 xxBox" :class="{'bgFD6921 colfff':wccSort==2}" @click.stop="tab(2)">
										Processed<img src="__STATIC__/product/img/xxx.png" class="xxx"/>
									</div>
								</div>
								<div class="flexbox2 relative hand rightBox">
									<div class="flexbox1 xxBox colfff" :class="is_print_all==1?'bgGrey':'bgFD6921'" @click.stop="is_print_all==2&&fitPrintAll()">
										fit print all
									</div>
									<div class="flexbox1 xxBox bgFD6921 colfff" @click.stop="changeAllStatus()">
										all picked
									</div>
									<div class="flexbox1 xxBox">
										<input class="inputBox J_fit_print" type="radio"  name="printType" value=2 v-model="print_type">
										fit print
									</div>
									<div class="flexbox1 xxBox">
										<input class="inputBox J_one_check" type="radio"  name="printType" value=0 v-model="print_type">
										one label
									</div>
									<div class="flexbox1 xxBox">
										<input class="inputBox J_blank_lable" type="radio"  name="printType" value=4 v-model="print_type">
										blank label
									</div>
									<span @click="popKeyboard">
										<span v-if="userName">i am {{userName}}</span>&nbsp;&nbsp;
										<img src="__STATIC__/product/img/suo2.png" class="suo2"/>
									</span>
									<span class="colFD6921" v-if="isShowLoginOut" @click="LogOut" style="margin-left:25px;">&nbspLogout</span>
								</div>
							</div>
							<!-- 主体部分 -->
							<div class="mainBox1 J_main_box F18" style="flex: auto;">
								<div class="remarkBox pa5 mb10 blink" style="width: 60%;" v-if="orderRemarkMessage"><div class="pa0-26">{{orderRemarkMessage}}</div></div>
								<div class="flexbox5 mb10 orderItem J_order_detail" v-for="(item,index) in handleListSort">
									<div class="log" @click="log(item,index)">
										<img src="__STATIC__/product/img/log.png">
									</div>
									<div class="orderDetail orderItemBox">
										<div class="flexbox1 pa5 orderItemBox" :class="index%2==0?'bgFFF7F3':'bgF0FBFB'">
											<div class="flexbox2">
												<div class="col666 F20" style="width: 80px;">{{item.logistic_sequence_No}}</div>
												<div class="col666 menuWidth">{{item.nickname}}</div>
											</div>
											<div class="flexbox2">
												<div class="outStock" :class="item.is_lock!=1||item.lock_type!=1||item.new_customer_buying_quantity==0||item.dispatching_is_producing_done==1||(item.proucing_item==1&&item.assign_stock==0)?'bgGrey':'bgFA8752'" @click="editQuantity(item,index,'outstock')">out stock</div>
												<div class="numicon" :class="item.is_lock!=1||item.lock_type!=1||item.new_customer_buying_quantity==0||item.dispatching_is_producing_done==1||(item.proucing_item==1&&item.assign_stock==0)?'bgGrey':'bgFA8752'" @click="editQuantity(item,index,'-')"><span class="numiconSub"></span></div>
												<div class="inputW F18 J_edit_quantity" :class="{'col666':item.is_lock!=1||item.lock_type!=1||item.dispatching_is_producing_done==1||(item.proucing_item==1&&item.assign_stock==0)}" @click="showKeyBoxQuantity(item,index)">{{item.new_customer_buying_quantity}}</div><span class="col666 w32">{{item.unit_en}}</span>&nbsp;&nbsp;
												<div class="numicon" :class="item.is_lock!=1||item.lock_type!=1||item.new_customer_buying_quantity==0||item.dispatching_is_producing_done==1||(item.proucing_item==1&&item.assign_stock==0)?'bgGrey':'bgFA8752'" @click="editQuantity(item,index,'+')">+</div>
											</div>
										</div>
										<div class="remarkBox orderDetail pa5-10 maT10 blink" style="width: auto;" v-if="item.message"><div class="pa0-26">{{item.message}}</div></div>
									</div>
									<div class="flexbox1 pa5 F18 orderItemBox" :class="index%2==0?'bgFFF7F3':'bgF0FBFB'">
										<div class="flexbox2">
											<div class="inputW4 F18 J_edit_lable_start" :class="{'col666':item.is_lock!=1||item.lock_type!=1}" @click="showKeyBoxQuantity(item,index,2)">{{item.current_box_sort_id}}</div>
											<span class="pa5-10">of</span>
											<div class="inputW4 F18 J_edit_lable" :class="{'col666':item.is_lock!=1||item.lock_type!=1}" @click="showKeyBoxQuantity(item,index,3)">{{item.boxesNumber}}</div>
										</div>
										<div class="echo echoMl" :class="orderItemOtherData[index].printBg" @click="print(item,index,$event)"></div>
									</div>
									<template v-if="item.proucing_item==1&&item.assign_stock==0">
										<div class="rbtn3 F18 bg34C079 colfff relative" v-if="item.dispatching_is_producing_done==1" @click="changeStatus(item,index)">
											processed
										</div>
										<div class="rbtn3 F18 bgGrey colfff relative" v-else-if="item.dispatching_is_producing_done==5" @click="changeStatus(item,index)">
											waiting approval
										</div>
										<div class="rbtn3 F18 bgGrey colfff relative" v-else @click="changeStatus(item,index)">
											<template v-if="item.is_producing_done==0">waitting process</template>
											<template v-else>processing</template>
										</div>
									</template>
									<template v-else>
										<template v-if="item.dispatching_is_producing_done==1">
											<div class="rbtn3 F18 bg34C079 colfff relative" v-if="item.dispatching_is_producing_done==1" @click="handle(index)">
												picked
												<div class="choseCustomerBox" style="width:160px;left:-3%;padding:10px 0;" v-show="currentHandlePop==index">
													<div class="actionHeight colFD6921" style="border-bottom: 1px solid #D0D0D0" @click.stop="changeStatus(item,index)">ReProcess</div>
													<div class="actionHeight col000" @click.stop="Popreturn">Return</div>
												</div>
											</div>
										</template>
										<template v-else>
											<div v-if="item.is_lock==0" class="rbtn3 F22 bgFFF7F3 col5e5656" @click="changeStatus(item,index)">
												waitting lock
											</div>
											<div v-else class="rbtn3 F22 colfff" :class="{'bgFD6921':item.lock_type==1,'bgGrey':item.lock_type==2}" @click="changeStatus(item,index)">
												<span v-if="item.dispatching_is_producing_done==0">waitting pick</span>
												<span v-else class="blink">picking</span>
											</div>
										</template>
									</template>
								</div>
							</div>
						</div>
						<!-- 下面结束 -->
					</div>
				</div>
				<div v-show="currentPage==2" class="rightCateMenu J_right_menu_2">
					<div class="F18" v-for="(item,index) in goods" :class="['J_pick_cate_'+item.cate_id,{'maT30':index>0}]">
						<div class="F18 hand cater mb10 bgFD6921 colfff">{{item['category_en_name']}}</div>
						<div class="flexbox2">
							<div v-for="(item1,index1) in item['product']">
								<div class="lbtn4 relative" :class="{'bgFFF7F3 col5e5656':item1.status==0,'bgFFF7F3 col5e5656':item1.status==0,'bgFD6921':item1.status==1,'bgGrey':item1.status==2,'bg34C079 colfff':item1.status==3}" @dblclick="gtouchstartPs(item1,index1);" @click="item1.status==1&&changeStatusPs(item1,index1);item1.status==3&&item1.proucing_item!=1&&showReprocess(item,index,item1,index1)">
									<img v-if="item1.proucing_item==1" class="productImg" src="__STATIC__/product/img/product.png">
									<div :class="{'blink':item1.status==1||item1.status==2}">
										<div>{{item1.menu_en_name}}</div>
										<div class="fwb F22">{{item1.menu_id}}&nbsp;&nbsp;<span class="F22">{{item1.sum_quantities}}{{item1.unit_en}}</span></div>
										<div class="twoCateBox maT-5" v-if="item1.is_has_two_cate==1">
											<span class="F14" v-for="item2 in item1.two_cate">{{item2.guige_name}}:{{item2.customer_buying_quantity}}{{item1.unit_en}}</span>
										</div>
										<div class="userBox1 maT-5">
											<span class="F14" v-for="(item2,index2) in item1.operator_user">{{item2.user_name}}</span>
										</div>
										<img v-if="item1.status==1||item1.status==2" src="__STATIC__/product/img/suo.png" class="suo"/>
										<img v-if="item1.proucing_item!=1" src="__STATIC__/product/img/log.png" class="pslog" @click.stop="log(item1,index1,2)"/>
										<div class="choseCustomerBox" style="width:160px;left:50%;margin-left:-80px;padding:10px 0;" v-show="currentPage2OneCateIndex==index&&currentPage2TwoCateIndex==index1">
											<div class="actionHeight colFD6921" style="border-bottom: 1px solid #D0D0D0"  @click.stop="changeStatusPs(item1,index1)">ReProcess</div>
											<div class="actionHeight col000" @click.stop="Popreturn(index1,2)">Return</div>
										</div>
									</div>
								</div>
<!--								<div class="F22 col000 flexbox4 bgfff zdBox" style="margin-left: 6px;">-->
<!--									<img src="__STATIC__/product/img/log.png" class="pslogbottom"/>-->
<!--									log-->
<!--								</div>-->
							</div>
						</div>
					</div>
				</div>
				<div v-if="currentPage==3" class="rightCateMenu J_right_menu_3">
					<div v-for="(item,index) in allDriverOrder" :class="index>0?'maT30':''">
						<div class="F18 hand cate2 mb10 bgFD6921 colfff" :class="'J_right_cate_'+item.logistic_truck_No" @click="goto(item,index,'.J_page1_left_cate_'+item.logistic_truck_No,1)" v-if="item.logistic_truck_No!=0">{{item.truck_name}}&nbsp;&nbsp;{{item.plate_number}}&nbsp;&nbsp;{{item.name}}&nbsp;&nbsp;{{item.schedule_time}}&nbsp;&nbsp;{{item.remain_time}}</div>
						<div class="F18 hand cate2 mb10 bgFD6921 colfff" :class="'J_right_cate_'+item.logistic_truck_No" @click="goto(item,index,'.J_page1_left_cate_'+item.logistic_truck_No,1)" v-else>{{item.name}}</div>
						<div class="flexbox2">
							<div v-for="(item1,index1) in item.order" :class="{'arrow_box':currentPage3OneCateIndex==index&&currentPage3TwoCateIndex==index1,'bgFFF7F3 col5e5656':item1.status==0,'bgOrange':item1.status==1,'bgGreen':item1.status==3,'bgGrey':item1.status==2}" class="colfff rbtn6 relative mb10">
								<div :class="item1.status==1||item1.status==2?'blink':''" @click="goto(item,index,'.J_page1_left_cate_'+item.logistic_truck_No,1,item1)">
									<div style="text-align:left;"><span class="num">{{item1.logistic_sequence_No}}</span>{{item1.finish_quantities}}/{{item1.sum_quantities}}</div>
									<div :class="item1.name_length>12?'F13 maT5':'F18'">{{item1.nickname}}</div>
									<img v-if="item1.status==1||item1.status==2" src="__STATIC__/product/img/suo.png" class="suo"/>
									<img src="__STATIC__/product/img/menusj.png" class="menusjbottom" v-show="currentPage3OneCateIndex==index&&currentPage3TwoCateIndex==index1"/>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- 主体部分结束 -->

		<div class="mask" v-if="iskeyboardShow" @click="closeKeyboard">
			<div class="keyboardBox">
				<div class="tips" v-show="isPsdCorrect">{{message}}</div>
				<div v-if="isShowTypePincode1">
					<div class="keyboard input J_pincode" :class="{'keyboardBorder':focusDatype==10}" tabindex="0" :placeholder="placeholderPincode" @focus="focusData($event,10,1)">{{psd2}}</div>
				</div>
				<div v-if="isShowTypePincode2">
					<div class="keyboard input J_n_pincode" :class="{'keyboardBorder':focusDatype==20}" tabindex="0" :placeholder="placeholderNPincode" @focus="focusData($event,20,2)">{{npsd2}}</div>
					<div class="keyboard input J_nr_pincode" :class="{'keyboardBorder':focusDatype==30}" tabindex="0" :placeholder="placeholderNRPincode" @focus="focusData($event,30,2)">{{nrpsd2}}</div>
				</div>
				<div v-if="isShowTypePincode3">
					<div class="keyboard input J_o_pincode" :class="{'keyboardBorder':focusDatype==10}" tabindex="0" :placeholder="placeholderOPincode" @focus="focusData($event,10,3)">{{psd2}}</div>
					<div class="keyboard input J_n_pincode" :class="{'keyboardBorder':focusDatype==20}" tabindex="0" :placeholder="placeholderNPincode" @focus="focusData($event,20,3)">{{npsd2}}</div>
					<div class="keyboard input J_nr_pincode" :class="{'keyboardBorder':focusDatype==30}" tabindex="0" :placeholder="placeholderNRPincode" @focus="focusData($event,30,3)">{{nrpsd2}}</div>
				</div>
				<div>
					<div class="textRight w100 bgF7F7F7 save" :class="{'flexbox1':!isShowTypePincode2}">
						<span v-if="!isShowTypePincode2" @click.stop="editPincode">{{editText}}</span>
						<span @click.stop="save">login</span>
					</div>
					<div class="flexbox1 pa10" style="background: #F2F2F2;">
						<div class="textCenter number" v-for="number in numberList" @click.stop="clickNum(number)">{{number}}</div>
						<div class="textCenter number" @click.stop="deletePsd">
							<img src="__STATIC__/product/img/delete.png" class="delete">
						</div>
					</div>
				</div>
			</div>
		</div>
		<img v-if="isLoading" src="__STATIC__/product/img/loading.gif" class="loading"/>
		<!-- 公用弹出框 -->
		<div class="mask J_pop_message zi2" v-show="isShowMessage">
			<div class="popMessage">
				{{popMessage}}
			</div>
		</div>
		<!-- 日志记录-->
		<div class="mask" v-show="isShowLog">
			<div class="logContent F18">
				<div class="chaClose" @click="closeLog">×</div>
				<table>
					<thead>
					<tr>
						<th style="width: 180px;">Operation time</th>
						<th style="width: 100px;">Username</th>
						<th style="width: 80px;">Number</th>
						<th style="width: 80px;">Quantity</th>
						<th style="width: 300px;">Operate</th>
					</tr>
					</thead>
					<tbody>
					<tr v-for="item in logData">
						<td style="width: 180px;">{{item.created_at}}</td>
						<td style="width: 100px;">{{item.name}}</td>
						<td style="width: 80px;">{{item.userId}}</td>
						<td style="width: 80px;" v-if="item.behavior_type==5||item.behavior_type==6||item.behavior_type==7">{{item.new_customer_buying_quantity}}</td>
						<td style="width: 80px;" v-else>--</td>
						<td style="width: 300px;">{{item.behavior_type_desc}}</td>
					</tr>
					</tbody>
				</table>
			</div>
		</div>
		<!-- 输入数字键盘-->
		<div class="mask zi1" v-if="iskeyboardQuantityShow">
			<div class="keyboardBox1 flexbox1">
				<div class="keyboardBoxLeft pa10" style="padding-right: 6px;">
					<div class="keyboard1">{{showQuantity}}</div>
					<div class="flexbox1">
						<div class="textCenter number1" v-for="(number,index) in numberList1" @click.stop="clickNumber(number)">{{number}}</div>
					</div>
				</div>
				<div class="keyboardBoxRight">
					<div class="pa10" style="padding-left: 0;">
						<div class="textCenter number3" @click.stop="closeKeyBoardQuantity()"><img src="__STATIC__/product/img/cha1.png" class="delete"></div>
						<div class="textCenter number2" @click.stop="deleteNumber()"><img src="__STATIC__/product/img/delete.png" class="delete"></div>
						<div class="textCenter number2" @click.stop="clearNumber()"><img src="__STATIC__/product/img/C.png" class="delete"></div>
						<div class="textCenter enterNumber" @click.stop="editKeyBoardQuantity(handleItem,handleIndex,'enter')"><div class="enterNumberH"><p>Enter</p><img src="__STATIC__/product/img/enter.png" class="delete"></div></div>
					</div>
				</div>
				<!--				<div class="tips" v-show="isPsdCorrect">{{message}}</div>-->
				<!--				<div v-if="isShowTypePincode1">-->
				<!--					<div class="keyboard input J_pincode" :class="{'keyboardBorder':focusDatype==10}" tabindex="0" :placeholder="placeholderPincode" @focus="focusData($event,10,1)">{{psd2}}</div>-->
				<!--				</div>-->
			</div>
		</div>
	</div>
	</body>
	<script>
		let vm=new Vue({
			el:"#main",
			data: {
				onLine: false,//navigator.onLine,
				//内容区域高度 = 当前屏幕高度 - 头部高度 - 底部高度
				fullHeight: document.documentElement.clientHeight,//获取屏幕高度
				isLoading: false,
				isShowMessage: false,
				popMessage: '',//弹层提示信息
				currentHandlePop: -1,
				currentDay: 0,
				current2: 0,
				current3: 0,
				choseDate1: '',
				choseDate2: '',
				choseDate3: '',
				logistic_delivery_date: '',//筛选日期
				logistic_truck_No: '',//当前选择司机
				product_id: 0,//当前选择的产品id
				guige1_id: '',//当前选择的规格id
				list: [],
				list2: [{"id": "", "name": "All customers"}],
				list3: [{"logistic_truck_No": "", "name": "All Drivers&Truck", "truck_name": "", "plate_number": ""}],
				driverOrderDoneNum: 0,//对应司机已完成订单数
				driverOrderNum: 0,//对应司机全部订单数
				orderDoneNum: 0,//订单已完成数
				orderNum: 0,//订单总数
				num: 20,
				whichPopShow: -1,
				currentPage: localStorage.getItem('currentPage') != null ? localStorage.getItem('currentPage') : 1,  // 1表示1级页面 2是2级页面
				menudata: [{"id": -1, "category_en_name": "Current Stock"}],
				menudata2: [],//加工产品
				currentContent: 0,//未排序的数据，当前选中的产品索引id
				menudata2Sort: [],//排序后的加工产品，为保证初始化的数据不变
				menudata2SortIndex: 0,//默认获取的产品键值
				twoCateTitleIndex: -1,//二级类目索引值
				menudataTwoCate: [],//二级产品类目
				menudataTwoCateIndex: 0,//默认获取的二级产品类目键值
				menudataThreeIndex: 0,//默认产品对应的规格数据的键值
				handleList: [],
				handleListSort: [],//加工明细数据，为保证初始化的数据不变
				wccSort: 0,//加工明细排序类型
				wccSortType: 1,//排序方向 1正向 2反向
				currentMenu: 0,
				isHandle: 0,
				goods: [],
				numberList: [1, 2, 3, 4, 5, 6, 7, 8, 9, '.', 0],
				isPsdCorrect: false,
				iskeyboardShow: false,
				psd: '',
				psd2: '',
				npsd: '',
				npsd2: '',
				nrpsd: '',
				nrpsd2: '',
				placeholderPincode: '',
				placeholderNPincode: 'New pincode',
				placeholderNRPincode: 'Re-enter pincode',
				placeholderOPincode: 'Old pincode',
				focusDatype: '',//光标所在的位置，获取到光标所在位置，给哪个输入框输入内容
				pincodeType: '',//pincode登录内容 1-pincode登录 2-创建pincode并登录 3-修改pincode并登录
				message: '',//pincode登录错误信息
				isDisable: false, //控制按钮多次点击禁用
				isClock: false, //是否上锁，禁止点击
				timeLock: 0,//上锁时间
				deliveryTime: null,//获取配送时间定时器
				timer: null,//定时器
				userName: '',//登录用户信息
				businessName: '',//商家名
				intervalId: null,//定时器id，刷新数据使用
				intervalId23: null,//定时器id23，刷新数据使用
				lastTime: null, //最后一次点击的时间
				currentTime: null, //当前点击的时间
				timeOut: 10 * 60 * 1000,//设置超时时间： 10分钟
				isShowLoginOut: false,//是否显示退出登录按钮
				isShowTypePincode1: false,//显示pincode输入框样式-1.pincode登录是否显示
				isShowTypePincode2: false,//显示pincode输入框样式-创建pincode是否显示
				isShowTypePincode3: false,//显示pincode输入框样式-修改pincode是否显示
				editText: 'setting',//键盘文字显示
				timeOutEvent: null,//长按定时器，锁定加工产品
				timeOutLock: null,//获取锁定结果
				lockData: [],//锁定参数
				lockReturnData: null,//上锁参数
				mainOrderHeight: '',
				clickTimer: null,//定时器
				isHasCateData: false,//分类页，Back to this category,判断当前加工产品是否有该类产品
				currentInterTime: null,//获取锁定结果的开始时间
				interTimeOut: 1 * 60 * 1000,//设置锁定结果超时时间： 1分钟
				isShowLog: false,//是否显示日志信息
				logData: [],//日志数据
				allDriverOrder: [],//获取所有司机的订单数据
				currentPage3LeftIndex: 0,//Driver&Order页面左侧选中的数据
				currentPage3OneCateIndex: 0,//Driver&Order页面右侧导航的数据的索引值
				currentPage3TwoCateIndex: 0,//Driver&Order页面右侧选中的数据的索引值
				orderRemarkMessage: '',//订单备注信息
				numberList1: [1, 2, 3, 4, 5, 6, 7, 8, 9, '.', 0, '00'],
				iskeyboardQuantityShow: false,//是否显示数字键盘
				showQuantity: 0,//显示数量
				handleItem: [],//当前点击选中的订单明细
				handleIndex: 0,//当前点击选中的订单明细索引id,
				quantityType: 1,//显示数量类型 1-订单明细数量修改 2-订单明细打印数量修改(开始值) 3-订单明细打印数量修改(结束值)
				currentPage2OneCateIndex: -1,//Picking&Sum页面右侧导航的分类数据的索引值
				currentPage2TwoCateIndex: -1,//Picking&Sum页面右侧选中的产品数据的索引值
				one_cate_id: 0,//当前选中的一级类目id,0-全部
				two_cate_id: 0,//当前选中的二级类目id,0-全部
				is_product_permission: 2,//判断是否有生产权限 1-有 2-没有
				print_type: 2,//打印类型 0-one label 1-Fit print all 2-fit print 3-print order 4-blank label
				is_print_all:2,//是否全部打印 1-是 2-否
				orderItemOtherData:[],//订单明细的其他数据
				setup_info:'',//供应商设置信息
				fullscreen: false  // 是否全屏
			},
			mounted: function () {
				window.addEventListener('online',  this.updateOnlineStatus);
				window.addEventListener('offline', this.updateOnlineStatus);
				//获取pincode显示得到样式
				var _this = this
				_this.isLoading=true
				getData("{:url('/product/loginInfo')}", '', function (res) {
					_this.isLoading=false
					console.log(res);
					//获取登录信息
					if (res.result.user_name) {
						_this.userName = res.result.user_name
						_this.businessName = res.result.business_name
						_this.isShowLoginOut = true
					} else {
						//获取不到登录信息则弹出登录框
						_this.iskeyboardShow = true
						_this.isClock = true
					}
					if(res.result.is_has_pincode==1){
						_this.isShowTypePincode1 = true
						_this.pincodeType = 1 //默认显示pincode登录
						_this.focusDatype = 10 //默认可直接输入密码
					} else {
						_this.isShowTypePincode2 = true
						_this.pincodeType = 2 //默认显示创建pincode
					}
					_this.is_product_permission = res.result.is_product_permission
					_this.setup_info = res.result.setup_info
				});
				//获取配送日期
				_this.deliveryDateFun();
			},
			methods:{
				updateOnlineStatus(e) {
					const { type } = e;
					this.onLine = type === 'online';
					console.log('ssss---',this.onLine);
				},
				//获取配送日期
				deliveryDateFun(){
					var data = {
						'logistic_delivery_date':localStorage.logistic_delivery_date
					}
					var _this = this
					_this.isLoading=true
					getData("{:url('/product/pickDeliveryDate')}", data, function (res) {
						console.log(res);
						_this.list = res.result.list
						_this.choseDate1 = res.result.default
						_this.currentDay = res.result.default_k
						_this.logistic_delivery_date = _this.choseDate1.hasOwnProperty('logistic_delivery_date')?_this.choseDate1.logistic_delivery_date:''
						//获取初始化数据
						if(_this.logistic_delivery_date){
							// console.log('获取到日期了---');
							clearTimeout(_this.deliveryTime);
							_this.isLoading=false
							_this.inidata()
						} else {
							_this.isLoading=true
							if(res.result.is_has_data == 1){
								// console.log('轮询查数据进来了---');
								_this.deliveryTime = setTimeout(() => {
									// console.log('定时获取结果------');
									_this.deliveryDateFun();
								}, 5000);
							} else {
								_this.isLoading=false
							}
						}
					});
				},
				//获取初始化数据 type:refresh来源与数据刷新
				inidata(type='') {
					var _this = this
					if(!(_this.logistic_delivery_date>0)){
						return
					}
					var data = {
						"logistic_delivery_date":_this.logistic_delivery_date,
						"logistic_truck_No":_this.logistic_truck_No,
						"one_cate_sort":_this.isHandle,
						"type":type
					}
					console.log('初始化参数---',data)
					getData("{:url('/product/pickItemInidata')}", data, function (res) {
						console.log('初始化结果---',res)
						res = res.result
						_this.driverOrderDoneNum = res.driver_order_count.order_done_count
						_this.driverOrderNum = res.driver_order_count.order_count
						_this.orderDoneNum = res.all_order_count.order_done_count
						_this.orderNum = res.all_order_count.order_count
						if(type == 'refresh'){
							//更新数据时，保持原数据位置不变
							_this.menudata2=_this.sortAccordingOtherData(res.cate,_this.menudata2,'id')
							_this.menudata2Sort=_this.sortAccordingOtherData(res.cate,_this.menudata2Sort,'id')
							console.log('刷新后产品数据-----',_this.menudata2Sort);
						}else{
							_this.menudata2=_this.menudata2Sort=_this.menudataTwoCate=_this.handleList=_this.handleListSort=[]
							_this.menudataTwoCateIndex = 0
							_this.menudata2 = res.cate
							_this.menudata2Sort = res.cate
						}
						if(_this.menudata2.length > 0){
							//获取当前默认选中的一级类目id
							if(_this.one_cate_id==0){
								_this.one_cate_id=_this.menudata2[0].id
								_this.currentContent=0
								_this.menudata2SortIndex=0
							}else{
								for(var i in _this.menudata2){
									if(_this.menudata2[i]['id']==_this.one_cate_id){
										_this.currentContent=i
										_this.menudata2SortIndex=i
										break;
									}
								}
							}
							// alert(_this.menudata2Sort[_this.menudata2SortIndex].is_has_two_cate);
							if(_this.menudata2Sort[_this.menudata2SortIndex].is_has_two_cate == 1){
								//获取默认显示的二级类目
								_this.twoCate(type)
							}else{
								if(_this.currentPage == 1){
									//vue获取顶部位置方法
									_this.$nextTick(()=> {
										var order_top = $('.J_main_order').offset().top+'px'
										_this.mainOrderHeight = `height: calc(100vh - ${order_top});`
									})
								}
								_this.menudataTwoCate =_this.handleList=_this.handleListSort=[]
								_this.menudataTwoCateIndex = _this.menudataTwoCateSortIndex = 0
								//默认加载第一个产品的第一个规格的所有加工明细
								_this.productOrder(type)
							}
						}
					});
				},
				//获取二级类目 type=refresh:定时刷新数据
				//item1 当前选中的二级类目数据
				twoCate(type=''){
					var _this = this
					var data = {
						"logistic_delivery_date":_this.logistic_delivery_date,
						"logistic_truck_No":_this.logistic_truck_No,
						"one_cate_id":_this.one_cate_id,
						"two_cate_id":_this.two_cate_id,
					}
					console.log('获取二级类目参数----',data);
					getData("{:url('/product/changeCate')}", data, function (res) {
						res = res.result
						if(type == 'refresh'){
							//更新数据时，保持原数据位置不变
							_this.menudataTwoCate=_this.sortAccordingOtherData(res.product,_this.menudataTwoCate,'product_id')
						}else {
							_this.menudataTwoCate = _this.handleList = _this.handleListSort = []
							_this.menudataTwoCateIndex = _this.menudataThreeIndex = 0
							_this.menudataTwoCate = res.product
						}
						console.log('二级类目数据-----',_this.menudataTwoCate)
						if(_this.currentPage == 1) {
							//vue获取顶部位置和左侧位置的方法
							_this.$nextTick(() => {
								var order_top = $('.J_main_order').offset().top + 'px'
								_this.mainOrderHeight = `height: calc(100vh - ${order_top});`
							})
						}
						if(_this.menudataTwoCate.length > 0){
							//获取当前默认选中的产品id和规格id
							if(!(_this.product_id>0)){
								_this.product_id = _this.menudataTwoCate[0].product_id
							}
							if(_this.menudataTwoCate[_this.menudataTwoCateIndex]['two_cate'].length>0 && !(_this.guige1_id>0)){
								_this.guige1_id = _this.menudataTwoCate[_this.menudataTwoCateIndex]['two_cate'][0].guige1_id
							}
							//默认加载第一个产品的第一个规格的所有加工明细
							_this.productOrder(type)
						}
					});
				},
				//获取订单的加工明细单
				productOrder(type=''){
					var _this = this
					var data = {
						"logistic_delivery_date":_this.logistic_delivery_date,
						"logistic_truck_No":_this.logistic_truck_No,
						"product_id":_this.product_id,
						"guige1_id":_this.guige1_id,
						"wcc_sort":_this.wccSort,
						"wcc_sort_type":_this.wccSortType
					}
					console.log('获取产品加工明细单参数-----',data)
					getData("{:url('/product/productItemOrderDetailList')}", data, function (res) {
						_this.isLoading=false
						res = res.result
						_this.is_print_all = res.is_print_all
						if(type == 'refresh'){
							//更新数据时，保持原数据位置不变
							_this.handleList=_this.sortAccordingOtherData(res.order,_this.handleList,'id')
							_this.handleListSort=_this.sortAccordingOtherData(res.order,_this.handleListSort,'id')
						}else{
							_this.handleList = []
							_this.handleListSort = []
							_this.handleList = res.order
							_this.handleListSort = res.order
							_this.orderItemOtherData=_this.handleListSort
						}
						console.log('获取产品加工明细单2222-----',res)
					});
				},
				//cate 类目 1一级类目  2二级类目 3-三级分类
				//如果该产品只有一个规格，点击产品时，默认锁定第一个规格；如果规格数>1,则需要锁定规格
				gtouchstart(item,index,cate){
					return new Promise((resolve, reject) => {
						clearTimeout(this.clickTimer);  //首先清除计时器
						if (cate == 1) {
							if (this.menudata2SortIndex != index) {
								this.clickOneCate(item, index)
							}
							if (item.is_has_two_cate == 1) {
								//如果该类目只有一个产品，点击类目时，默认锁定第一个产品；
								if (this.menudataTwoCate.length == 1) {
									item = this.menudataTwoCate[0]
									index = 0
									cate = 2
								}
								if (item.status == 0 && this.menudataTwoCate.length > 1) {
									this.popBox('Please select a product to lock')
									return
								}
								if (item.status == 1 && this.menudataTwoCate.length > 1) {
									this.popBox('you are processing this product')
									return
								}
							}
						}
						if (cate == 2) {
							if (this.menudataTwoCateIndex != index) {
								this.clickTwoCate(item, index)
							}
							if (item.is_has_two_cate == 1) {
								//如果该类目只有一个产品，点击类目时，默认锁定第一个产品；
								if (this.menudataTwoCate[index]['two_cate'].length == 1) {
									item = this.menudataTwoCate[index]['two_cate'][0]
									index = 0
									cate = 3
								}
								if (item.status == 0 && this.menudataTwoCate[index]['two_cate'].length > 1) {
									this.popBox('Please select a product to lock')
									return
								}
								if (item.status == 1 && this.menudataTwoCate[index]['two_cate'].length > 1) {
									this.popBox('you are processing this product')
									return
								}
							}
						}
						if (cate == 3) {
							if (this.menudataThreeIndex != index) {
								this.clickThreeCate(item, index)
							}
						}
						if (item.status == 2) {
							this.popBox('This product has been locked by other')
							return
						}
						if (item.status == 3) {
							this.popBox('This product has been processed')
							return
						}
						//如果二级规格只有一个，点击产品时，默认锁定该规格
						var data = {
							"logistic_delivery_date": this.logistic_delivery_date,
							'logistic_truck_No': this.logistic_truck_No,
							'product_id': this.product_id,
							'guige1_id': this.guige1_id
						}
						console.log('获取锁定参数-----', data);
						var _this = this
						//产品的锁定状态,status -1-需要根据二级类目加工 0-未加工 1-自己正在加工 2-其他人正在加工 3-加工完成
						_this.isLoading = true
						if (item.status == 0) {
							getData("{:url('/product/lockProductItem')}", data, function (res) {
								console.log('获取锁定结果-----', res)
								if (res.status == 200) {
									//记录过期时间
									_this.currentInterTime = new Date().getTime();
									_this.timeOutLock = setInterval(() => {
										//判断上次最后一次点击的时间和这次点击的时间间隔是否大于1分钟
										if (new Date().getTime() - _this.currentInterTime > _this.interTimeOut) {
											clearTimeout(_this.timeOutLock);
											_this.isLoading = false
											_this.popBox('The server is busy, please try again later')
										}else {
											_this.lockRes(res.result, item, index, cate).then(function (value) {
												if (value.status != 119) {
													clearTimeout(_this.timeOutLock);
													if (value.status == 200) {
														resolve(1);
													} else {
														resolve(2);
													}
												} else {
													_this.isLoading = true
												}
											})
										}
									}, 100);
								} else {
									_this.isLoading = false
									_this.popBox(res.message)
									resolve(3);
									return
								}
							});
						}
						if (item.status == 1) {
							getData("{:url('/product/unlockProductItem')}", data, function (res) {
								console.log('获取解锁结果-----', res)
								_this.isLoading = false
								if (res.status == 200) {
									var is_has_product_guige = 0//判断该用户是否还有其他再加工三级类目 0-没有 1-有正在加工的其他产品
									var is_has_product = 0//判断该用户是否还有其他再加工的二级类目 0-没有 1-有正在加工的其他产品
									if (cate == 3) {
										_this.menudataTwoCate[_this.menudataTwoCateIndex]['two_cate'][index]['status'] = 0
										//判断该用户是否还有其他再加工的二级规格，若没有，则将一级产品状态还原
										is_has_product_guige = _this.isHasProduct(3)//0-没有 1-有正在加工的其他产品
										//如果三级对应的所有规格都没有被锁定的，直接修改二级类目的状态
										if (is_has_product_guige == 0) {
											_this.menudataTwoCate[_this.menudataTwoCateIndex]['status'] = 0
										}
									}
									if (cate == 2) {
										_this.menudataTwoCate[index]['status'] = 0
										//判断该用户是否还有其他再加工的二级规格，若没有，则将一级产品状态还原
										is_has_product = _this.isHasProduct(2)//0-没有 1-有正在加工的其他产品
									}
									if ((cate == 3 && is_has_product_guige == 0) || (cate == 2 && is_has_product == 0) || cate == 1) {
										_this.menudata2Sort[_this.menudata2SortIndex]['status'] = 0
										//修改原数ta2Sort[_this.menudata2SortIndex]['status'] = 0
										//修改原数组的值
										for (var i in _this.menudata2) {
											if (_this.menudata2[i]['id'] == _this.menudata2Sort[_this.menudata2SortIndex].id) {
												_this.menudata2[i]['status'] = 0
												break;
											}
										}
									}
									//修改对应的加工明细单为可处理
									var renew_id_arr = [];//判断是否需要更新handleList的值
									$.each(_this.handleListSort, function (i, n) {
										_this.handleList[i]['is_lock'] = 0
										_this.handleList[i]['lock_type'] = 0
										_this.handleListSort[i]['is_lock'] = 0
										_this.handleListSort[i]['lock_type'] = 0
										if (_this.handleListSort[i]['dispatching_is_producing_done'] == 2) {
											renew_id_arr.push(_this.handleListSort[i].id)
											_this.handleListSort[i]['dispatching_is_producing_done'] = 0
										}
									});
									if (renew_id_arr.length > 0) {
										for (var i in _this.handleList) {
											for (var j in renew_id_arr) {
												if (_this.handleList[i]['id'] == j) {
													_this.handleList[i]['dispatching_is_producing_done'] = 0
												}
											}
										}
									}
									//修改可编辑数量和标签数量为可编辑状态
									$('.J_edit_quantity').attr("disabled", "disabled")
									$('.J_edit_lable').attr("disabled", "disabled")
								} else {
									_this.popBox(res.message)
									return
								}
							});
						}
					})
				},
				//获取锁定结果
				lockRes(result,item,index,cate){
					return new Promise((resolve, reject) => {
						//获取锁定结果
						var data = {
							"uniqid": result.uniqid
						}
						var _this = this
						getData("{:url('/product/lockProductItemResult')}", data, function (res) {
							console.log('获取队列结果----', res);
							if (res.status == 119) {
								resolve(res);
							} else {
								clearTimeout(_this.timeOutLock);
								_this.isLoading = false
								//锁定成功--上锁
								if (res.status == 200) {
									//修改该产品的状态为锁定,status -1-需要根据二级类目加工 0-未加工 1-自己正在加工 2-其他人正在加工 3-加工完成
									//如果当前锁定的是三级分类
									if (cate == 3) {
										_this.menudataTwoCate[_this.menudataTwoCateIndex]['two_cate'][index]['status'] = 1
									}
									_this.menudataTwoCate[_this.menudataTwoCateIndex]['status'] = 1
									_this.menudata2Sort[_this.menudata2SortIndex]['status'] = 1
									//修改原数组的值
									for (var i in _this.menudata2) {
										if (_this.menudata2[i]['id'] == _this.menudata2Sort[_this.menudata2SortIndex].id) {
											_this.menudata2[i]['status'] = 1
											break;
										}
									}
									//修改对应的加工明细单为可处理
									$.each(_this.handleListSort, function (i, n) {
										_this.handleList[i]['is_lock'] = 1
										_this.handleList[i]['lock_type'] = 1
										_this.handleListSort[i]['is_lock'] = 1
										_this.handleListSort[i]['lock_type'] = 1
									});
									resolve(res);
								} else {
									_this.popBox(res.message)
									resolve(res);
									return
								}
							}
						})
 					})
				},
				// 定时刷新数据函数
				dataRefreh() {
					if(this.currentPage == 1){
						// 计时器正在进行中，退出函数
						if (this.intervalId != null) {
							return;
						}
						// 计时器为空，操作
						this.intervalId = setInterval(() => {
							console.log("刷新",new Date());
							this.currentTime = new Date().getTime();
							//更新数据
							if(this.logistic_delivery_date && this.currentPage == 1) {
								this.inidata('refresh')
							}
							//判断上次最后一次点击的时间和这次点击的时间间隔是否大于10分钟
							if(this.currentTime - this.lastTime > this.timeOut) {
								//超过操作时间，调用退出pincode接口，并弹出pincode登录框+上锁
								this.loginOutPincode()
							}
						}, 5000);
					}
				},
				// 定时刷新数据函数(currentPage==2||currentPage==3时)
				dataRefrehPage23() {
					if(this.currentPage == 2){
						// 计时器正在进行中，退出函数
						if (this.intervalId23 != null) {
							return;
						}
						// 计时器为空，操作
						this.intervalId23 = setInterval(() => {
							//picking&sum页面更新数据
							if(this.logistic_delivery_date && this.currentPage == 2) {
								this.returnPage(2)
							}
						}, 30000);
					}
				},
				loginOutPincode(){
					var _this = this
					getData("{:url('/product/loginOutPincode')}", '', function (res) {
						_this.iskeyboardShow = true
						_this.isClock = true
						_this.psd=_this.psd2=_this.npsd=_this.npsd2=_this.nrpsd=_this.nrpsd2=''
						_this.message=''
						_this.isPsdCorrect=false
						_this.isShowLog=false
						_this.clearTime()
						_this.isLoading=false
						_this.closeKeyBoardQuantity()
					});
				},
				// 停止定时器
				clear() {
					clearInterval(this.intervalId); //清除定时刷新数据计时器
					this.intervalId = null //设置为null
					clearInterval(this.intervalId23); //清除定时刷新数据计时器
					this.intervalId23 = null //设置为null
					clearInterval(this.timer);//清除锁屏倒计时计时器
					this.timer = null
					clearTimeout(this.timeOutLock);//清除锁定计时器
					this.timeOutLock = null
					clearTimeout(this.timeOutEvent);//清除弹窗提示定时器
					this.timeOutEvent=null
					clearTimeout(this.clickTimer);//判断点击事件计时器
					this.clickTimer=null
				},
				// 切换用户/上锁时需要清除的定时器
				clearTime() {
					clearInterval(this.timer);//清除锁屏倒计时计时器
					this.timer = null
					clearTimeout(this.timeOutLock);//清除锁定计时器
					this.timeOutLock = null
					clearTimeout(this.timeOutEvent);//清除弹窗提示定时器
					this.timeOutEvent=null
					clearTimeout(this.clickTimer);//判断点击事件计时器
					this.clickTimer=null
				},
				//判断用户10分钟内是否有操作，无操作则需要上锁，弹出pincode登录框
				isDo() {
					this.lastTime = new Date().getTime(); //如果在10分钟内点击，则把这次点击的时间记录覆盖掉之前存的最后一次点击的时间
					console.log('最后一次点击时间----',this.lastTime);
				},
				//修改处理状态 is_producing_done 0-未加工 1-加工完成 2-正在加工中
				changeStatus(item,index,dispatching_is_producing_done=-1){
					var data = {
						"id": item.id,
						"logistic_truck_No": this.logistic_truck_No
					}
					//是否存在产品规格 1-存在 2-不存在
					var is_has_three_cate = this.menudataTwoCate[this.menudataTwoCateIndex]['two_cate'].length>0?1:2;
					var three_cate_data = []
					if(is_has_three_cate==1) {
						three_cate_data = this.menudataTwoCate[this.menudataTwoCateIndex]['two_cate'][this.menudataThreeIndex]
					}
					if(dispatching_is_producing_done>-1){
						data.is_producing_done = dispatching_is_producing_done;
					}else {
						//如果该产品是加工未分配的，则没有权限操作
						if(item.proucing_item==1&&item.assign_stock==0){
							this.popBox('You cannot operate')
							return
						}
						if (item.dispatching_is_producing_done == 0) {
							if (item.is_lock != 1) {
								//如果未锁定，点击自动锁定
								if (is_has_three_cate == 1) {
									this.gtouchstart(three_cate_data, this.menudataThreeIndex, 3)
								} else {
									this.gtouchstart(this.menudataTwoCate[this.menudataTwoCateIndex], this.menudataTwoCateIndex, 2)
								}
								// this.popBox('Please lock the order')
								return
							}
							if (item.lock_type != 1) {
								this.popBox('This order has been locked by other')
								return
							}
							data.is_producing_done = 2;
						} else if (item.dispatching_is_producing_done == 2) {
							data.is_producing_done = 1;
						} else {
							data.is_producing_done = 0;
						}
					}
					console.log('处理状态参数----',data)
					var _this = this
					_this.isLoading=true
					getData("{:url('/product/pickChangeProductItemStatus')}", data, function (res) {
						console.log('处理状态结果----',res)
						_this.isLoading=false
						if (res.status == 200) {
							_this.handleListSort[index].dispatching_is_producing_done = data.is_producing_done
							//如果返回继续拣货，如果该订单或者该司机之前状态是已完成，需要修改锁定状态为当前用户锁定
							if(data.is_producing_done == 0) {
								// if((is_has_three_cate==1&&three_cate_data['status']==3)||_this.menudataTwoCate[_this.menudataTwoCateIndex]['status']==3||_this.menudata2Sort[_this.menudata2SortIndex]['status']==3) {
								for(var i in _this.handleListSort) {
									_this.handleListSort[i]['is_lock'] = 1
									_this.handleListSort[i]['lock_type'] = 1
								}
								// }
							}
							//修改原数组的值
							for(var i in _this.handleList) {
								if(_this.handleList[i]['id'] == _this.handleListSort[index].id){
									_this.handleList[i].dispatching_is_producing_done = data.is_producing_done
									_this.handleList[i].is_lock = _this.handleListSort[index]['is_lock']
									_this.handleList[i].lock_type = _this.handleListSort[index]['lock_type']
								}
							}
							_this.currentHandlePop=-1
							if(data.is_producing_done != 2) {
								//修改司机对应的订单数量
								_this.driverOrderDoneNum = _this.numAdd(_this.driverOrderDoneNum, res.result.driver_order_inc_num)
								//修改总订单数
								_this.orderDoneNum = _this.numAdd(_this.orderDoneNum, res.result.order_inc_num)
								//增加加工数量
								if (data.is_producing_done == 1) {
									_this.menudataTwoCate[_this.menudataTwoCateIndex]['finish_quantities'] = _this.numAdd(_this.menudataTwoCate[_this.menudataTwoCateIndex]['finish_quantities'], item.customer_buying_quantity)
									if(is_has_three_cate==1){
										_this.menudataTwoCate[_this.menudataTwoCateIndex]['two_cate'][_this.menudataThreeIndex]['finish_quantities'] = _this.numAdd(three_cate_data['finish_quantities'], item.customer_buying_quantity)
									}
								} else {
									_this.menudataTwoCate[_this.menudataTwoCateIndex]['finish_quantities'] = _this.numSub(_this.menudataTwoCate[_this.menudataTwoCateIndex]['finish_quantities'], item.customer_buying_quantity)
									if(is_has_three_cate==1){
										_this.menudataTwoCate[_this.menudataTwoCateIndex]['two_cate'][_this.menudataThreeIndex]['finish_quantities'] = _this.numSub(three_cate_data['finish_quantities'], item.customer_buying_quantity)
									}
								}
								//如果当前规格的所有加工明细都加工完，则需要将该规格状态变为绿色
								if (res.result.is_product_guige1_done == 1) {
									// console.log('规格已全部加工完成---',_this.menudataTwoCate,_this.menudataTwoCateIndex)
									_this.menudataTwoCate[_this.menudataTwoCateIndex]['two_cate'][_this.menudataThreeIndex]['status'] = 3
									//如果还有产品未加工完成，判断当前是否还有锁定，没有锁定，则将产品改为未锁定状态
									if (res.result.is_product_all_done != 1) {
										//判断该用户是否还有其他再加工的三级规格，若没有，则将二级产品状态还原
										var is_has_product_guige = _this.isHasProduct(3)//0-没有 1-有正在加工的其他产品
										if (is_has_product_guige == 0) {
											_this.menudataTwoCate[_this.menudataTwoCateIndex]['status'] = 0
											//判断该用户是否还有其他再加工的二级规格，若没有，则将一级产品状态还原
											var is_has_product = _this.isHasProduct(2)//0-没有 1-有正在加工的其他产品
											if (is_has_product == 0) {
												_this.menudata2Sort[_this.menudata2SortIndex]['status'] = 0
												//修改原数组的值
												for (var i in _this.menudata2) {
													if (_this.menudata2[i]['id'] == _this.menudata2Sort[_this.menudata2SortIndex].id) {
														_this.menudata2[i]['status'] = 0
														break;
													}
												}
											}
										}
									}
								}
								//如果当前产品的所有规格的加工明细都加工完，则需要将该产品状态变为绿色
								if (res.result.is_product_guige1_all_done == 1) {
									_this.menudataTwoCate[_this.menudataTwoCateIndex]['status'] = 3
								}
								//如果当前产品的所有规格的加工明细都加工完，则需要将该产品状态变为绿色
								if (res.result.is_cate_all_done == 1) {
									_this.menudata2Sort[_this.menudata2SortIndex]['status'] = 3
								}
								//修改原数组的值
								for (var i in _this.menudata2) {
									if (_this.menudata2[i]['id'] == _this.menudata2Sort[_this.menudata2SortIndex].id) {
										_this.menudata2[i]['status'] = _this.menudata2Sort[_this.menudata2SortIndex]['status']
										break;
									}
								}
								//如果产品规格状态为已处理完成，还原时将原状态还原
								if (data.is_producing_done == 0) {
									if(is_has_three_cate==1&&three_cate_data['status'] != 1) {
										_this.menudataTwoCate[_this.menudataTwoCateIndex]['two_cate'][_this.menudataThreeIndex]['status'] = 1
									}
									if (_this.menudataTwoCate[_this.menudataTwoCateIndex]['status'] != 1) {
										_this.menudataTwoCate[_this.menudataTwoCateIndex]['status'] = 1
									}
									//如果一级规格没被锁定时，同时锁定一级规格
									if (_this.menudata2Sort[_this.menudata2SortIndex]['status'] != 1) {
										_this.menudata2Sort[_this.menudata2SortIndex]['status'] = 1
										//修改原数组的值
										for (var i in _this.menudata2) {
											if (_this.menudata2[i]['id'] == _this.menudata2Sort[_this.menudata2SortIndex].id) {
												_this.menudata2[i]['status'] = 1
												break;
											}
										}
									}
								}
							}
						} else {
							_this.popBox(res.message)
							return
						}
					});
				},
				//修改处理状态 is_producing_done 0-未加工 1-加工完成 2-正在加工中
				changeAllStatus(){
					let last_menu_data
					if(this.guige1_id > 0){
						last_menu_data = this.menudataTwoCate[this.menudataTwoCateIndex]['two_cate'][this.menudataThreeIndex]
					}else{
						last_menu_data = this.menudataTwoCate[this.menudataTwoCateIndex]
					}
					let status = last_menu_data['status']
					//如果该产品是生产未分配库存的，不允许点击all picked
					if(last_menu_data['proucing_item'] == 1&&last_menu_data['assign_stock'] == 0){
						this.popBox('You cannot operate')
						return
					}
					if(status==0){
						this.popBox('Please lock the product')
						return
					}
					if(status==2){
						this.popBox('This product has been locked by other')
						return
					}
					if(status==3){
						this.popBox('This product is complete')
						return
					}
					var data = {
						"logistic_delivery_date": this.logistic_delivery_date,
						"logistic_truck_No": this.logistic_truck_No,
						"product_id":this.product_id,
						"guige1_id":this.guige1_id,
						"is_producing_done":1
					}
					console.log('处理状态参数----',data)
					var _this = this
					_this.isLoading=true
					getData("{:url('/product/pickAllChangeProductItemStatus')}", data, function (res) {
						console.log('处理状态结果----',res)
						_this.isLoading=false
						if (res.status == 200) {
							_this.currentHandlePop=-1
							//修改全部状态和原数组的值
							for(var i in _this.handleList) {
								_this.handleListSort[i].dispatching_is_producing_done = data.is_producing_done
								_this.handleList[i].dispatching_is_producing_done = data.is_producing_done
							}
							var is_has_three_cate = _this.menudataTwoCate[_this.menudataTwoCateIndex]['is_has_two_cate']
							if(data.is_producing_done != 2) {
								//修改司机对应的订单数量
								_this.driverOrderDoneNum = _this.numAdd(_this.driverOrderDoneNum, res.result.driver_order_inc_num)
								//修改总订单数
								_this.orderDoneNum = _this.numAdd(_this.orderDoneNum, res.result.order_inc_num)
								//增加加工数量
								var three_cate_data = _this.menudataTwoCate[_this.menudataTwoCateIndex]['two_cate'][_this.menudataThreeIndex]
								if (data.is_producing_done == 1) {
									_this.menudataTwoCate[_this.menudataTwoCateIndex]['finish_quantities'] = _this.numAdd(_this.menudataTwoCate[_this.menudataTwoCateIndex]['finish_quantities'], res.result.add_quantity)
									if(is_has_three_cate==1){
										_this.menudataTwoCate[_this.menudataTwoCateIndex]['two_cate'][_this.menudataThreeIndex]['finish_quantities'] = _this.numAdd(three_cate_data['finish_quantities'], res.result.add_quantity)
									}
								} else {
									_this.menudataTwoCate[_this.menudataTwoCateIndex]['finish_quantities'] = _this.numSub(_this.menudataTwoCate[_this.menudataTwoCateIndex]['finish_quantities'], res.result.add_quantity)
									if(is_has_three_cate==1){
										_this.menudataTwoCate[_this.menudataTwoCateIndex]['two_cate'][_this.menudataThreeIndex]['finish_quantities'] = _this.numSub(three_cate_data['finish_quantities'], res.result.add_quantity)
									}
								}
								//如果当前规格的所有加工明细都加工完，则需要将该规格状态变为绿色
								if (res.result.is_product_guige1_done == 1) {
									// console.log('规格已全部加工完成---',_this.menudataTwoCate,_this.menudataTwoCateIndex)
									_this.menudataTwoCate[_this.menudataTwoCateIndex]['two_cate'][_this.menudataThreeIndex]['status'] = 3
									//如果还有产品未加工完成，判断当前是否还有锁定，没有锁定，则将产品改为未锁定状态
									if (res.result.is_product_all_done != 1) {
										//判断该用户是否还有其他再加工的三级规格，若没有，则将二级产品状态还原
										var is_has_product_guige = _this.isHasProduct(3)//0-没有 1-有正在加工的其他产品
										if (is_has_product_guige == 0) {
											_this.menudataTwoCate[_this.menudataTwoCateIndex]['status'] = 0
											//判断该用户是否还有其他再加工的二级规格，若没有，则将一级产品状态还原
											var is_has_product = _this.isHasProduct(2)//0-没有 1-有正在加工的其他产品
												if (is_has_product == 0) {
												_this.menudata2Sort[_this.menudata2SortIndex]['status'] = 0
												//修改原数组的值
												for (var i in _this.menudata2) {
													if (_this.menudata2[i]['id'] == _this.menudata2Sort[_this.menudata2SortIndex].id) {
														_this.menudata2[i]['status'] = 0
														break;
													}
												}
											}
										}
									}
								}
								//如果当前产品的所有规格的加工明细都加工完，则需要将该产品状态变为绿色
								if (res.result.is_product_guige1_all_done == 1) {
									_this.menudataTwoCate[_this.menudataTwoCateIndex]['status'] = 3
								}
								//如果当前产品的所有规格的加工明细都加工完，则需要将该产品状态变为绿色
								if (res.result.is_cate_all_done == 1) {
									_this.menudata2Sort[_this.menudata2SortIndex]['status'] = 3
									//修改原数组的值
									for (var i in _this.menudata2) {
										if (_this.menudata2[i]['id'] == _this.menudata2Sort[_this.menudata2SortIndex].id) {
											_this.menudata2[i]['status'] = 3
											break;
										}
									}
								}
							}
						} else {
							_this.popBox(res.message)
							return
						}
					});
				},
				//判断当前是否还有其他锁定产品
				isHasProduct(cate=2){
					var is_has_product=0//0-没有 1-有正在加工的其他产品
					if(cate == 2){
						var data = this.menudataTwoCate
					}else{
						var data = this.menudataTwoCate[this.menudataTwoCateIndex].two_cate
					}
					for(var i in data){
						if(data[i]['status'] == 1){
							is_has_product=1
							break;
						}
					}
					return is_has_product
				},
				handle(index){  // 点击已处理
					this.currentHandlePop=index
				},
				//1.主页面的返回操作 2.picking&sum页面的返回操作
				Popreturn(index,type=1){
					this.lastTime = new Date().getTime();//记录最后一次点击时间
					if(type == 1){
						this.currentHandlePop=-1
					}else{
						this.currentPage2OneCateIndex = -1
						this.currentPage2TwoCateIndex = -1
					}
				},
				//切换一级类目
				clickOneCate(item,index){
					clearTimeout(this.clickTimer);  //首先清除计时器
					this.clickTimer = setTimeout(() => {
						this.isLoading=true
						if(item.id != this.one_cate_id){
							this.twoCateTitleIndex = -1
							this.two_cate_id = 0
							this.menudataTwoCateIndex = 0
							this.menudataThreeIndex = 0
							this.one_cate_id = item.id
							this.menudata2SortIndex=index
							this.product_id=this.guige1_id=''
							//通排序基本数据同步索引
							this.menudata2Sync(1)
							//重置加工明细排序信息-start
							this.wccSort=0
							this.wccSortType=1
							//重置加工明细排序信息-end
							//获取二级类目
							this.twoCate()
						}
					}, 300);   //大概时间300ms
				},
				//切换二级类目，获取对应的产品信息
				twoCateTitle(item,index){
					clearTimeout(this.clickTimer);  //首先清除计时器
					this.clickTimer = setTimeout(() => {
						this.isLoading=true
						if(this.twoCateTitleIndex!=index){
							this.two_cate_id=item.id
							//记录当前点击的分类键值
							this.twoCateTitleIndex=index
							this.product_id=0
							this.guige1_id=''
							//重置加工明细排序信息-start
							this.wccSort=0
							this.wccSortType=1
							//重置加工明细排序信息-end
							//获取二级分类对应的产品
							this.twoCate()
							this.isLoading=false
						}
					}, 300);   //大概时间300ms
				},
				//切换二级类目
				clickTwoCate(item,index){
					clearTimeout(this.clickTimer);  //首先清除计时器
					this.clickTimer = setTimeout(() => {
						this.isLoading=true
						//记录当前点击的产品键值
						if(item.product_id != this.product_id){
							if(item.two_cate.length>0){
								this.guige1_id = item.two_cate[0].guige1_id
							}else{
								this.guige1_id = ''
							}
						}
						this.menudataTwoCateIndex=index
						this.product_id = item.product_id
						this.menudataThreeIndex=0
						//重置加工明细排序信息-start
						this.wccSort=0
						this.wccSortType=1
						//重置加工明细排序信息-end
						//获取二级类目对应的订单
						this.productOrder()
						this.isLoading=false
					}, 300);   //大概时间300ms
				},
				//切换产品二级类目
				clickThreeCate(item,index){
					clearTimeout(this.clickTimer);  //首先清除计时器
					this.clickTimer = setTimeout(() => {
						this.isLoading=true
						//记录当前点击的产品键值
						if(item.guige1_id != this.guige1_id){
							this.menudataThreeIndex=index
							this.guige1_id = item.guige1_id
							//重置加工明细排序信息-start
							this.wccSort=0
							this.wccSortType=1
							//重置加工明细排序信息-end
							//获取二级类目对应的订单
							this.productOrder()
						}
						this.isLoading=false
					}, 300);   //大概时间300ms
				},
				tab(index){
					this.isLoading=true
					this.lastTime = new Date().getTime();//记录最后一次点击时间
					this.currentHandlePop=-1
					//将产品加工明细进行排序
					this.handleListSort=JSON.parse(JSON.stringify(this.handleList));
					if(this.wccSort != index){
						this.wccSortType = 1
					}else{
						if(this.wccSortType == 1){
							this.wccSortType = 2
						}else{
							this.wccSortType = 1
						}
					}
					this.wccSort=index
					switch(index){
						case 0:
							var sort_type = this.wccSortType
							this.sortData(this.handleListSort,'menu_id',sort_type);
							break;
						case 1:
							var sort_type = this.wccSortType
							this.sortData(this.handleListSort,'dispatching_is_producing_done',sort_type);
							break;
						case 2:
							var sort_type = this.wccSortType==1?2:1
							this.sortData(this.handleListSort,'dispatching_is_producing_done',sort_type);
							break;
					}
					this.isLoading=false
				},
				//对数据进行排序
				//data:需要排序的数组 sort_field:排序字段  sort_type:排序方式 1升序 2降序
				sortData(data,sort_field,sort_type,sort_field2=''){
					return data.sort(
						function(a, b) {
							var value1 = a[sort_field]
							var value2 = b[sort_field]
							// console.log(value1,value2)
							if($.type(value1) == 'number'){
								if(sort_field2){
									if(value1 == value2) return a[sort_field2]-b[sort_field2]
								}
								if (sort_type == 1) {
									return value1 - value2
								} else {
									return value2 - value1
								}
							} else {
								if (sort_type == 1) {
									if(value1 < value2) return -1;
									if(value1 > value2) return 1;
									return 0;
								} else {
									if(value1 < value2) return 1;
									if(value1 > value2) return -1;
									return 0;
								}
							}
						}
					);
				},
				//在另一个数组的基础上排序，保证新数组的排序与原数组保持一致
				sortAccordingOtherData(newData,oldData,sort_field){
					//存储排序字段
					var sortOldData = []
					for(var i in oldData){
						sortOldData.push(oldData[i][sort_field]);
					}
					newData.sort((a,b)=>{
						var value1 = a[sort_field]
						var value2 = b[sort_field]
						return sortOldData.indexOf(value1)-sortOldData.indexOf(value2);
					});
					return newData
				},
				//修改购买数量
				editQuantity(item,index,addType){
					//如果该产品是加工产品，则拣货员没有修改数量的权限
					// if(item.proucing_item==1){
					// 	this.popBox('You do not have permission to operate')
					// 	return
					// }
					//如果该产品是加工未分配的，则没有权限操作
					if(item.proucing_item==1&&item.assign_stock==0){
						this.popBox('You cannot operate')
						return
					}
					if(item.is_lock!=1){
						this.popBox('Please lock the order')
						return
					}
					if(item.lock_type!=1){
						this.popBox('This order has been locked by other')
						return
					}
					//如果该订单已加工完成，则没有权限操作
					if(item.dispatching_is_producing_done==1){
						this.popBox('Inoperable completed')
						return
					}
					// e.currentTarget.parentElement.children.item(1).focus()
					// console.log(index,this.handleListSort[index])
					var customer_buying_quantity = this.handleListSort[index].new_customer_buying_quantity
					if(addType == '+'){
						if(this.numAdd(customer_buying_quantity,0.1)<0){
							return
						}
						this.handleListSort[index].new_customer_buying_quantity=this.numAdd(customer_buying_quantity,0.1).toFixed(2)
					}else if(addType == '-'){
						if(this.numSub(customer_buying_quantity,0.1)<0){
							return
						}
						this.handleListSort[index].new_customer_buying_quantity=this.numSub(customer_buying_quantity,0.1).toFixed(2)
					}else if(addType == 'enter'){
						this.handleListSort[index].new_customer_buying_quantity=this.showQuantity
					}else if(addType == 'outstock'){
						this.handleListSort[index].new_customer_buying_quantity=0.00
					}
					if(this.handleListSort[index].new_customer_buying_quantity===''){
						this.popBox('Please enter quantity')
						return
					}
					this.handleListSort[index].new_customer_buying_quantity = parseFloat(this.handleListSort[index].new_customer_buying_quantity)
					if(this.handleListSort[index].new_customer_buying_quantity > 8888.88){
						this.popBox('Quantity exceeds limit')
						return
					}
					var data={
						"id":item.id,
						"new_customer_buying_quantity":this.handleListSort[index].new_customer_buying_quantity
					}
					console.log('修改加工数量参数----',data)
					var _this=this
					_this.isLoading=true
					getData("{:url('/product/pickEditProductItemBuyingQuantity')}", data, function (res) {
						console.log('修改加工数量结果----',res)
						_this.isLoading=false
						if (res.status == 200) {
							_this.handleListSort[index].new_customer_buying_quantity=_this.handleListSort[index].new_customer_buying_quantity
							//修改箱数
							_this.handleListSort[index].boxes=Math.ceil(item.new_customer_buying_quantity/item.unitQtyPerBox)
							//修改原数组的值
							for(var i in _this.handleList){
								if(_this.handleList[i]['id'] == _this.handleListSort[index].id){
									_this.handleList[i].new_customer_buying_quantity=_this.handleListSort[index].new_customer_buying_quantity
									break;
								}
							}
						} else {
							_this.popBox(res.message)
							_this.handleList[index].new_customer_buying_quantity=customer_buying_quantity
							_this.handleListSort[index].new_customer_buying_quantity=customer_buying_quantity
							return
						}
						if(addType == 'enter'){
							_this.closeKeyBoardQuantity()
						}
					});
				},
				//修改打印标签
				printLable(item,index,addType,type=1){
					if(item.dispatching_is_producing_done == 0 && item.is_lock!=1){
						this.popBox('Please lock the order')
						return
					}
					if(item.dispatching_is_producing_done == 0 && item.lock_type!=1){
						this.popBox('This Order has been locked by other')
						return
					}
					//如果该订单已加工完成，则没有权限操作
					// if(item.is_producing_done==1){
					// 	this.popBox('Inoperable completed')
					// 	return
					// }
					if(type == 1){
						var field='current_box_sort_id'
					}else{
						var field='edit_boxesNumber'
					}
					var num = this.handleListSort[index][field]
					if(addType == '+'){
						num++
					}else if(addType == '-'){
						num--
					}else if(addType == 'enter'){
						num=this.showQuantity
					}
					if(num <= 0){
						this.popBox('Quantity error')
						return
					}
					var data = {
						"id":item.id,
						"num":num,
						"type":type
					}
					console.log('修改箱数参数----',data);
					var _this=this
					_this.isLoading=true
					getData("{:url('/product/pickItemEditBoxNumber')}", data, function (res) {
						console.log('修改箱数结果----',res)
						_this.isLoading=false
						if (res.status == 200) {
							_this.handleListSort[index][field]=num
							//修改原数组的值
							for(var i in _this.handleList){
								if(_this.handleList[i]['id'] == _this.handleListSort[index].id){
									_this.handleList[i][field]=num
									if(type==2){
										_this.handleList[i]['boxesNumber']=num
									}
									break;
								}
							}
						} else {
							_this.popBox(res.message)
							return
						}
						if(addType == 'enter'){
							_this.closeKeyBoardQuantity()
						}
					});
				},
				//打印
				async print(item,index,e){
					if(item.dispatching_is_producing_done != 1 && item.is_lock!=1){
						//如果未锁定，点击自动锁定
						//是否存在产品规格 1-存在 2-不存在
						let is_has_three_cate = this.menudataTwoCate[this.menudataTwoCateIndex]['two_cate'].length>0?1:2;
						let three_cate_data = lock_data = []
						let lock_index,lock_cate_level
						if(is_has_three_cate==1) {
							three_cate_data = this.menudataTwoCate[this.menudataTwoCateIndex]['two_cate'][this.menudataThreeIndex]
							//如果未锁定，点击自动锁定
							lock_data = three_cate_data
							lock_index = this.menudataThreeIndex
							lock_cate_level = 3
						}else{
							lock_data = this.menudataTwoCate[this.menudataTwoCateIndex]
							lock_index = this.menudataTwoCateIndex
							lock_cate_level = 2
						}
						//如果未锁定，点击自动锁定
						lock_res = await this.gtouchstart(lock_data,lock_index,lock_cate_level)
						if(lock_res!=1){
							return
						}else{
							item.is_lock=1
							item.lock_type=1
						}
						// this.popBox('Please lock the order')
						// return
						// this.popBox('Please lock the product')
						// return
					}
					if(item.dispatching_is_producing_done == 0 && item.lock_type!=1){
						this.popBox('This Order has been locked by other')
						return
					}
					if(item.boxesNumberSortId < 0 || item.boxesNumber <= 0){
						return
					}
					//如果该明细的打印总箱数为0,则不打印
					if(item.boxes <= 0){
						this.popBox('The total number of boxes for this item is 0')
						return
					}
					var obj = $(e.target)
					if(obj.hasClass('printBg2')){
						return
					}
					var _this=this
					vm.$set(_this.orderItemOtherData[index],'printBg','printBg2');
					setTimeout(function(){
						_this.orderItemOtherData[index].printBg = '';
					},5000);
					// console.log('ssss',item);
					if(_this.print_type == 0 || _this.print_type == 2){
						//如果该明细的标签已全部打完，提示是否还要打印
						if(item.print_label_sorts_length >= item.boxes){
							swal({
								title: 'This item has been print,the print number is '+item.print_label_sorts+'/'+item.boxesNumber+' ,do you want still print?',
								icon: "warning",
								buttons: true,
								dangerMode: true,
							}).then((willContinue) => {
								if (!willContinue) {
									return
								}else{
									_this.printFun(item,index,e,_this.print_type)
								}
							});
						}else{
							if(_this.print_type == 2){
								//判断该明细是否已打印部分标签,若打印部分，提示是否打印剩余，还是打印全部标签
								if(item.print_label_sorts_length > 0){
									swal({
										title: 'This item is partially printed,the print number is '+item.print_label_sorts+'/'+item.boxes+' ,whether to print the remaining labels?',
										icon: "warning",
										buttons: true,
										dangerMode: true,
									}).then((willContinue) => {
										if (!willContinue) {
											return
										}else{
											_this.printFun(item,index,e,_this.print_type)
										}
									});
								}else{
									_this.printFun(item,index,e,_this.print_type)
								}
							}else{
								_this.printFun(item,index,e,_this.print_type)
							}
						}
					}else{
						_this.printFun(item,index,e,_this.print_type)
					}
				},
				//fit print all
				async fitPrintAll(){
					//获取当前选中的产品是否已锁定
					if(this.menudataTwoCate[this.menudataTwoCateIndex].status==0){
						this.popBox('Please lock the product')
						return
					}
					if(this.menudataTwoCate[this.menudataTwoCateIndex].status==2){
						this.popBox('This Product has been locked by other')
						return
					}
					var orders = []
					for(index in this.handleListSort){
						item = this.handleListSort[index]
						if(item.old_boxesNumberSortId > item.boxesNumber){
							continue;
						}else{
							orders.push(item)
						}
					}
					//重新获取订单箱数
					orders = await this.orderBoxNumber('',1)
					if(orders.length>0){
						//跳转到打印标签页,item-订单信息 item.num1-打印数量
						is_has_two_cate = item.guige1_id>0?1:2
						var goods = {"menu_id":item.menu_id,"menu_en_name":item.menu_en_name,"is_has_two_cate":is_has_two_cate}
						var goodsTwoCate = {"guige1_id":item.guige1_id,"guige_name":item.guige_name}
						if(is_has_two_cate == 1) {
							if(!this.setup_info||(this.setup_info&&this.setup_info.print_mode==1)){
								printAll(orders, goods, goodsTwoCate, this.businessName, this.userName, 1)
							}else{
								previewAll(orders, goods, goodsTwoCate, this.businessName, this.userName, 1)
							}
						}else{
							if(!this.setup_info||(this.setup_info&&this.setup_info.print_mode==1)) {
								printAll(orders, goods, [], this.businessName, this.userName, 1)
							}else{
								previewAll(orders, goods, [], this.businessName, this.userName, 1)
							}
						}
					}else{
						this.popBox('All printed')
						return
					}
				},
				async printFun(item,index,e='',print_type){
					let _this=this
					order_data = await _this.orderBoxNumber(item,print_type)
					if(order_data.length == 0){
						_this.popBox('Data exception')
						return
					}
					item = order_data[0]
					//跳转到打印标签页,item-订单信息 item.num1-打印数量
					is_has_two_cate = item.guige1_id > 0 ? 1 : 2
					var goods = {
						"menu_id": item.menu_id,
						"menu_en_name": item.menu_en_name,
						"is_has_two_cate": is_has_two_cate
					}
					var goodsTwoCate = {"guige1_id": item.guige1_id, "guige_name": item.guige_name}
					// console.log('到打印了---',this.handleListSort[index].boxes);
					// print_type = 0
					if (is_has_two_cate == 1) {
						if(!_this.setup_info||(_this.setup_info&&_this.setup_info.print_mode==1)) {
							print(item, item.boxesNumber, goods, goodsTwoCate, _this.businessName, _this.userName, print_type)
						}else{
							preview(item, item.boxesNumber, goods, goodsTwoCate, _this.businessName, _this.userName, print_type)
						}
					} else {
						if(!_this.setup_info||(_this.setup_info&&_this.setup_info.print_mode==1)) {
							print(item, item.boxesNumber, goods, [], _this.businessName, _this.userName, print_type)
						}else{
							preview(item, item.boxesNumber, goods, [], _this.businessName, _this.userName, print_type)
						}
					}
					//如果是fit print打印，判断当前明细的拣货状态是否是拣货完成状态，如果不是，调用更改拣货状态程序
					if(print_type == 2&&$.inArray(item.dispatching_is_producing_done,[0,2])!=-1&&(item.proucing_item!=1||item.assign_stock!=0)){
						this.changeStatus(item,index,1)
					}
				},
				//打印时获取最新的箱数以及打印后箱数序号更新
				orderBoxNumber(item='',print_type){
					return new Promise((resolve, reject) => {
						//订单信息需要重新获取-为防止更新不及时，并更改标签序号
						var id_arr = []
						var sortId_arr = [];
						if(print_type==1){
							for(var i in this.handleListSort){
								id_arr.push(this.handleListSort[i]['id'])
								sortId_arr.push(this.handleListSort[i]['current_box_sort_id'])
							}
						}else{
							id_arr.push(item.id)
							sortId_arr.push(item.current_box_sort_id)
						}
						var data = {
							"id_arr":id_arr,
							"print_type":print_type,
							"sortId":sortId_arr,//当前打印的序号标签id
						}
						console.log('打印修改箱数参数----',data)
						var _this = this
						getData("{:url('/product/orderBoxsNumber')}", data, function (res) {
							console.log('打印修改箱数结果----',res)
							_this.isLoading=false
							//修改打印数量
							//boxesNumberSortId 记录打印之后最新的序号id
							//current_boxesNumberSortId 记录打印前的序号id
							//old_boxesNumberSortId 记录订单原先的序号id
							var return_data = [];//存储返回的数据
							if (res.status == 200) {
								var data = res.result
								for(var i in data){
									for(var j in _this.handleListSort){
										if(_this.handleListSort[j].id == data[i].id){
											_this.handleListSort[j].boxesNumber = data[i].boxesNumber
											_this.handleListSort[j].edit_boxesNumber = data[i].edit_boxesNumber
											_this.handleListSort[j].old_boxesNumber = data[i].old_boxesNumber
											_this.handleListSort[j].boxesNumberSortId = data[i].newboxesNumberSortId
											_this.handleListSort[j].current_boxesNumberSortId = data[i].current_boxesNumberSortId
											_this.handleListSort[j].old_boxesNumberSortId = data[i].boxesNumberSortId
											_this.handleListSort[j].print_label_sorts_length = data[i].print_label_sorts_length
											_this.handleListSort[j].boxes = data[i].boxes
											_this.handleListSort[j].mix_group_data = data[i].mix_group_data
											_this.handleListSort[j].menu_en_name = data[i].menu_en_name
											_this.handleListSort[j].menu_id = data[i].menu_id
											_this.handleListSort[j].unit_en = data[i].unit_en
											_this.handleListSort[j].guige_name = data[i].guige_name
											_this.handleListSort[j].mix_box_sort_id = data[i].mix_box_sort_id
											return_data.push(_this.handleListSort[j])
											break;
										}
									}
									for(var k in _this.handleList){
										if(_this.handleList[k].id == data[i].id){
											_this.handleList[k].boxesNumber = data[i].boxesNumber
											_this.handleList[k].edit_boxesNumber = data[i].edit_boxesNumber
											_this.handleList[k].old_boxesNumber = data[i].old_boxesNumber
											_this.handleList[k].boxesNumberSortId = data[i].newboxesNumberSortId
											_this.handleList[k].old_boxesNumberSortId = data[i].boxesNumberSortId
											_this.handleList[k].print_label_sorts_length = data[i].print_label_sorts_length
											_this.handleList[k].boxes = data[i].boxes
											_this.handleList[k].mix_group_data = data[i].mix_group_data
											_this.handleList[k].menu_en_name = data[i].menu_en_name
											_this.handleList[k].menu_id = data[i].menu_id
											_this.handleList[k].unit_en = data[i].unit_en
											_this.handleList[k].guige_name = data[i].guige_name
											_this.handleList[k].mix_box_sort_id = data[i].mix_box_sort_id
											break;
										}
									}
								}
								resolve(return_data);
							} else {
								_this.popBox(res.message)
								resolve(return_data);
								return
							}
						});
					});
				},
				//两个数组相同字段的数据同步
				dataSync(data1,data2,field){
					for(var i in field){
						var current_field = field[i]
						data1[current_field]=data2[current_field]
					}
					return data1
				},
				numSub(arg1,arg2){
				    var r1,r2,m;
				    try{r1=arg1.toString().split(".")[1].length}catch(e){r1=0}
				    try{r2=arg2.toString().split(".")[1].length}catch(e){r2=0}
				    m=Math.pow(10,Math.max(r1,r2))
				    return ((arg1*m-arg2*m)/m);
				},
				numAdd(arg1, arg2) {
				    var r1, r2, m;
				    try { r1 = arg1.toString().split(".")[1].length; } catch (e) { r1 = 0; }
				    try { r2 = arg2.toString().split(".")[1].length; } catch (e) { r2 = 0; }
				    m = Math.pow(10, Math.max(r1, r2));
				    return ((arg1 * m + arg2 * m) / m);
				},
				//切换日期
				choseDay(item,index){
					this.choseDate1=item
					this.currentDay=index
					this.whichPopShow=-1
					this.logistic_delivery_date=item.logistic_delivery_date
					//存储当前日期
					localStorage.logistic_delivery_date=this.logistic_delivery_date
					//重置客户默认信息-start
					this.choseDate2=this.list2[0].name
					this.current2=0
					//重置司机默认信息-end
					//重置司机默认信息-start
					this.choseDate3=this.list3[0].name
					this.current3=0
					this.logistic_truck_No=''
					//重置司机默认信息-end
					//重置产品默认信息-start
					this.currentContent=0
					this.product_id=0
					this.guige1_id=''
					//重置产品默认信息-end
					//重置加工明细排序信息-start
					this.wccSort=0
					this.wccSortType=1
					//重置加工明细排序信息-end
					this.isLoading=true
					this.inidata()
					if(this.currentPage==2){
						var cate_id = this.menudata[this.currentMenu].id
						this.cetegoryProduct(cate_id)
					}
					this.isLoading=false
				},
				choseCus(item,index){
					this.choseDate2=item.name
					this.current2=index
					this.whichPopShow=-1
					//重置司机默认信息-start
					this.choseDate3=this.list3[0].name
					this.current3=0
					this.logistic_truck_No=''
					//重置司机默认信息-end
					//重置产品默认信息-start
					this.currentContent=0
					this.product_id=0
					this.guige1_id=''
					//重置产品默认信息-end
					//重置加工明细排序信息-start
					this.wccSort=0
					this.wccSortType=1
					//重置加工明细排序信息-end
					this.isLoading=true
					this.inidata()
					if(this.currentPage==2){
						var cate_id = this.menudata[this.currentMenu].id
						this.cetegoryProduct(cate_id)
					}
					this.isLoading=false
				},
				//切换司机
				choseDriver(item,index){
					this.choseDate3=index==0?item.name:item.name+' '+item.name+'-'+item.truck_name+'-'+item.plate_number
					this.current3=index
					this.whichPopShow=-1
					this.logistic_truck_No=item.logistic_truck_No
					//重置默认信息-start
					this.currentContent=0
					this.logistic_truck_No=item.logistic_truck_No
					this.orderId=''
					//重置默认信息-end
					//重置加工明细排序信息-start
					this.wccSort=0
					this.wccSortType=1
					//重置加工明细排序信息-end
					this.isLoading=true
					this.inidata()
					if(this.currentPage==2){
						this.returnPage(2)
					}
					this.isLoading=false
				},
				closePop(){
					this.whichPopShow=-1
				},
				chose(index){
					this.lastTime = new Date().getTime();//记录最后一次点击时间
					this.whichPopShow=index
					//获取客户数据
					if(index==2){
						var _this=this
						getData("{:url('/product/customer')}", '', function (res) {
							_this.list2 = [{"id":"","name":"All customers"}]
							_this.list2 = _this.list2.concat(res.result.all_customers)
						});
					}
					//获取司机数据
					if(index==3){
						var _this=this
						var data = {
							'logistic_delivery_date':_this.logistic_delivery_date
						}
						getData("{:url('/product/drivers')}", data , function (res) {
							_this.list3 = [{"logistic_truck_No":"","name":"All Drivers&Truck","truck_name":"","plate_number":""}]
							_this.list3 = _this.list3.concat(res.result.all_drivers)
						});
					}
				},
				//index-1:返回首页 2:返回类目页 3:返回司机和订单页面
 				returnPage(index){
					this.currentPage=index
					//返回首页时，将默认获取第一个分类的信息
					this.currentMenu=0
					//获取大类
					var _this=this
					localStorage.currentPage=index
					if(_this.currentPage == 1){
						_this.dataRefreh();
					}
					if(_this.currentPage == 2){
						var data = {
							"logistic_delivery_date":this.logistic_delivery_date,
							"logistic_truck_No":this.logistic_truck_No,
							// "category_id":cate_id
						}
						getData("{:url('/product/pickCategory')}", data, function (res) {
							res.result.unshift({"id":-1,"category_en_name":"Current Stock"})
							_this.menudata = res.result
							console.log('获取产品大类目---',_this.menudata)
							//获取默认的展示产品
							_this.cetegoryProduct(_this.menudata[0]['id']);
						});
						this.dataRefrehPage23();
					}
					if(_this.currentPage == 3) {
						//跳转到按订单拣货页面
						window.location.href = "{:url('/product/pickingOrder')}"
					}
					if(_this.currentPage == 4) {
						this.currentPage=1
						localStorage.currentPage=1
						window.location.href = "{:url('/product/pickingOrder')}"
					}
				},
				//获取对应类别的产品
				cetegoryProduct(cate_id){
					// this.goods = []
					//调取获取当前备货接口
					var data = {
						"logistic_delivery_date":this.logistic_delivery_date,
						"logistic_truck_No":this.logistic_truck_No,
						// "category_id":cate_id
					}
					var url = "{:url('/product/pickCategoryProduct')}"
					var _this=this
					console.log('获取大类产品参数----',data)
					getData(url, data, function (res) {
						console.log('获取大类产品----',res)
						_this.goods = res.result
					});
				},
				//类目页面跳转到加工页面对应的产品位置  type-1:当前备货页面点击跳转+定位 2：返回此分类点击跳转+定位 3:拣货员当前备货页面分类定位
				//index 选中的索引值id
				//selector 选中对象
				//item1 选中的二级类目数据
				goto(item,index,selector,type=1,item1=''){
					switch(type){
						case 1:
							this.currentPage=1
							//并将该产品改为选中状态,获取该产品的索引值,如果当前选中产品不一致，则修改选中产品
							var index = $(selector).index()
							if(this.menudata2SortIndex != index){
								this.clickOneCate(this.menudata2Sort[index],index,item1)
							} else {
								if(item1 != ''){
									this.twoCate('',item1)
								}
							}
							var obj = '.J_left_menu_1'
							break;
						case 2:
							this.currentPage=1
							// alert(selector)
							this.isHandle=2
							this.inidata()
							var obj = '.J_left_menu_1'
							break;
						case 3:
							var obj = '.J_left_menu_2'
							break;
						case 4:
							this.currentMenu=index
							var obj = '.J_right_menu_2'
							break;
						case 5:
							this.currentPage3LeftIndex=index
								this.twoCate('allDriverOrder')
							var obj = '.J_right_menu_3'
							break;
					}
					this.$nextTick(()=> {
						if(selector == '.J_pick_cate_-1'){
							var h = 0
						} else {
							//网页被卷去的高度
							var scroll_top = $(obj).scrollTop()
							var h = $(obj).find(selector).offset().top-90+scroll_top
							console.log('计算出滚动的高度---',$(obj).find(selector).offset().top,$(obj).scrollTop())
						}
						$(obj).animate({scrollTop:h},500)
					})
				},
				//排序基础数据的同步
				menudata2Sync(type){
					switch (type) {
						case 1://当前选中的索引值
							for(var i in this.menudata2){
								if(this.menudata2[i]['logistic_truck_No'] == this.menudata2Sort[this.menudata2SortIndex]['logistic_truck_No']){
									this.currentContent=i
									break;
								}
							}
							break;
					}
				},
				clickHandle(){
					if(this.isHandle==2){
						this.isHandle=0
					}else{
						this.isHandle=this.isHandle+1
					}
					//未进行排序前当前选中的产品id
					var logistic_truck_No = this.menudata2Sort[this.menudata2SortIndex].logistic_truck_No
					//将产品进行排序
					this.menudata2Sort=JSON.parse(JSON.stringify(this.menudata2))
					console.log('产品排序---',this.isHandle);
					switch(this.isHandle){
						case 0:this.sortData(this.menudata2Sort,'isDone',1,'menu_id');break;
						case 1:this.sortData(this.menudata2Sort,'isDone',2,'menu_id');break;
						case 2:this.sortData(this.menudata2Sort,'menu_id',1);break;
					}
					//默认选中索引值归0
					// this.menudata2SortIndex=0
					// this.menudataTwoCateIndex=0
					//排序之后-动态改变当前选中的索引id值
					for (var i in this.menudata2Sort) {
						if(this.menudata2Sort[i].logistic_truck_No == logistic_truck_No){
							this.menudata2SortIndex = i
							break;
						}
					}
					for (var i in this.menudata2) {
						if(this.menudata2[i].logistic_truck_No == logistic_truck_No){
							this.currentContent = i
							break;
						}
					}
					//获取默认显示的二级类目
					// this.twoCate()
				},
				//设置或取消置顶
				cancelZD(item,index,action_type,source=''){
					var data = {
						"product_id":item.product_id,
						"action_type":action_type
					}
					var _this=this
					getData("{:url('/product/setTopProduct')}", data, function (res) {
						if(res.status == 200){
							if(action_type == 1){
								_this.goods[index]['is_set_top'] = 1
							}else{
								_this.goods[index]['is_set_top'] = 0;
							}
							if(source=='top'&&action_type==2){
								$('.J_set_top').eq(index).remove();
							}
						}else{
							_this.popBox(res.message)
							return
						}
					});
				},
				//关闭日志弹窗
				closeLog(){
					this.isShowLog=false
				},
				//弹出日志信息 type=1 主面板 type=2 picking&sum页面日志
				log(item,index,type=1){
					this.isShowLog=true
					if(type == 1){
						var data = {
							"logistic_delivery_date":this.logistic_delivery_date,
							"product_id":item.product_id,
							"guige1_id":item.guige1_id,
							"wcc_id":item.id
						}
						var url = "{:url('/product/pickProductItemLogData')}"
					}else{
						var data = {
							"logistic_delivery_date":this.logistic_delivery_date,
							"product_id":item.product_id,
						}
						var url = "{:url('/product/noneProcessedLogData')}"
					}
					console.log('获取日志参数---',data)
					var _this=this
					getData(url, data, function (res) {
						console.log('获取日志结果---',res)
						if(res.status == 200){
							_this.logData = res.result
						}else{
							_this.popBox(res.message)
						}
					});
				},
				//光标移入div样式
				focusData(e,type,pincodeType){
					e.target.setAttribute('placeholder','')
					this.focusDatype = type
					this.pincodeType = pincodeType
				},
				//点击pincode键盘，显示输入pincode
				clickNum(number){
					this.lastTime = new Date().getTime();//记录最后一次点击时间
					switch(this.focusDatype){
						case 10:
							if(this.psd.length<4){
								this.psd+=number
								this.psd2 += new String('*',this.psd.length);
							}
							break;
						case 20:
							if(this.npsd.length<4){
								this.npsd+=number
								this.npsd2 += new String('*',this.npsd.length);
							}
							break;
						case 30:
							if(this.nrpsd.length<4){
								this.nrpsd+=number
								this.nrpsd2 += new String('*',this.nrpsd.length);
							}
							console.log(this.nrpsd,this.nrpsd.length);
							break;
					}
					//如果输入数字长度为4，可直接登录
					switch(this.pincodeType){
						case 1:
							if(this.psd.length==4){
								this.save()
							}
							break;
						case 2:
							break;
						case 3:
							break;
					}
				},
				//上锁，则退出登录
				popKeyboard(){
					this.iskeyboardShow=true
					this.isClock = true
					this.psd=this.psd2=this.npsd=this.npsd2=this.nrpsd=this.nrpsd2=''
					this.message=''
					this.editText='setting'
					//退出pincode登录
					this.loginOutPincode()
				},
				//关闭keyboard
				closeKeyboard(){
					if(!this.isClock){
						this.iskeyboardShow=false
					}
				},
				//弹出修改pincode
				editPincode(){
					this.lastTime = new Date().getTime();//记录最后一次点击时间
					this.isShowTypePincode1=!this.isShowTypePincode1
					this.isShowTypePincode3=!this.isShowTypePincode3
					if(this.isShowTypePincode1){
						this.pincodeType = 1
						this.focusDatype=10
						this.psd=this.psd2=this.npsd=this.npsd2=this.nrpsd=this.nrpsd2=''
						this.editText='setting'
					}
					if(this.isShowTypePincode3){
						this.pincodeType = 3
						this.focusDatype=''
						this.psd=this.psd2=''
						this.editText='Back'
					}
					this.message=''
					this.isPsdCorrect=false
				},
				//pincode登录
				save(){
					this.lastTime = new Date().getTime();//记录最后一次点击时间
					var _this = this
					if (_this.isDisable) {
						return
					}
					var data = {};
					var url = '';
					console.log(_this.pincodeType);
					switch(_this.pincodeType){
						case 1:
							if (_this.psd==''||_this.psd==null) {
								this.isPsdCorrect=true
								this.message='Please input pincode'
								return
							}
							data = {
								pincode: _this.psd,
							}
							url = "{:url('/product/loginByPincode')}"
							break;
						case 2:
							if (_this.npsd==''||_this.npsd==null) {
								this.isPsdCorrect=true
								this.message='Please input New pincode'
								$('.J_n_pincode').attr('placeholder',_this.placeholderNPincode);
								$('.J_nr_pincode').attr('placeholder',_this.placeholderNRPincode);
								return
							}
							if (_this.nrpsd==''||_this.nrpsd==null) {
								this.isPsdCorrect=true
								this.message='Please input Re-enter pincode'
								$('.J_n_pincode').attr('placeholder',_this.placeholderNPincode);
								$('.J_nr_pincode').attr('placeholder',_this.placeholderNRPincode);
								return
							}
							if(_this.npsd.length!=4||_this.nrpsd.length!=4){
								this.isPsdCorrect=true
								this.message='Please enter a 4-digit code'
								this.npsd=this.nrpsd=this.npsd2=this.nrpsd2=''
								$('.J_n_pincode').attr('placeholder',_this.placeholderNPincode);
								$('.J_nr_pincode').attr('placeholder',_this.placeholderNRPincode);
								return
							}
							data = {
								new_pincode: _this.npsd,
								sure_pincode: _this.nrpsd,
							}
							url = "{:url('/product/setPincode')}"
							break;
						case 3:
							if (_this.psd==''||_this.psd==null) {
								this.isPsdCorrect=true
								this.message='Please input Old pincode'
								$('.J_o_pincode').attr('placeholder',_this.placeholderOPincode);
								return
							}
							if (_this.npsd==''||_this.npsd==null) {
								this.isPsdCorrect=true
								this.message='Please input New pincode'
								$('.J_n_pincode').attr('placeholder',_this.placeholderNPincode);
								$('.J_nr_pincode').attr('placeholder',_this.placeholderNRPincode);
								return
							}
							if (_this.nrpsd==''||_this.nrpsd==null) {
								this.isPsdCorrect=true
								this.message='Please input Re-enter pincode'
								$('.J_n_pincode').attr('placeholder',_this.placeholderNPincode);
								$('.J_nr_pincode').attr('placeholder',_this.placeholderNRPincode);
								return
							}
							if(_this.npsd.length!=4||_this.nrpsd.length!=4){
								this.isPsdCorrect=true
								this.message='Please enter a 4-digit code'
								this.npsd=this.nrpsd=this.npsd2=this.nrpsd2=''
								$('.J_n_pincode').attr('placeholder',_this.placeholderNPincode);
								$('.J_nr_pincode').attr('placeholder',_this.placeholderNRPincode);
								return
							}
							data = {
								pincode: _this.psd,
								new_pincode: _this.npsd,
								sure_pincode: _this.nrpsd,
							}
							url = "{:url('/product/editPincode')}"
							break;
					}
					_this.isDisable = true
					console.log(url,data);
					getData(url, data, function (res) {
						console.log(res);
						_this.isDisable = false
						if(res.status == 200){
							console.log(res.result.user_name);
							if (res.result.user_name) {
								_this.userName = res.result.user_name
								_this.businessName = res.result.business_name
							}
							//登录成功，隐藏密码框
							_this.iskeyboardShow=false
							_this.isClock=false
							//显示退出登录按钮
							_this.isShowLoginOut = true
							//还原默认显示pincode登录
							_this.isShowTypePincode1 = true
							_this.isShowTypePincode2 = _this.isShowTypePincode3 = false
							_this.pincodeType = 1 //默认显示pincode登录
							_this.focusDatype = 10 //默认可直接输入密码
							_this.is_product_permission = res.result.is_product_permission
							_this.setup_info = res.result.setup_info
							//清除定时任务
							_this.clearTime()
							_this.isLoading = false
							_this.inidata(_this.logistic_delivery_date)
						} else {
							_this.message = res.message
							_this.isPsdCorrect=true
							switch(res.status){
								case 104:
									$('.J_pincode').attr('placeholder',_this.placeholderPincode);
									_this.psd=_this.psd2=''
									break;
								case 105://pincode错误次数过多，屏幕锁屏1分钟
									$('.J_pincode').attr('placeholder',_this.placeholderPincode);
									_this.psd=_this.psd2=''
									_this.isDisable = true
									_this.isClock = true
									_this.timeLock = 60
									_this.getTimeDown()
									break;
								case 106://pincode已存在
								case 108://pincode两次输入不一致
									$('.J_n_pincode').attr('placeholder',_this.placeholderNPincode);
									$('.J_nr_pincode').attr('placeholder',_this.placeholderNRPincode);
									_this.npsd=_this.npsd2=_this.nrpsd=_this.nrpsd2=''
									break;
								case 107:
									$('.J_o_pincode').attr('placeholder',_this.placeholderOPincode);
									_this.psd=_this.psd2=''
									break;
								default:
									$('.J_pincode').attr('placeholder',_this.placeholderPincode);
									_this.psd=_this.psd2=''
							}
						}
					});
				},
				//退出登录
				LogOut(){
					var _this = this
					if (_this.isDisable) {
						return
					}
					_this.isDisable = true
					getData("{:url('/product/loginOut')}", '', function (res) {
						window.location.href = "{:url('/product/login')}"
					})
				},
				//删除code
				deletePsd(){
					this.lastTime = new Date().getTime();//记录最后一次点击时间
					switch(this.focusDatype){
						case 10:
							this.psd=this.psd.substr(0, this.psd.length - 1);
							this.psd2=this.psd2.substr(0, this.psd2.length - 1);
							break;
						case 20:
							this.npsd=this.npsd.substr(0, this.npsd.length - 1);
							this.npsd2=this.npsd2.substr(0, this.npsd2.length - 1);
							break;
						case 30:
							this.nrpsd=this.nrpsd.substr(0, this.nrpsd.length - 1);
							this.nrpsd2=this.nrpsd2.substr(0, this.nrpsd2.length - 1);
							break;
					}
				},
				//倒计时
				getTimeDown(){
					if (!this.timer) {
						this.timer = setInterval(() => {
							if (this.timeLock > 0) {
								this.timeLock--;
							} else {
								this.isDisable = !this.isDisable
								this.timeLock = 0
								console.log(this.isDisable,this.isClock);
								clearInterval(this.timer);
								this.timer = null;
							}
						}, 1000)
					}
				},
				//聚焦时，默认全部选中文本框
				focusEvent: function (e) {
					e.currentTarget. select();
				},
				handleInput2(e) {
					// 通过正则过滤小数点后两位
					e.target.value = e.target.value.match(/\d+\.?\d{0,2}/)
				},
				handleInput(e) {
					e.target.value=e.target.value.replace(/[^\d]/g,'');
				},
				//弹层提示信息
				popBox(popMessage){
					this.isShowMessage=true
					this.popMessage=popMessage
					this.timeOutEvent = setTimeout(()=>{
						this.isShowMessage=false
						this.popMessage=''
						clearTimeout(this.timeOutEvent);//清除定时器
					},2000);//这里设置定时器，定义长按2000毫秒触发长按事件
					return
				},
				//关闭修改数量键盘
				closeKeyBoardQuantity(){
					this.iskeyboardQuantityShow = false
					this.handleItem = []
					this.handleIndex = 0
					this.quantityType = 1
				},
				showKeyBoxQuantity(item,index,type=1){
					this.showQuantity = ''
					if(type == 1){
						//如果该产品是加工未分配的，则没有权限操作
						if(item.proucing_item==1&&item.assign_stock==0){
							this.popBox('You cannot operate')
							return
						}
						//如果该产品是加工产品，则拣货员没有修改数量的权限
						if(item.dispatching_is_producing_done==1){
							this.popBox('You do not have permission to operate')
							return
						}
						if(item.is_lock!=1){
							this.popBox('Please lock the order')
							return
						}
						if(item.lock_type!=1){
							this.popBox('This order has been locked by other')
							return
						}
						//如果该订单已加工完成，则没有权限操作
						if(item.dispatching_is_producing_done==1){
							this.popBox('Inoperable completed')
							return
						}
						// this.showQuantity = item.new_customer_buying_quantity
					}else{
						if($.inArray(type,[2,3])!==-1){
							if(item.dispatching_is_producing_done == 0 && item.is_lock!=1){
								this.popBox('Please lock the order')
								return
							}
							if(item.dispatching_is_producing_done == 0 && item.lock_type!=1){
								this.popBox('This Order has been locked by other')
								return
							}
							// if(type == 2){
							// 	this.showQuantity = item.current_box_sort_id
							// }else{
							// 	this.showQuantity = item.edit_boxesNumber
							// }
						}
					}
					this.iskeyboardQuantityShow = true
					this.quantityType = type
					this.handleItem = item
					this.handleIndex = index
				},
				//输入数量
				clickNumber(number){
					var quantity = this.showQuantity.toString()
					quantity+=number
					var firstNum = quantity.substr(0, 1)
					if(firstNum == 0 && number != '.'){
						quantity=number.toString()
					}
					if (this.quantityType == 1) {
						if(firstNum == '.'){
							quantity='0.1'
						}
						console.log(quantity);
						this.showQuantity=this.numberCheck(quantity)
					} else {
						if(quantity == '00'){
							quantity = '0'
						}
						this.showQuantity=this.intNumberCheck(quantity)
					}
				},
				//清除最后一位数据
				deleteNumber(){
					this.showQuantity = this.showQuantity.toString()
					this.showQuantity=this.showQuantity.substr(0, this.showQuantity.length - 1);
				},
				//清空数量
				clearNumber(){
					this.showQuantity = ''
				},
				//回车键修改数量
				editKeyBoardQuantity(handleItem,handleIndex,type='enter'){
					if (this.quantityType == 1) {
						this.editQuantity(handleItem,handleIndex,type)
					} else {
						if(this.showQuantity <= 0){
							this.popBox('Quantity error')
							return
						}
						if (this.quantityType == 2) {
							//打印开始值，判断是否在允许范围打印
							if(handleItem.print_label_sorts_length>0){
								if($.inArray(this.showQuantity,handleItem.print_label_sorts_arr) == -1){
									this.popBox('The print label number is '+handleItem.print_label_sorts)
									return
								}
							}else{
								if(this.showQuantity != handleItem.current_box_sort_id){
									this.popBox('Quantity exceeds limit')
									return
								}
							}
							this.printLable(handleItem, handleIndex, type, this.quantityType - 1)
						}else{
							//调整总箱数最大不能超过原先计算的2倍数
							if(this.showQuantity < handleItem.old_boxesNumber || this.showQuantity > handleItem.old_boxesNumber*2){
								this.popBox('Quantity exceeds limit')
								return
							}
							//调整总箱数时，需要友情提示是否调整
							swal({
								title: 'Modifying the total number of labels will invalidate the original printed labels. Are you sure to modify?',
								icon: "warning",
								buttons: true,
								dangerMode: true,
							}).then((willContinue) => {
								if (!willContinue) {
									return
								}else{
									this.printLable(handleItem,handleIndex,type,this.quantityType-1)
								}
							});
						}
						// if(this.showQuantity > 50){
						// 	this.popBox('Quantity exceeds limit')
						// 	return
						// }
						// this.editQuantity(handleItem,handleIndex,type)
						// this.handleList[handleIndex].num1=this.showQuantity
						// this.iskeyboardQuantityShow=false
					}
				},
				//校验是否是最多两位小数的数据
				numberCheck(value){
					value = value.replace(/[^\d.]/g, "");  //清除“数字”和“.”以外的字符
					value = value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
					value = value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
					value = value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3');//只能输入两个小数
					return value
				},
				//整数校验
				intNumberCheck(value){
					value = value.replace(/[^\d]/g,'');
					return value
				},
				//picking&sum页面点击产品锁定
				gtouchstartPs(item,index){
					clearTimeout(this.clickTimer);  //首先清除计时器
					//将其他返回操作按钮取消
					this.currentPage2OneCateIndex = -1
					this.currentPage2TwoCateIndex = -1
					//如果时生产产品，没有权限锁定
					// if(item.proucing_item == 1){
					// 	this.popBox('No permission to produce products')
					// 	return
					// }
					if(item.status == 2){
						this.popBox('This product has been locked by other')
						return
					}
					if(item.status == 3){
						this.popBox('This product has been processed')
						return
					}
					var data = {
						"logistic_delivery_date":this.logistic_delivery_date,
						"logistic_truck_No":this.logistic_truck_No,
						"product_id":item.product_id,
					}
					console.log('获取ps页面锁定参数-----',data);
					var _this = this
					//产品的锁定状态,status -1-需要根据二级类目加工 0-未加工 1-自己正在加工 2-其他人正在加工 3-加工完成
					_this.isLoading=true
					if(item.status == 0){
						getData("{:url('/product/lockNoneProcessedProduct')}", data, function (res) {
							console.log('获取ps页面锁定结果-----',res)
							if(res.status == 200){
								//记录过期时间
								_this.currentInterTime = new Date().getTime();
								_this.lockResPs(res.result,item,index)
							} else {
								_this.isLoading=false
								_this.popBox(res.message)
								return
							}
						});
					}
					if(item.status == 1){
						getData("{:url('/product/unlockNoneProcessedProduct')}", data, function (res) {
							console.log('获取ps页面解锁结果-----',res)
							_this.isLoading=false
							if(res.status == 200){
								//解锁成功，将该产品状态变为0
								item.status = 0
							} else {
								_this.popBox(res.message)
								return
							}
						});
					}
					// },2000);//这里设置定时器，定义长按2000毫秒触发长按事件
					return false;
				},
				//获取锁定结果
				lockResPs(result,item,index){
					//获取锁定结果
					var data = {
						"uniqid":result.uniqid
					}
					var _this=this
					getData("{:url('/product/lockNoneProcessedProductResult')}", data, function (res) {
						console.log('获取队列结果----',res);
						if (res.status == 119) {
							_this.isLoading=true
							//判断上次最后一次点击的时间和这次点击的时间间隔是否大于1分钟
							if(new Date().getTime() - _this.currentInterTime > _this.interTimeOut) {
								clearTimeout(_this.timeOutLock);
								_this.isLoading=false
								_this.popBox('The server is busy, please try again later')
							} else {
								_this.timeOutLock = setTimeout(() => {
									// console.log('定时获取结果------');
									_this.lockResPs(result, item, index)
								}, 100);
							}
						} else {
							clearTimeout(_this.timeOutLock);
							_this.isLoading=false
							if(res.status == 200){
								//解锁成功，将该产品状态变为1
								item.status = 1
							}else{
								_this.popBox(res.message)
								return
							}
						}
					})
				},
				//显示返回操作按钮
				showReprocess(item,index,item1,index1){
					clearTimeout(this.clickTimer);  //首先清除计时器
					this.clickTimer = setTimeout(() => {
						this.currentPage2OneCateIndex = index
						this.currentPage2TwoCateIndex = index1
						this.isShowPsReprocess = true
					}, 300);   //大概时间300ms
				},
				//跳转到生产中心页面
				gotoProductCentre(){
					if(this.is_product_permission==1||this.is_product_permission==3){
						window.location.href = common.webUrl+'product/index'
					}else{
						window.location.href = common.webUrl+'product/preProduct'
					}
				},
				// 全屏事件
				handleFullScreen(){
					let element = document.documentElement;
					// 判断是否已经是全屏
					// 如果是全屏，退出
					if (this.fullscreen) {
						if (document.exitFullscreen) {
							document.exitFullscreen();
						} else if (document.webkitCancelFullScreen) {
							document.webkitCancelFullScreen();
						} else if (document.mozCancelFullScreen) {
							document.mozCancelFullScreen();
						} else if (document.msExitFullscreen) {
							document.msExitFullscreen();
						}
					} else {    // 否则，进入全屏
						if (element.requestFullscreen) {
							element.requestFullscreen();
						} else if (element.webkitRequestFullScreen) {
							element.webkitRequestFullScreen();
						} else if (element.mozRequestFullScreen) {
							element.mozRequestFullScreen();
						} else if (element.msRequestFullscreen) {
							// IE11
							element.msRequestFullscreen();
						}
					}
					// 改变当前全屏状态
					this.fullscreen = !this.fullscreen;
				}
			},
			created(){
				this.lastTime = new Date().getTime();   //网页第一次打开时，记录当前时间
				this.returnPage(this.currentPage)
			},
			beforeDestroy(){
				window.removeEventListener('online',  this.updateOnlineStatus);
				window.removeEventListener('offline', this.updateOnlineStatus);
			},
			destroyed(){
				// 在页面销毁后，清除计时器
				this.clear();
			}
		})
	</script>
</html>
