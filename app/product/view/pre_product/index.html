<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
		<link rel="stylesheet" type="text/css" href="__STATIC__/product/css/common.css"/>
		<link rel="stylesheet" type="text/css" href="__STATIC__/product/css/sweetalert2.css"/>
		<script src="__STATIC__/product/js/jquery-3.3.1.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="__STATIC__/product/js/vue.min.js"></script>
		<script src="__STATIC__/product/js/common.js"></script>
		<script src="__STATIC__/product/lodop/LodopFuncs.js"></script>
		<script src="__STATIC__/product/js/print.js"></script>
		<script src="__STATIC__/product/js/sweet-alert/sweetalert.min.js"></script>
	</head>
	<body onselectstart="return false">
	<div id="main" v-cloak @click="closePop();isDo()">
		<div class="bgfff H120 head flexbox1 F26">
			<div class="flexbox2">
				<img src="__STATIC__/product/img/headIcon.png" class="headIcon"/>&nbsp;
				<span>City b2b</span>
			</div>
			<div class="flexbox2 relative hand" @click.stop="chose(0)">
				<span>{{productType[currentProductTypeIndex]}}</span>
				<img src="__STATIC__/product/img/updown.png" class="updown"/>
				<div class="choseCustomerBox w200" v-show="whichPopShow==0">
					<div class="mb10 F20" v-for="(item ,index) in productType" :class="currentProductTypeIndex==index?'colFD6921':''" @click.stop="choseProductType(item,index)">{{item}}</div>
				</div>
			</div>
			<div class="flexbox2 relative hand" @click.stop="chose(5)" v-if="isManager==1">
				<span>{{manageActionType[currentManageActionTypeIndex]}}</span>
				<img src="__STATIC__/product/img/updown.png" class="updown"/>
				<div class="choseCustomerBox" v-show="whichPopShow==5">
					<div class="mb10 F20" v-for="(item,index) in manageActionType" :class="currentManageActionTypeIndex==index?'colFD6921':''" @click.stop="choseActionType(item,index)">
						{{item}}
					</div>
				</div>
			</div>
		    <div class="relative hand" @click.stop="chose(1)">
				<span class="blink">{{choseDate1?choseDate1.date+' '+choseDate1.date_day:list[0].date+' '+choseDate1.date_day}}</span>
				<div class="choseCustomerBox datePop" v-show="whichPopShow==1">
					<div class="mb10 F20" v-for="(item ,index) in list" :class="currentDay==index?'colFD6921':''" @click.stop="choseDay(item,index)">{{item.date}} {{item.date_day}}</div>
				</div>
			</div>
			<div class="flexbox2 relative hand" @click.stop="chose(2)">
				{{choseDate2?choseDate2:list2[0].name}}
				<img src="__STATIC__/product/img/updown.png" class="updown"/>
				<div class="choseCustomerBox" v-show="whichPopShow==2">
					<div class="mb10 F20" v-for="(item,index) in list2" :class="current2==index?'colFD6921':''" @click.stop="choseCus(item,index)">{{item.name}}</div>
				</div>
			</div>
<!--			<div class="flexbox2 relative hand" @click.stop="chose(3)">-->
<!--				{{choseDate3?choseDate3:list3[0].name}}-->
<!--				<img src="__STATIC__/product/img/updown.png" class="updown"/>-->
<!--				<div class="choseCustomerBox" v-show="whichPopShow==3">-->
<!--					<div class="mb10 F20" v-for="(item,index) in list3" :class="current3==index?'colFD6921':''" @click.stop="choseDriver(item,index)">-->
<!--						<span v-if="index == 0">{{item.name}}</span>-->
<!--						<span v-else>{{item.name}} {{item.name}}-{{item.truck_name}}-{{item.plate_number}}</span>-->
<!--					</div>-->
<!--				</div>-->
<!--			</div>-->
			<div class="flexbox2 relative hand" @click.stop="chose(4)">
				{{list4[currentOperatorIndex]['user_name']}}
				<img src="__STATIC__/product/img/updown.png" class="updown"/>
				<div class="choseCustomerBox" v-show="whichPopShow==4">
					<div class="mb10 F20" v-for="(item,index) in list4" :class="currentOperatorIndex==index?'colFD6921':''" @click.stop="choseOperator(item,index)">
						{{item.user_name}}
					</div>
				</div>
			</div>

			<div class="btn bgFD6921">{{operatorOrderDoneNum}}/{{operatorOrderNum}}</div>
			<div class="btn bg34C079">{{orderDoneNum}}/{{orderNum}}</div>
		</div>

		<div class="flexbox3" style="min-height:100%;">
			<div class="left bgfff">
				<div class="colfff F20 jbBG flexbox2 goodsMenu hand" @click="isManager==1&&returnPage(2)" v-show="currentPage==1">
					<img src="__STATIC__/product/img/goodsIcon.png" class="goodsIcon"/>
					Product List
					<img src="__STATIC__/product/img/arrow.png" class="arrIcon"/>
				</div>
				<div class="colfff F20 jbBG flexbox2 goodsMenu hand" @click="returnPage(1)" v-show="currentPage==2">
					<img src="__STATIC__/product/img/return.png" class="returnIcon"/>
					Main Pannel
				</div>
				<div class="F20 bgF1F1F1 lbtn hand" v-show="currentPage==1" @click="clickHandle">
					<span class="colFD6921" v-if="isHandle==0">Processing</span>
					<span class="col34C079" v-else-if="isHandle==1">Processed</span>
					<span class="col000" v-else>Code</span>
					<img src="__STATIC__/product/img/updown.png" class="updown"/>
				</div>
				<div v-show="currentPage==2" class="leftMenu2">
					<div v-for="(item,index) in menudata" :class="currentMenu==index?'bgFD6921 colfff':'bgF1F1F1 col000'" class="F20 lbtn relative hand" @click="clickMenu(item,index)">
						{{item.category_en_name}}
						<img src="__STATIC__/product/img/menusj.png" class="menusj" v-show="currentMenu==index"/>
					</div>
				</div>

				<div v-show="currentPage==1" class="hand leftMenu J_left_menu_1">
					<div :class="['J_cate_'+item.cate_id,{'bgFFF7F3 col5e5656':item.status==0&&menudata2SortIndex!=index,'bgFFF7F3 col5e5656 checkStyle':item.status==0&&menudata2SortIndex==index,'bgFD6921 blink':item.status==1,'bgGrey blink':item.status==2,'bg34C079 colfff':item.status==3,'bg1d95b9 colfff':item.status==4}]" class="F20 lbtn2 relative" v-for="(item,index) in menudata2Sort" @click="clickGoods(item,index);" @dblclick="(item.status!=4&&currentManageActionTypeIndex==0)&&gtouchstart(item,index,1);(item.status==4||currentManageActionTypeIndex==1)&&popQuantityBox(item,index,1);" :id="'anchor-'+item.product_id">
						<div>{{item.menu_en_name}}</div>
						<div>{{item.finish_quantities}}/{{item.sum_quantities}}{{item.unit_en}}</div>
						<div>{{item.menu_id}}</div>
						<img v-if="item.is_has_two_cate==2&&item.is_lock==1" src="__STATIC__/product/img/suo.png" class="suo"/>
						<img src="__STATIC__/product/img/menusj.png" class="menusj" v-show="menudata2SortIndex==index"/>
					</div>
				</div>
			</div>
			<div class="right pa26">
				<div v-show="currentPage==1">
					<div>
						<div class="flexbox2 rsection1 F20 J_product_cate" ref="element">
							<div :class="{'bgFFF7F3 col5e5656':item.status==0&&menudataTwoCateIndex!=index,'bgFFF7F3 col5e5656 checkStyle':item.status==0&&menudataTwoCateIndex==index,'bgOrange':item.status==1,'bgGreen':item.status==3,'bgGrey':item.status==2,'bg1d95b9':item.status==4}" class="colfff rbtn relative mb10" v-for="(item,index) in menudataTwoCate"  @click="clickGoodsTwoCate(item,index);"  @dblclick="(item.status!=4&&currentManageActionTypeIndex==0)&&gtouchstart(item,index,2);(item.status==4||currentManageActionTypeIndex==1)&&popQuantityBox(item,index,2);">
								<div :class="item.status==1||item.status==2?'blink':''">
									<div>{{item.guige_name}}</div>
									<div>{{item.finish_quantities}}/{{item.sum_quantities}}{{item.unit_en}}</div>
									<img v-if="item.is_lock==1" src="__STATIC__/product/img/suo.png" class="suo"/>
								</div>
							</div>
<!--							<div class="bgGrey colfff rbtn">-->
<!--								<div class="textLeft f25">5mm</div>-->
<!--								<div class="textCenter maT10 F26">15/78kg</div>-->
<!--							</div>-->
<!--							<div class="bgdarkGrey colfff rbtn">-->
<!--								<div class="textLeft f25">5mm</div>-->
<!--								<div class="textCenter maT10 F26">15/78kg</div>-->
<!--							</div>-->
<!--							<div class="bgOrange colfff rbtn">-->
<!--								<div class="textLeft f25">5mm</div>-->
<!--								<div class="textCenter maT10 F26">15/78kg</div>-->
<!--							</div>-->
<!--							<div class="bgGreen colfff rbtn">-->
<!--								<div class="blink">-->
<!--									<div class="textLeft f25">5mm</div>-->
<!--									<div class="textCenter maT10 F26">15/78kg</div>-->
<!--								</div>-->
<!--							</div>-->
						</div>
<!--						<div class="flexbox2 rsection2">-->
<!--							<div class="rbtn2 bgdarkGrey">-->
<!--								1kg-->
<!--							</div>-->
<!--							<div class="rbtn2 bgOrange">-->
<!--								1kg-->
<!--							</div>-->
<!--						</div>-->
						<!-- 下面开始 -->
						<div class="rsection3 bgfff F20 J_main_order" style="display: flex;flex-direction: column;" :style="mainOrderHeight">
							<!-- 头部 -->
							<div class="flexbox1 pa20">
								<div class="flexbox2">
									<div class="flexbox1 xxBox" :class="{'bgFD6921 colfff':wccSort==0}" @click.stop="tab(0)">
										SEQ No<img src="__STATIC__/product/img/xxx.png" class="xxx"/>
									</div>
									<div class="flexbox1 xxBox" :class="{'bgFD6921 colfff':wccSort==1}" @click.stop="tab(1)">
										Processing<img src="__STATIC__/product/img/xxx.png" class="xxx"/>
									</div>
									<div class="flexbox1 xxBox" :class="{'bgFD6921 colfff':wccSort==2}" @click.stop="tab(2)">
										Processed<img src="__STATIC__/product/img/xxx.png" class="xxx"/>
									</div>
								</div>
								<div class="flexbox2 relative hand">
									<span @click="popKeyboard">
										<span v-if="userName">i am {{userName}}</span>&nbsp;&nbsp;
										<img src="__STATIC__/product/img/suo2.png" class="suo2"/>
									</span>
									<span class="colFD6921" v-if="isShowLoginOut" @click="LogOut" style="margin-left:25px;">&nbspLogout</span>
								</div>
							</div>
							<!-- 主体部分 -->
							<div class="mainBox J_main_box F20" style="flex: auto;">
								<div class="flexbox1 mb15" v-for="(item,index) in handleListSort">
									<div class="log" @click="log(item,index)">
										<img src="__STATIC__/product/img/log.png">
									</div>
									<div class="flexbox1 pa5-10 w70" :class="index%2==0?'bgFFF7F3':'bgF0FBFB'">
										<div class="flexbox2">
											<div class="col666 F36" style="width: 50px;">{{item.logistic_sequence_No}}</div>
											<div class="col666" style="width: 350px;">{{item.nickname}}</div>
										</div>
										<div class="flexbox2">
											<img src="__STATIC__/product/img/disable.png" class="numicon" v-if="item.new_customer_buying_quantity==0"/>
											<img src="__STATIC__/product/img/reduce.png" class="numicon" @click="editQuantity(item,index,'-',$event)" v-else/>
											<input class="inputW F20 J_edit_quantity" v-model="item.new_customer_buying_quantity" type="text" :disabled="item.is_lock!=1||item.lock_type!=1||item.is_producing_done==1" @focus="focusEvent($event)" @keyup="handleInput2" @keypress.enter="editQuantity(item,index,'enter',$event)"/><span class="col666">kg</span>&nbsp;&nbsp;
											<img src="__STATIC__/product/img/add.png" class="numicon" @click="editQuantity(item,index,'+',$event)"/>
										</div>
									</div>
									<div class="flexbox1 pa18-0 F20" :class="index%2==0?'bgFFF7F3':'bgF0FBFB'">
										<div class="flexbox2">
											<img src="__STATIC__/product/img/disable.png" class="numicon" v-if="item.num1==0"/>
											<img src="__STATIC__/product/img/reduce.png" class="numicon" @click="printLable(item,index,'-',$event)" v-else/>
											<input class="inputW F20 J_edit_lable" v-model="item.num1" type="number" :disabled="item.is_lock!=1||item.lock_type!=1||item.is_producing_done==1" @focus="focusEvent($event)" @keyup="handleInput" @keypress.enter="printLable(item,index,'enter',$event)"/>
											<img src="__STATIC__/product/img/add.png" class="numicon" @click="printLable(item,index,'+',$event)"/>
										</div>
										<img src="__STATIC__/product/img/echo.png" class="echo" @click="print(item,index)"/>
									</div>
									<div class="flexbox1">
										<div class="rbtn5 F20 bg1d95b9 colfff relative" v-if="item.is_producing_done==1" @click="showOperateQuantityLog(item,index)" style="margin-right: 10px;">
											processed Log
										</div>
										<div class="rbtn3 F20 bg34C079 colfff relative" v-if="item.is_producing_done==1" @click="handle(index)">
											processed
										</div>
										<div class="rbtn3 F22 bgFFF7F3 col5e5656" v-else-if="item.is_producing_done==0&&item.is_lock==0" @click="changeStatus(item,index)">
											waitting lock
										</div>
										<div v-else class="rbtn3 F22 colfff" :class="{'bgFD6921':item.is_producing_done==0&&item.is_lock==1&&item.lock_type==1,'bgGrey':item.is_producing_done==0&&item.is_lock==1&&item.lock_type==2,'bgFD6921 blink':item.is_producing_done==2&&item.is_lock==1&&item.lock_type==1,'bgGrey blink':item.is_producing_done==2&&item.is_lock==1&&item.lock_type==2}" @click="changeStatus(item,index)">
											<span v-if="item.is_producing_done==0">waitting process</span>
											<span v-else>processing</span>
										</div>
									</div>
								</div>
							</div>
						</div>
						<!-- 下面结束 -->
					</div>
				</div>
				<div v-show="currentPage==2" class="rightCateMenu">
					<div class="F20">
						<div v-if="currentMenu>1">
							<div style="padding:15px 0;font-weight:bold;" class="bgfff mb15 textCenter F26 colFD6921 relative hand" v-show="isHasCateData" @click="goto([],0,'.J_cate_'+menudata[currentMenu]['id'],2)">
								<img src="__STATIC__/product/img/return2.png" style="width:11px;position:absolute;left:15px;"/>
								Back to this category
							</div>
							<div class="flexbox2">
								<div class="J_set_top" v-for="(item,index) in goods"  @dblclick="selectProductPlaning(item,index,1,$event)">
									<div class="rbtn4 bgFFF7F3 col5e5656">
										<div>{{item.menu_en_name}}</div>
										<div>{{item.menu_id}}</div>
									</div>
									<div class="F22 col000 flexbox4 bgfff zdBox" v-if="item.is_set_top==1" @click="cancelZD(item,index,2)">
										<img src="__STATIC__/product/img/zd.png" class="zd"/>
										unpin
									</div>
									<div class="F22 col000 flexbox4 bgfff zdBox" v-else @click="cancelZD(item,index,1)">
										<img src="__STATIC__/product/img/zd2.png" class="zd"/>
										top
									</div>
								</div>
							</div>
						</div>
						<div v-else-if="currentMenu==1" class="flexbox2">
							<div class="J_set_top" v-for="(item,index) in goods">
								<div class="rbtn4" :class="{'bgdarkGrey colfff':item.is_progress==2,'bgFFF7F3 col5e5656':item.is_progress==1&&item.status==0,'bgFFF7F3 col5e5656':item.is_progress==1&&item.status==0,'bgFD6921 blink':item.is_progress==1&&item.status==1,'bg34C079':item.is_progress==1&&item.status==3,'bgGrey blink':item.is_progress==1&&item.status==2,'bg1d95b9 colfff':item.status==4}" @dblclick="selectProductPlaning(item,index,1,$event)">
									<div :id="item.is_progress">{{item.menu_en_name}}</div>
									<div>{{item.menu_id}}</div>
								</div>
								<div class="F22 col000 flexbox4 bgfff zdBox" @click="cancelZD(item,index,2,'top')">
									<img src="__STATIC__/product/img/zd.png" class="zd"/>
									unpin
								</div>
							</div>
						</div>
						<div v-else>
							<div v-for="(item,index) in goods" class="J_current_panel">
								<div class="F20 hand cater mb10 bgFD6921 colfff" @click="goto(item,index,'.J_cate_'+item['cate_id'],2)">{{item['category_en_name']}}</div>
								<div class="flexbox2">
									<div v-for="(item1,index1) in item['data']" :class="{'bgFFF7F3 col5e5656':item1.status==0,'bgFFF7F3 col5e5656':item1.status==0,'bgFD6921':item1.status==1,'bgGrey':item1.status==2,'bg34C079 colfff':item1.status==3,'bg1d95b9 colfff':item1.status==4}" class="lbtn3 cateWH relative pdbtn J_current_panel_item" @click="goto(item,index,'#anchor-'+item1.product_id)" @dblclick="selectProductPlaning(item1,index1,2,$event)">
										<div :class="{'blink':item1.status==1||item1.status==2}">
											<div>{{item1.menu_en_name}}</div>
											<div>{{item1.finish_quantities}}/{{item1.sum_quantities}}{{item1.unit_en}}</div>
											<div>{{item1.menu_id}}</div>
											<div class="userBox">
												<span class="F14" v-for="item2 in item1.operator_user">{{item2.user_name}}</span>
											</div>
											<img v-if="item1.is_has_two_cate==2&&item1.is_lock==1" src="__STATIC__/product/img/suo.png" class="suo"/>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- 主体部分结束 -->

		<div class="mask" v-if="iskeyboardShow" @click="closeKeyboard">
			<div class="keyboardBox">
				<div class="tips" v-show="isPsdCorrect">{{message}}</div>
				<div v-if="isShowTypePincode1">
					<div class="keyboard input J_pincode" :class="{'keyboardBorder':focusDatype==10}" tabindex="0" :placeholder="placeholderPincode" @focus="focusData($event,10,1)">{{psd2}}</div>
				</div>
				<div v-if="isShowTypePincode2">
					<div class="keyboard input J_n_pincode" :class="{'keyboardBorder':focusDatype==20}" tabindex="0" :placeholder="placeholderNPincode" @focus="focusData($event,20,2)">{{npsd2}}</div>
					<div class="keyboard input J_nr_pincode" :class="{'keyboardBorder':focusDatype==30}" tabindex="0" :placeholder="placeholderNRPincode" @focus="focusData($event,30,2)">{{nrpsd2}}</div>
				</div>
				<div v-if="isShowTypePincode3">
					<div class="keyboard input J_o_pincode" :class="{'keyboardBorder':focusDatype==10}" tabindex="0" :placeholder="placeholderOPincode" @focus="focusData($event,10,3)">{{psd2}}</div>
					<div class="keyboard input J_n_pincode" :class="{'keyboardBorder':focusDatype==20}" tabindex="0" :placeholder="placeholderNPincode" @focus="focusData($event,20,3)">{{npsd2}}</div>
					<div class="keyboard input J_nr_pincode" :class="{'keyboardBorder':focusDatype==30}" tabindex="0" :placeholder="placeholderNRPincode" @focus="focusData($event,30,3)">{{nrpsd2}}</div>
				</div>
				<div>
					<div class="textRight w100 bgF7F7F7 save" :class="{'flexbox1':!isShowTypePincode2}">
						<span v-if="!isShowTypePincode2" @click.stop="editPincode">{{editText}}</span>
						<span @click.stop="save">login</span>
					</div>
					<div class="flexbox1 pa10" style="background: #F2F2F2;">
						<div class="textCenter number" v-for="number in numberList" @click.stop="clickNum(number)">{{number}}</div>
						<div class="textCenter number" @click.stop="deletePsd">
							<img src="__STATIC__/product/img/delete.png" class="delete">
						</div>
					</div>
				</div>
			</div>
		</div>
		<img v-if="isLoading" src="__STATIC__/product/img/loading.gif" class="loading"/>
		<!-- 公用弹出框 -->
		<div class="mask J_pop_message zi2" v-show="isShowMessage">
			<div class="popMessage">
				{{popMessage}}
			</div>
		</div>
		<!-- 填写数量弹出框 -->
		<div class="mask pa18-0 F20 bgFFF7F3 zi1" v-show="isQuantityShow">
			<div class="popQuantity">
				<div class="chaClose" @click="closeQuantity">×</div>
				<div class="mb10">Processing quantity</div>
				<div class="flexbox2">
					<input class="inputW2 F20 J_add_quantity" type="text" v-model="quantity" @focus="focusEvent($event)" @keyup="handleInput2"/>
				</div>
				<div class="maT10">
					<button type="submit" class="btn-primary ml160" @click="saveQuantity(1)">Save</button>
				</div>
			</div>
		</div>
		<!-- 日志记录-->
		<div class="mask" v-show="isShowLog">
			<div class="logContent F18">
				<div class="chaClose" @click="closeLog">×</div>
				<table>
					<thead>
						<tr>
							<th style="width: 180px;">Operation time</th>
							<th style="width: 100px;">Username</th>
							<th style="width: 80px;">Number</th>
							<th style="width: 80px;">Quantity</th>
							<th style="width: 300px;">Operate</th>
						</tr>
					</thead>
					<tbody>
						<tr v-for="item in logData">
							<td style="width: 180px;">{{item.created_at}}</td>
							<td style="width: 100px;">{{item.name}}</td>
							<td style="width: 80px;">{{item.userId}}</td>
							<td style="width: 80px;" v-if="item.behavior_type==5||item.behavior_type==6||item.behavior_type==7">{{item.new_customer_buying_quantity}}</td>
							<td style="width: 80px;" v-else>--</td>
							<td style="width: 300px;">{{item.behavior_type_desc}}</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
		<!-- 加工数量记录-->
		<div class="mask" v-show="isShowOperateQuantityLog">
			<div class="operateLogBox">
				<div class="chaClose" @click="closeLog">×</div>
				<div class="mb15 F20 J_operatelog_item" v-for="item in operateQuantityLog">
					<span class="boxl">{{item.user_name}}</span>
					<input type="text" class="inputW3 F20" v-model="item.quantity" @focus="focusEvent($event,'operatelog')" @keyup="handleInput2($event,'operatelog')">
				</div>
				<div class="maT40 F20">
					<span class="sumBox">Total {{total}}</span>
					<span class="sumBox">Filled in <span class="J_fillInSum colred">0</span></span>
					<button class="btn-pos btn-primary-disable J_quantity_submit" disabled @click="saveOperatorQuantityLog">Submit</button>
				</div>
			</div>
		</div>
	</div>
	</body>
	<script>
		new Vue({
			el:"#main",
			data:{
				//内容区域高度 = 当前屏幕高度 - 头部高度 - 底部高度
				fullHeight: document.documentElement.clientHeight,//获取屏幕高度
				isLoading:false,
				isShowMessage:false,
				popMessage:'',//弹层提示信息
				currentHandlePop:-1,
				productType: ['pre product','orders'],//加工单类型
				currentProductTypeIndex: 0,//加工单类型默认选中
				manageActionType: ['producing','planning'],//管理员操作类型
				currentManageActionTypeIndex: 0,//管理员操作类型默认选中
				currentDay:0,
				current2:0,
				current3:0,
				currentOperatorIndex:0,//当前选中操作员索引值
				choseDate1:'',
				choseDate2:'',
				choseDate3:'',
				logistic_delivery_date:'',//筛选日期
				operator_user_id:'',//筛选操作员
				logistic_truck_No:'',//筛选司机
				product_id:0,//当前选择的产品id
				guige1_id:'',//当前选择的规格id
				list:[],
				list2:[{"id":"","name":"All customers"}],
				list3:[{"logistic_truck_No":"","name":"All Drivers&Truck","truck_name":"","plate_number":""}],
				list4:[{"user_id":"","user_name":"All Operator"}],
				operatorOrderDoneNum:0,//对应操作员已完成订单数
				operatorOrderNum:0,//对应操作员的全部订单数
				operatorOrderDoneNum:0,//对应操作员已完成订单数
				operatorOrderNum:0,//对应操作员全部订单数
				driverOrderDoneNum:0,//对应司机已完成订单数
				driverOrderNum:0,//对应司机全部订单数
				orderDoneNum:0,//订单已完成数
				orderNum:0,//订单总数
				num:20,
				whichPopShow:-1,
				currentPage:1,  // 1表示1级页面 2是2级页面
				menudata:[{"id":-1,"category_en_name":"Current Plan"},{"id":0,"category_en_name":"Top"}],
				menudata2:[],//加工产品
				currentContent:0,//未排序的数据，当前选中的产品索引id
				menudata2Sort:[],//排序后的加工产品，为保证初始化的数据不变
				menudata2SortIndex:0,//默认获取的产品键值
				menudataTwoCate:[],//二级产品类目
				menudataTwoCateIndex:0,//默认获取的二级产品类目键值
				handleList:[],
				handleListSort:[],//加工明细数据，为保证初始化的数据不变
				wccSort:0,//加工明细排序类型
				wccSortType:1,//排序方向 1正向 2反向
				currentMenu:0,
				isHandle:0,
				goods:[],
				numberList:[1,2,3,4,5,6,7,8,9,'.',0],
				isPsdCorrect:false,
				iskeyboardShow:false,
				isQuantityShow:false,
				psd:'',
				psd2:'',
				npsd:'',
				npsd2:'',
				nrpsd:'',
				nrpsd2:'',
				placeholderPincode:'',
				placeholderNPincode:'New pincode',
				placeholderNRPincode:'Re-enter pincode',
				placeholderOPincode:'Old pincode',
				focusDatype:'',//光标所在的位置，获取到光标所在位置，给哪个输入框输入内容
				pincodeType:'',//pincode登录内容 1-pincode登录 2-创建pincode并登录 3-修改pincode并登录
				message: '',//pincode登录错误信息
				isDisable:false, //控制按钮多次点击禁用
				isClock:false, //是否上锁，禁止点击
				timeLock:0,//上锁时间
				timer:null,//定时器
				userName:'',//登录用户信息
				businessName:'',//商家名
				intervalId:null,//定时器id，刷新数据使用
				lastTime: null, //最后一次点击的时间
				currentTime: null, //当前点击的时间
				timeOut: 10 * 60 * 1000,//设置超时时间： 10分钟
				isShowLoginOut:false,//是否显示退出登录按钮
				isShowTypePincode1:false,//显示pincode输入框样式-1.pincode登录是否显示
				isShowTypePincode2:false,//显示pincode输入框样式-创建pincode是否显示
				isShowTypePincode3:false,//显示pincode输入框样式-修改pincode是否显示
				editText:'setting',//键盘文字显示
				timeOutEvent:null,//弹层提示定时器
				timeOutLock:null,//获取锁定结果定时器
				lockData:[],//锁定参数
				lockReturnData:null,//上锁参数
				mainOrderHeight:'',
				clickTimer:null,//定时器
				isHasCateData:false,//分类页，Back to this category,判断当前加工产品是否有该类产品
				isManager:2,//是否是管理员 1是 2否
				userInfo:[],//当前登录用户信息
				quantity:0,//新的加工数量
				oldQuantity:0,//旧的加工数量
				currentInterTime:null,//获取锁定结果的开始时间
				interTimeOut: 1.5 * 60 * 1000,//设置锁定结果超时时间： 1.5分钟
				isShowLog:false,//是否显示日志信息
				logData:[],//日志数据
				isShowOperateQuantityLog:false,//是否显示加工数量记录表
				operateQuantityLog:[],//加工数量记录
				oqlActionType:1,//加工数量记录动作 1新增 2修改
				total:0,//总加工数量
				operateQuantityLogIndex:0,//获取当前显示加工日志的索引值
			},
			mounted: function () {
				//获取pincode显示得到样式
				var _this = this
				_this.isLoading=true
				getData("{:url('/product/loginInfo')}", '', function (res) {
					console.log('登录信息----',res);
					_this.isLoading=false
					//获取登录信息
					_this.userInfo = res.result.user_info
					if (res.result.user_name) {
						_this.userName = res.result.user_name
						_this.businessName = res.result.business_name
						_this.isShowLoginOut = true
						_this.isManager = res.result.is_manager
						//管理员登录默认进入二级页面
						if(res.result.is_manager == 1){
							_this.currentPage = 2
							_this.returnPage(2)
						}
						if(res.result.is_manager == 2){
							_this.list4 = res.result.user_info
							_this.currentOperatorIndex=0
							_this.operator_user_id = res.result.user_info[0]['user_id']
						}
					} else {
						//获取不到登录信息则弹出登录框
						_this.iskeyboardShow = true
						_this.isClock = true
					}
					if(res.result.is_has_pincode==1){
						_this.isShowTypePincode1 = true
						_this.pincodeType = 1 //默认显示pincode登录
						_this.focusDatype = 10 //默认可直接输入密码
					} else {
						_this.isShowTypePincode2 = true
						_this.pincodeType = 2 //默认显示创建pincode
					}
				});
				//获取加工日期
				_this.isLoading=true
				var data = {
					'logistic_delivery_date':localStorage.logistic_delivery_date
				}
				getData("{:url('/product/prepDeliveryDate')}", data, function (res) {
					console.log(res)
					_this.list = res.result.list
					_this.choseDate1 = res.result.default
					_this.currentDay = res.result.default_k
					_this.logistic_delivery_date = _this.choseDate1.hasOwnProperty('logistic_delivery_date')?_this.choseDate1.logistic_delivery_date:''
					//获取初始化数据
					if(_this.logistic_delivery_date){
						localStorage.logistic_delivery_date = _this.logistic_delivery_date
						_this.inidata()
					}
					_this.isLoading=false
				});
			},
			methods:{
				//获取初始化数据 type:refresh来源与数据刷新
				inidata(type='') {
					var _this = this
					if(!(_this.logistic_delivery_date>0)){
						return
					}
					var data = {
						"logistic_delivery_date":_this.logistic_delivery_date,
						"operator_user_id":_this.operator_user_id,
						"goods_sort":_this.isHandle,
						"type":type
					}
					console.log('初始化参数---',data)
					getData("{:url('/product/prepInidata')}", data, function (res) {
						console.log('初始化结果---',res)
						res = res.result
						_this.operatorOrderDoneNum = res.operator_order_count.order_done_count
						_this.operatorOrderNum = res.operator_order_count.order_count
						_this.orderDoneNum = res.all_order_count.order_done_count
						_this.orderNum = res.all_order_count.order_count
						if(type == 'refresh'){
							//更新数据时，保持原数据位置不变
							_this.menudata2=_this.sortAccordingOtherData(res.goods,_this.menudata2,'product_id')
							_this.menudata2Sort=_this.sortAccordingOtherData(res.goods,_this.menudata2Sort,'product_id')
							console.log('刷新后产品数据-----',_this.menudata2Sort);
						}else{
							_this.menudata2=_this.menudata2Sort=_this.menudataTwoCate=_this.handleList=_this.handleListSort=[]
							_this.menudataTwoCateIndex = 0
							_this.menudata2 = res.goods
							_this.menudata2Sort = res.goods
						}
						if(_this.menudata2.length > 0){
							//获取当前默认选中的产品id
							if(_this.product_id==0){
								_this.product_id=_this.menudata2[0].product_id
								_this.currentContent=0
								_this.menudata2SortIndex=0
							}else{
								for(var i in _this.menudata2){
									if(_this.menudata2[i]['product_id']==_this.product_id){
										_this.currentContent=i
										_this.menudata2SortIndex=i
										break;
									}
								}
							}
							if(_this.menudata2[_this.currentContent].is_has_two_cate == 1){
								//获取默认显示的二级类目
								_this.twoCateGoods(_this.product_id,type)
							}else{
								//vue获取顶部位置方法
								_this.$nextTick(()=> {
									var order_top = $('.J_main_order').offset().top+'px'
									_this.mainOrderHeight = `height: calc(100vh - ${order_top});`
								})
								_this.menudataTwoCate = []
								//默认加载第一个产品的第一个规格的所有加工明细
								_this.productOrder(_this.product_id,'',type)
							}
						}
					});
				},
				//获取二级类目
				twoCateGoods(product_id,type=''){
					var _this = this
					var data = {
						"logistic_delivery_date":_this.logistic_delivery_date,
						"operator_user_id":_this.operator_user_id,
						"product_id":product_id
					}
					getData("{:url('/product/prepChangeGoods')}", data, function (res) {
						res = res.result
						if(type == 'refresh'){
							//更新数据时，保持原数据位置不变
							_this.menudataTwoCate=_this.sortAccordingOtherData(res.goods_two_cate,_this.menudataTwoCate,'guige1_id')
						}else {
							_this.menudataTwoCate = []
							_this.menudataTwoCate = res.goods_two_cate
						}
						console.log('二级类目产品数据-----',_this.menudataTwoCate)
						//vue获取顶部位置和左侧位置的方法
						_this.$nextTick(()=> {
							var order_top = $('.J_main_order').offset().top+'px'
							_this.mainOrderHeight = `height: calc(100vh - ${order_top});`
						})
						if(_this.menudataTwoCate.length > 0){
							//获取当前默认选中的产品id
							if(_this.guige1_id==''){
								_this.guige1_id = _this.menudataTwoCate[0].guige1_id
							}
							//默认加载第一个产品的第一个规格的所有加工明细
							_this.productOrder(product_id,_this.guige1_id,type)
						}else{
							_this.isLoading=false
						}
					});
				},
				//获取产品加工明细单
				productOrder(product_id,guige1_id='',type=''){
					var _this = this
					var data = {
						"logistic_delivery_date":_this.logistic_delivery_date,
						"operator_user_id":_this.operator_user_id,
						"product_id":product_id,
						"guige1_id":guige1_id,
						"wcc_sort":_this.wccSort,
						"wcc_sort_type":_this.wccSortType
					}
					console.log('获取产品加工明细单参数-----',data)
					getData("{:url('/product/prepProductOrderList')}", data, function (res) {
						_this.isLoading=false
						res = res.result
						if(type == 'refresh'){
							//更新数据时，保持原数据位置不变
							//1.更新数据时判断修改加工数量和打印标签是否获取焦点，获取焦点时加工数量不更新
							var eq_length = $('.J_main_box .J_edit_quantity').length
							for(var i=0;i<eq_length;i++){
								var isFocus=$('.J_main_box .J_edit_quantity').eq(i).is(":focus")
								if(isFocus){
									for(var j in res.order){
										if(res.order[j]['id'] == _this.handleListSort[i]['id']){
											res.order[j]['new_customer_buying_quantity'] = $('.J_main_box .J_edit_quantity').eq(i).val()
										}
									}
								}
							}
							var lq_length = $('.J_main_box .J_edit_lable').length
							for(var i=0;i<lq_length;i++){
								// var isFocus=$('.J_main_box .J_edit_lable').eq(i).is(":focus")
								// if(isFocus){
									for(var j in res.order){
										if(res.order[j]['id'] == _this.handleListSort[i]['id']){
											res.order[j]['num1'] = $('.J_main_box .J_edit_lable').eq(i).val()
										}
									}
								// }
							}
							_this.handleList=_this.sortAccordingOtherData(res.order,_this.handleList,'id')
							_this.handleListSort=_this.sortAccordingOtherData(res.order,_this.handleListSort,'id')
						}else{
							_this.handleList = []
							_this.handleListSort = []
							_this.handleList = res.order
							_this.handleListSort = res.order
						}
						console.log('获取产品加工明细单2222-----',_this.handleList)
					});
				},
				//goods_cate 产品类目 1一级类目  2二级类目
				//如果该产品只有一个规格，点击产品时，默认锁定第一个规格；如果规格数>1,则需要锁定规格
				gtouchstart(item,index,goods_cate){
					clearTimeout(this.clickTimer);  //首先清除计时器
					if(item.status == 4){
						this.popBox('Please place an order first')
						return
					}
					if(goods_cate == 1){
						if(this.menudata2SortIndex!=index){
							this.menudata2SortIndex=index
							this.product_id=item.product_id
							this.twoCateGoods(item.product_id)
						}
						if(item.is_has_two_cate==1){
							//如果该产品只有一个规格，点击产品时，默认锁定第一个规格；
							if(this.menudataTwoCate.length==1){
								item=this.menudataTwoCate[0]
								index=0
								goods_cate=2
							}
							if(item.status == 0&&this.menudataTwoCate.length>1){
								this.popBox('Please select a specification to lock')
								return
							}
							if(item.status == 1&&this.menudataTwoCate.length>1){
								this.popBox('you are processing this product')
								return
							}
						}
					}
					if(goods_cate == 2){
						if(this.menudataTwoCateIndex!=index){
							this.menudataTwoCateIndex=index
							this.product_id=item.product_id
							this.guige1_id=item.guige1_id
							this.productOrder(item.product_id,item.guige1_id)
						}
					}
					if(item.status == 2){
						this.popBox('This product has been locked by someone else')
						return
					}
					if(item.status == 3){
						this.popBox('This product has been processed')
						return
					}
					// this.timeOutEvent = setTimeout(()=>{
					// 	this.timeOutEvent = 0;
						//如果二级规格只有一个，点击产品时，默认锁定该规格
						var data = {
							"logistic_delivery_date":this.logistic_delivery_date,
							"product_id":item.product_id,
							"guige1_id":item.guige1_id>=0?item.guige1_id:0
						}
						console.log('获取锁定参数-----',data);
						var _this = this
						//产品的锁定状态,status -1-需要根据二级类目加工 0-未加工 1-自己正在加工 2-其他人正在加工 3-加工完成
						_this.isLoading=true
						if(item.status == 0){
							getData("{:url('/product/prepLockProduct')}", data, function (res) {
								console.log('获取锁定结果-----',res)
								if(res.status == 200){
									//记录过期时间
									_this.currentInterTime = new Date().getTime();
									_this.lockProductRes(res.result,item,index)
								} else {
									_this.isLoading=false
									_this.popBox(res.message)
									return
								}
							});
						}
						if(item.status == 1){
							getData("{:url('/product/prepUnlockProduct')}", data, function (res) {
								console.log('获取解锁结果-----',res)
								_this.isLoading=false
								if(res.status == 200){
									var is_has_product=0//判断该用户是否还有其他再加工的二级规格 0-没有 1-有正在加工的其他产品
									if(goods_cate==2){
										_this.menudataTwoCate[index]['status'] = 0
										_this.menudataTwoCate[index]['is_lock'] = 0
										//判断该用户是否还有其他再加工的二级规格，若没有，则将一级产品状态还原
										is_has_product=_this.isHasProduct()//0-没有 1-有正在加工的其他产品
									}
									if((goods_cate==2&&is_has_product==0)||goods_cate==1){
										_this.menudata2Sort[_this.menudata2SortIndex]['status'] = 0
										_this.menudata2Sort[_this.menudata2SortIndex]['is_lock'] = 0
										//修改原数组的值
										for(var i in _this.menudata2){
											if(_this.menudata2[i]['product_id'] == _this.menudata2Sort[_this.menudata2SortIndex].product_id){
												_this.menudata2[i]['status']=0
												_this.menudata2[i]['is_lock']=0
												break;
											}
										}
									}
									//修改对应的加工明细单为可处理
									$.each(_this.handleListSort,function(i,n){
										_this.handleList[i]['is_lock'] = 0
										_this.handleList[i]['lock_type'] = 0
										_this.handleListSort[i]['is_lock'] = 0
										_this.handleListSort[i]['lock_type'] = 0
									});
									//修改可编辑数量和标签数量为可编辑状态
									$('.J_edit_quantity').attr("disabled","disabled")
									$('.J_edit_lable').attr("disabled","disabled")
								} else {
									_this.popBox(res.message)
									return
								}
							});
						}
					// },2000);//这里设置定时器，定义长按2000毫秒触发长按事件
					return false;
				},
				//获取锁定结果
				lockProductRes(result,item,index){
					//获取锁定结果
					var data = {
						"uniqid":result.uniqid
					}
					// console.log('获取队参数----',data);
					var _this=this
					getData("{:url('/product/prepLockProductResult')}", data, function (res) {
						console.log('获取队列结果----',res);
						if (res.status == 119) {
							_this.isLoading=true
							//判断上次最后一次点击的时间和这次点击的时间间隔是否大于1.5分钟
							if(new Date().getTime() - _this.currentInterTime > _this.interTimeOut) {
								clearTimeout(_this.timeOutLock);
								_this.isLoading=false
								_this.popBox('The server is busy, please try again later')
							} else {
								_this.timeOutLock = setTimeout(() => {
									// console.log('定时获取结果------');
									_this.lockProductRes(result,item,index)
								}, 100);
							}
						} else {
							clearTimeout(_this.timeOutLock);
							_this.isLoading=false
							//锁定成功--上锁
							if(res.status == 200){
								//修改该产品的状态为锁定,status -1-需要根据二级类目加工 0-未加工 1-自己正在加工 2-其他人正在加工 3-加工完成
								if(item['guige1_id'] > 0){
									_this.menudataTwoCate[index]['status'] = 1
									_this.menudataTwoCate[index]['is_lock'] = 1
								}
								_this.menudata2Sort[_this.menudata2SortIndex]['status'] = 1
								_this.menudata2Sort[_this.menudata2SortIndex]['is_lock'] = 1
								//修改原数组的值
								for(var i in _this.menudata2){
									if(_this.menudata2[i]['product_id'] == _this.menudata2Sort[_this.menudata2SortIndex].product_id){
										_this.menudata2[i]['status']=1
										_this.menudata2[i]['is_lock']=1
										break;
									}
								}
								//修改对应的加工明细单为可处理
								$.each(_this.handleListSort,function(i,n){
									_this.handleList[i]['is_lock'] = 1
									_this.handleList[i]['lock_type'] = 1
									_this.handleListSort[i]['is_lock'] = 1
									_this.handleListSort[i]['lock_type'] = 1
								});
								//修改可编辑数量和标签数量为可编辑状态
								$('.J_edit_quantity').removeAttr("disabled")
								$('.J_edit_lable').removeAttr("disabled")
							}else{
								_this.popBox(res.message)
								return
							}
						}
					})
				},
				//如果手指有移动，则取消所有事件，此时说明用户只是要移动而不是长按
				gtouchmove(item,index){
					// clearTimeout(this.timeOutEvent);//清除定时器
					// this.timeOutEvent = 0;
					// alert("取消了");
				},
				//手释放，如果在5000毫秒内就释放，则取消长按事件，此时可以执行onclick应该执行的事件
				gtouchend(item,index){
					// clearTimeout(this.timeOutEvent);//清除定时器
					// if(this.timeOutEvent!==0){
					// 	//这里写要执行的内容（尤如onclick事件）
					// 	console.log("你这是点击，不是长按");
					// }
					// return false;
				},
				// 定时刷新数据函数
				dataRefreh() {
					// 计时器正在进行中，退出函数
					if (this.intervalId != null) {
						return;
					}
					// 计时器为空，操作
					this.intervalId = setInterval(() => {
						// console.log("刷新",new Date());
						this.currentTime = new Date().getTime();
						//更新数据
						if(this.logistic_delivery_date && this.currentPage == 1) {
							this.inidata('refresh')
						}
						//判断上次最后一次点击的时间和这次点击的时间间隔是否大于10分钟
						if(this.currentTime - this.lastTime > this.timeOut) {
							//超过操作时间，调用退出pincode接口，并弹出pincode登录框+上锁
							this.loginOutPincode()
						}
					}, 5000);
				},
				//退出登录公共操作方法
				loginOutPincode(){
					var _this = this
					getData("{:url('/product/loginOutPincode')}", '', function (res) {
						_this.iskeyboardShow = true
						_this.isClock = true
						_this.psd=_this.psd2=_this.npsd=_this.npsd2=_this.nrpsd=_this.nrpsd2=''
						_this.message=''
						_this.isPsdCorrect=false
						_this.isShowLog=false
						_this.clearTime()
						_this.isLoading=false
					});
				},
				// 停止定时器
				clear() {
					clearInterval(this.intervalId); //清除定时刷新数据计时器
					this.intervalId = null //设置为null
					clearInterval(this.timer);//清除锁屏倒计时计时器
					this.timer = null
					clearTimeout(this.timeOutLock);//清除锁定计时器
					this.timeOutLock = null
					clearTimeout(this.timeOutEvent);//清除弹窗提示定时器
					this.timeOutEvent=null
					clearTimeout(this.clickTimer);//判断点击事件计时器
					this.clickTimer=null
				},
				// 切换用户/上锁时需要清除的定时器
				clearTime() {
					clearInterval(this.timer);//清除锁屏倒计时计时器
					this.timer = null
					clearTimeout(this.timeOutLock);//清除锁定计时器
					this.timeOutLock = null
					clearTimeout(this.timeOutEvent);//清除弹窗提示定时器
					this.timeOutEvent=null
					clearTimeout(this.clickTimer);//判断点击事件计时器
					this.clickTimer=null
				},
				//判断用户10分钟内是否有操作，无操作则需要上锁，弹出pincode登录框
				isDo() {
					this.lastTime = new Date().getTime(); //如果在10分钟内点击，则把这次点击的时间记录覆盖掉之前存的最后一次点击的时间
					console.log('最后一次点击时间----',this.lastTime);
				},
				//修改处理状态 is_producing_done 0-未加工 1-加工完成 2-正在加工中
				changeStatus(item,index){
				    console.log(item)
					var data = {
						"id": item.id
					}
					if(item.is_producing_done == 0){
						if(item.is_lock!=1){
							this.popBox('Please lock the product')
							return
						}
						if(item.lock_type!=1){
							this.popBox('Product has been locked by someone else')
							return
						}
						data.is_producing_done = 2;
					} else if(item.is_producing_done == 2) {
						data.is_producing_done = 1;
					} else {
						data.is_producing_done = 0;
					}
					console.log('处理状态参数----',data)
					var _this = this
					_this.isLoading=true
					getData("{:url('/product/prepChangeProductOrderStatus')}", data, function (res) {
						console.log('处理状态结果----',res)
						_this.isLoading=false
						if (res.status == 200) {
							_this.handleListSort[index].is_producing_done = data.is_producing_done
							//如果返回继续加工产品，如果该规格或者该产品之前状态是已加工完成，需要修改锁定状态为当前用户锁定
							if(data.is_producing_done == 0) {
								if(item.guige1_id>0&&_this.menudataTwoCate[_this.menudataTwoCateIndex]['status']==3||item.guige1_id==0&&_this.menudata2Sort[_this.menudata2SortIndex]['status']==3) {
									_this.handleListSort[index]['is_lock'] = 1
									_this.handleListSort[index]['lock_type'] = 1
								}
							}
							//修改原数组的值
							for(var i in _this.handleList) {
								if(_this.handleList[i]['id'] == _this.handleListSort[index].id){
									_this.handleList[i].is_producing_done = data.is_producing_done
									_this.handleList[i].is_lock = _this.handleListSort[index]['is_lock']
									_this.handleList[i].lock_type = _this.handleListSort[index]['lock_type']
									break;
								}
							}
							_this.currentHandlePop=-1
							if(data.is_producing_done != 2) {
								//修操作员对应的订单数量
								_this.operatorOrderDoneNum = _this.numAdd(_this.operatorOrderDoneNum, res.result.operator_order_inc_num)
								//修改总订单数
								_this.orderDoneNum = _this.numAdd(_this.orderDoneNum, res.result.order_inc_num)
								if (item.guige1_id > 0) {
									//增加加工数量
									if (data.is_producing_done == 1) {
										_this.menudataTwoCate[_this.menudataTwoCateIndex]['finish_quantities'] = _this.numAdd(_this.menudataTwoCate[_this.menudataTwoCateIndex]['finish_quantities'], item.customer_buying_quantity)
									} else {
										_this.menudataTwoCate[_this.menudataTwoCateIndex]['finish_quantities'] = _this.numSub(_this.menudataTwoCate[_this.menudataTwoCateIndex]['finish_quantities'], item.customer_buying_quantity)
									}
									//如果当前规格的所有加工明细都加工完，则需要将该规格状态变为绿色
									if (res.result.is_product_guige1_done == 1) {
										// console.log('规格已全部加工完成---',_this.menudataTwoCate,_this.menudataTwoCateIndex)
										_this.menudataTwoCate[_this.menudataTwoCateIndex]['status'] = 3
										_this.menudataTwoCate[_this.menudataTwoCateIndex]['is_lock'] = 0
										//如果还有产品未加工完成，判断当前是否还有锁定，没有锁定，则将产品改为未锁定状态
										if (res.result.is_product_all_done != 1) {
											//判断该用户是否还有其他再加工的二级规格，若没有，则将一级产品状态还原
											var is_has_product = _this.isHasProduct()//0-没有 1-有正在加工的其他产品
											if (is_has_product == 0) {
												_this.menudata2Sort[_this.menudata2SortIndex]['status'] = 0
												_this.menudata2Sort[_this.menudata2SortIndex]['is_lock'] = 0
												//修改原数组的值
												for (var i in _this.menudata2) {
													if (_this.menudata2[i]['product_id'] == _this.menudata2Sort[_this.menudata2SortIndex].product_id) {
														_this.menudata2[i]['status'] = 0
														_this.menudata2[i]['is_lock'] = 0
														break;
													}
												}
											}
										}
									}
									//如果产品规格状态为已处理完成，还原时将原状态还原
									if (data.is_producing_done == 0) {
										if (_this.menudataTwoCate[_this.menudataTwoCateIndex]['status'] == 3) {
											_this.menudataTwoCate[_this.menudataTwoCateIndex]['status'] = 1
											_this.menudataTwoCate[_this.menudataTwoCateIndex]['is_lock'] = 1
										}
										//如果一级规格没被锁定时，同时锁定一级规格
										if (_this.menudata2Sort[_this.menudata2SortIndex]['status'] != 1) {
											_this.menudata2Sort[_this.menudata2SortIndex]['status'] = 1
											_this.menudata2Sort[_this.menudata2SortIndex]['is_lock'] = 1
											_this.menudata2Sort[_this.menudata2SortIndex]['isDone'] = 0
											//修改原数组的值
											for (var i in _this.menudata2) {
												if (_this.menudata2[i]['product_id'] == _this.menudata2Sort[_this.menudata2SortIndex].product_id) {
													_this.menudata2[i]['status'] = 1
													_this.menudata2[i]['is_lock'] = 1
													_this.menudata2[i]['isDone'] = 0
													break;
												}
											}
										}
									}
								}
								// else{
								//增加加工数量-(新改需求，所有产品都需要加上加工数量)
								if (data.is_producing_done == 1) {
									_this.menudata2Sort[_this.menudata2SortIndex]['finish_quantities'] = _this.numAdd(_this.menudata2Sort[_this.menudata2SortIndex]['finish_quantities'], item.customer_buying_quantity)
								} else {
									_this.menudata2Sort[_this.menudata2SortIndex]['finish_quantities'] = _this.numSub(_this.menudata2Sort[_this.menudata2SortIndex]['finish_quantities'], item.customer_buying_quantity)
								}
								//修改原数组的值
								for (var i in _this.menudata2) {
									if (_this.menudata2[i]['product_id'] == _this.menudata2Sort[_this.menudata2SortIndex].product_id) {
										_this.menudata2[i].finish_quantities = _this.menudata2Sort[_this.menudata2SortIndex]['finish_quantities']
										break;
									}
								}
								// }
								//如果当前产品的所有规格的加工明细都加工完，则需要将该产品状态变为绿色
								if (res.result.is_product_all_done == 1) {
									_this.menudata2Sort[_this.menudata2SortIndex]['status'] = 3
									_this.menudata2Sort[_this.menudata2SortIndex]['is_lock'] = 0
									_this.menudata2Sort[_this.menudata2SortIndex]['isDone'] = 1
									//修改原数组的值
									for (var i in _this.menudata2) {
										if (_this.menudata2[i]['product_id'] == _this.menudata2Sort[_this.menudata2SortIndex].product_id) {
											_this.menudata2[i]['status'] = 3
											_this.menudata2[i]['is_lock'] = 0
											_this.menudata2[i]['isDone'] = 1
											break;
										}
									}
								}
								//如果产品状态为已处理完成，还原时将原状态还原
								if (data.is_producing_done == 0 && _this.menudata2Sort[_this.menudata2SortIndex]['status'] == 3) {
									_this.menudata2Sort[_this.menudata2SortIndex]['status'] = 1
									_this.menudata2Sort[_this.menudata2SortIndex]['is_lock'] = 1
									_this.menudata2Sort[_this.menudata2SortIndex]['isDone'] = 0
									//修改原数组的值
									for (var i in _this.menudata2) {
										if (_this.menudata2[i]['product_id'] == _this.menudata2Sort[_this.menudata2SortIndex].product_id) {
											_this.menudata2[i]['status'] = 1
											_this.menudata2[i]['is_lock'] = 1
											_this.menudata2[i]['isDone'] = 0
											break;
										}
									}
								}
							}
						} else {
							_this.popBox(res.message)
							return
						}
					});
				},
				//判断当前是否还有其他锁定产品
				isHasProduct(){
					var is_has_product=0//0-没有 1-有正在加工的其他产品
					for(var i in this.menudataTwoCate){
						if(this.menudataTwoCate[i]['status'] == 1){
							is_has_product=1
							break;
						}
					}
					return is_has_product
				},
				//显示加工数量日志
				showOperateQuantityLog(item,index){
					this.isShowOperateQuantityLog=true
					this.operateQuantityLogIndex=index
					this.total=item.new_customer_buying_quantity
					var data = {
						"oppd_id":item.id
					}
					console.log('加工数量日志参数----', data)
					var _this = this
					_this.isLoading=true
					_this.operateQuantityLog=[]
					getData("{:url('/product/processQuantityLog')}", data, function (res) {
						_this.isLoading=false
						console.log('加工数量日志结果----', res)
						_this.operateQuantityLog = res.result.data
						_this.oqlActionType = res.result.action_type
						//默认选中当前用户的操作数量，如果没有值，则给默认用户赋值
						var index = -1
						for(var i in _this.operateQuantityLog){
							if(_this.operateQuantityLog[i].is_current_user == 1){
								index = i
								break;
							}
						}
						_this.$nextTick(()=> {
							//如果当前登录用户存在，则默认选中并赋值
							if(index >= 0){
								$('.J_operatelog_item').eq(index).find('input').select()
								$('.J_operatelog_item').eq(index).siblings().find('input').remove
								var sum = _this.quantitySum()
								if(_this.total > sum){
									var main = _this.numSub(_this.total,sum)
									$('.J_operatelog_item').eq(index).find('input').val(main.toFixed(2))
									_this.operateQuantityLog[index].quantity = main;
									_this.quantitySum()
								}
							}else{
								_this.quantitySum()
							}
							//不是操作员没有权限更改操作日志
							if(_this.handleListSort[_this.operateQuantityLogIndex]['operator_user_id'] != _this.userInfo[0].user_id){
								for(var i in _this.operateQuantityLog){
									$('.J_operatelog_item').eq(i).find('input').attr('disabled',"true");
								}
								//并去掉提交按钮
								$('.J_quantity_submit').hide()
							}else{
								if($('.J_operatelog_item').eq(0).find('input').prop("disabled") == true){
									for(var i in _this.operateQuantityLog){
										$('.J_operatelog_item').eq(i).find('input').removeAttr("disabled")
									}
								}
								$('.J_quantity_submit').show()
							}
						})
					})
				},
				//获取所有输入的值,并将加工记录存入数据库
				saveOperatorQuantityLog() {
					//不是操作员没有权限更改操作日志
					if(this.handleListSort[this.operateQuantityLogIndex]['operator_user_id'] != this.userInfo[0].user_id){
						this.popBox('Only the processed person can update the info.')
						return
					}
					var data = {
						"oppd_id" : this.handleListSort[this.operateQuantityLogIndex].id,
						"data" : []
					}
					for (var i = 0; i < this.operateQuantityLog.length;i++) {
						var res = this.operateQuantityLog[i].quantity;
						if(res > 0){
							data.data.push({
								"user_id":this.operateQuantityLog[i].user_id,
								"num":res
							});
						}
					}
					console.log('保存操作原加工数量日志参数----',data);
					var _this=this
					_this.isLoading=true
					getData("{:url('/product/addProcessQuantityLog')}", data, function (res) {
						_this.isLoading=false
						console.log('保存操作原加工数量日志参数结果----', res)
						_this.isShowOperateQuantityLog=false
					})
				},
				handle(index){  // 点击已处理
					this.currentHandlePop=index
				},
				Popreturn(index){
					this.lastTime = new Date().getTime();//记录最后一次点击时间
					this.currentHandlePop=-1
				},
				//切换一级类目
				clickGoods(item,index){
					clearTimeout(this.clickTimer);  //首先清除计时器
					this.clickTimer = setTimeout(() => {
						this.isLoading=true
						this.product_id = item.product_id
						this.guige1_id = ''
						this.menudata2SortIndex=index
						this.menudataTwoCateIndex = 0
						//通排序基本数据同步索引
						this.menudata2Sync(1)
						//重置加工明细排序信息-start
						this.wccSort=0
						this.wccSortType=1
						//重置加工明细排序信息-end
						//获取二级类目
						this.twoCateGoods(item.product_id)
						//如果没有二级类目，则直接获取订单
						if(item.is_has_two_cate == 2){
							//获取一级类目对应的订单
							this.productOrder(item.product_id)
						}
					}, 300);   //大概时间300ms
				},
				//切换二级类目
				clickGoodsTwoCate(item,index){
					clearTimeout(this.clickTimer);  //首先清除计时器
					this.clickTimer = setTimeout(() => {
						this.isLoading=true
						//记录当前点击的产品键值
						this.menudataTwoCateIndex=index
						this.guige1_id = item.guige1_id
						//重置加工明细排序信息-start
						this.wccSort=0
						this.wccSortType=1
						//重置加工明细排序信息-end
						//获取二级类目对应的订单
						this.productOrder(item.product_id,this.guige1_id)
						this.isLoading=false
					}, 300);   //大概时间300ms
				},
				//弹出修改数量框
				popQuantityBox(item,index,goods_cate){
					if(goods_cate == 1){
						if(this.menudata2SortIndex!=index){
							return
						}
						if(item.is_has_two_cate==1){
							//如果该产品只有一个规格，点击产品时，默认锁定第一个规格；
							if(this.menudataTwoCate.length==1){
								item=this.menudataTwoCate[0]
								index=0
								goods_cate=2
							}
							if(this.menudataTwoCate.length>1){
								this.popBox('Please select a specification')
								return
							}
						}
					}else{
						if(this.menudataTwoCateIndex!=index){
							return
						}
					}
					if(item.status == 1 || item.status == 2 || item.status == 3){
						this.popBox('Processed products cannot be modified')
						return
					}
					//初始化预加工数量
					this.oldQuantity = item.sum_quantities
					this.quantity = item.sum_quantities
					this.isQuantityShow=true
				},
				//关闭数量框
				closeQuantity(){
					this.isQuantityShow=false
					this.quantity=0
					this.oldQuantity=0
				},
				//添加/修改加工数量
				saveQuantity(){
					if(this.menudata2Sort[this.menudata2SortIndex].is_has_two_cate == 2){
						if(this.menudata2Sort[this.menudata2SortIndex].status == 4){
							action_type = 1
						}else{
							action_type = 2
						}
					}else{
						if(this.menudataTwoCate[this.menudataTwoCateIndex].status == 4){
							action_type = 1
						}else{
							action_type = 2
						}
					}
					var data = {
						"logistic_delivery_date":this.logistic_delivery_date,
						"product_id":this.product_id,
						"guige1_id":this.guige1_id,
						"quantity":this.quantity,
						"action_type":action_type
					}
					console.log('保存加工数量参数----',data)
					var _this=this
					_this.isLoading = true
					getData("{:url('/product/addOrderProductPlaning')}", data, function (res) {
						console.log('保存加工数量结果----', res)
						_this.isLoading = false
						if (res.status == 200) {
							//1.添加成功后，判断该产品是否有二级分类
							var is_has_two_cate = _this.menudata2Sort[_this.menudata2SortIndex]['is_has_two_cate'];
							//1-1.如果有分类，修改当前二级分类的数据
							if(is_has_two_cate == 1){
								_this.menudataTwoCate[_this.menudataTwoCateIndex]['sum_quantities'] = _this.quantity
								var two_cate_statue = _this.menudataTwoCate[_this.menudataTwoCateIndex]['status']
								if(two_cate_statue == 4) {
									_this.menudataTwoCate[_this.menudataTwoCateIndex]['status'] = 0
									_this.menudataTwoCate[_this.menudataTwoCateIndex]['operator_user_id'] = 0
									_this.menudataTwoCate[_this.menudataTwoCateIndex]['isDone'] = 0
								}else{
									if(_this.quantity == 0){
										_this.menudataTwoCate[_this.menudataTwoCateIndex]['status'] = 4
										_this.menudataTwoCate[_this.menudataTwoCateIndex]['operator_user_id'] = -1
										_this.menudataTwoCate[_this.menudataTwoCateIndex]['isDone'] = -1
									}
								}
							}
							//1-2.修改以及产品的数据
							var sum_quantity = _this.menudata2Sort[_this.menudata2SortIndex]['sum_quantities']
							var status = _this.menudata2Sort[_this.menudata2SortIndex]['status']
							var main_quantity = _this.numSub(sum_quantity,_this.oldQuantity)
							var new_sum_quantity = _this.numAdd(main_quantity,_this.quantity)
							_this.menudata2Sort[_this.menudata2SortIndex]['sum_quantities'] = new_sum_quantity
							//判断加工状态 0-未加工 1-自己正在加工 2-其他人正在加工 3-加工完成 4-待分配
							if(status == 4){
								_this.menudata2Sort[_this.menudata2SortIndex]['status'] = 0
								_this.menudata2Sort[_this.menudata2SortIndex]['operator_user_id'] = 0
								_this.menudata2Sort[_this.menudata2SortIndex]['isDone'] = 0
							}else{
								if(_this.quantity == 0){
									_this.menudata2Sort[_this.menudata2SortIndex]['status'] = 4
									_this.menudata2Sort[_this.menudata2SortIndex]['operator_user_id'] = -1
									_this.menudata2Sort[_this.menudata2SortIndex]['isDone'] = -1
								}
							}
							for(var i in _this.menudata2){
								if(_this.menudata2[i]['product_id'] == _this.menudata2Sort[_this.menudata2SortIndex]['product_id']){
									_this.menudata2[i]['sum_quantities'] = new_sum_quantity
									_this.menudata2[i]['status'] = _this.menudata2Sort[_this.menudata2SortIndex]['status']
									_this.menudata2[i]['operator_user_id'] = _this.menudata2Sort[_this.menudata2SortIndex]['operator_user_id']
									_this.menudata2[i]['isDone'] = _this.menudata2Sort[_this.menudata2SortIndex]['isDone']
								}
							}
							//获取订单数据
							if(_this.handleListSort.length==0){
								_this.productOrder(_this.product_id,_this.guige1_id)
							} else {
								//修改加工明细单加工数量
								_this.handleListSort[0]['customer_buying_quantity'] = _this.quantity
								_this.handleListSort[0]['new_customer_buying_quantity'] = _this.quantity
								_this.handleList[0]['customer_buying_quantity'] = _this.quantity
								_this.handleList[0]['new_customer_buying_quantity'] = _this.quantity
							}
							if(res.result.operator_sum_order_inc_num == -1){
								_this.handleListSort = _this.handleList = []
							}
							//修操作员对应的订单数量
							_this.operatorOrderNum = _this.numAdd(_this.operatorOrderNum, res.result.operator_sum_order_inc_num)
							//修改总订单数
							_this.orderNum = _this.numAdd(_this.orderNum, res.result.order_sum_inc_num)
							//关闭加工数量弹层
							_this.isQuantityShow=false
						} else {
							_this.popBox(res.message)
						}
					})
				},
				tab(index){
					this.isLoading=true
					this.lastTime = new Date().getTime();//记录最后一次点击时间
					this.currentHandlePop=-1
					//将产品加工明细进行排序
					this.handleListSort=JSON.parse(JSON.stringify(this.handleList));
					if(this.wccSort != index){
						this.wccSortType = 1
					}else{
						if(this.wccSortType == 1){
							this.wccSortType = 2
						}else{
							this.wccSortType = 1
						}
					}
					this.wccSort=index
					switch(index){
						case 0:
							var sort_type = this.wccSortType
							this.sortData(this.handleListSort,'logistic_sequence_No',sort_type);
							break;
						case 1:
							var sort_type = this.wccSortType
							this.sortData(this.handleListSort,'is_producing_done',sort_type);
							break;
						case 2:
							var sort_type = this.wccSortType==1?2:1
							this.sortData(this.handleListSort,'is_producing_done',sort_type);
							break;
					}
					this.isLoading=false
				},
				//对数据进行排序
				//data:需要排序的数组 sort_field:排序字段  sort_type:排序方式 1升序 2降序
				sortData(data,sort_field,sort_type,sort_field2=''){
					return data.sort(
						function(a, b) {
							var value1 = a[sort_field]
							var value2 = b[sort_field]
							// console.log(value1,value2)
							if($.type(value1) == 'number'){
								if(sort_field2){
									if(value1 == value2) return a[sort_field2]-b[sort_field2]
								}
								if (sort_type == 1) {
									return value1 - value2
								} else {
									return value2 - value1
								}
							} else {
								if (sort_type == 1) {
									if(value1 < value2) return -1;
									if(value1 > value2) return 1;
									return 0;
								} else {
									if(value1 < value2) return 1;
									if(value1 > value2) return -1;
									return 0;
								}
							}
						}
					);
				},
				//在另一个数组的基础上排序，保证新数组的排序与原数组保持一致
				sortAccordingOtherData(newData,oldData,sort_field){
					//存储排序字段
					var sortOldData = []
					for(var i in oldData){
						sortOldData.push(oldData[i][sort_field]);
					}
					newData.sort((a,b)=>{
						var value1 = a[sort_field]
						var value2 = b[sort_field]
						return sortOldData.indexOf(value1)-sortOldData.indexOf(value2);
					});
					return newData
				},
				//修改购买数量
				editQuantity(item,index,addType,e){
					if(item.is_lock!=1){
						this.popBox('Please lock the product')
						return
					}
					if(item.lock_type!=1){
						this.popBox('Product has been locked by someone else')
						return
					}
					//如果该订单已加工完成，则没有权限操作
					if(item.is_producing_done==1){
						this.popBox('Inoperable completed')
						return
					}
					e.currentTarget.parentElement.children.item(1).focus()
					console.log(index,this.handleListSort[index])
					var customer_buying_quantity = this.handleListSort[index].new_customer_buying_quantity
					if(addType == '+'){
						this.handleListSort[index].new_customer_buying_quantity=this.numAdd(customer_buying_quantity,0.1)
					}else if(addType == '-'){
						this.handleListSort[index].new_customer_buying_quantity=this.numSub(customer_buying_quantity,0.1)
					}else if(addType == 'enter'){
						this.handleListSort[index].new_customer_buying_quantity=e.target.value
					}
					var data={
						"id":item.id,
						"new_customer_buying_quantity":this.handleListSort[index].new_customer_buying_quantity
					}
					console.log('修改加工数量参数----',data)
					var _this=this
					_this.isLoading=true
					getData("{:url('/product/prepEditBuyingQuantity')}", data, function (res) {
						console.log('修改加工数量结果----',res)
						_this.isLoading=false
						if (res.status == 200) {
							_this.handleListSort[index].new_customer_buying_quantity=_this.handleListSort[index].new_customer_buying_quantity
							//修改原数组的值
							for(var i in _this.handleList){
								if(_this.handleList[i]['id'] == _this.handleListSort[index].id){
									_this.handleList[i].new_customer_buying_quantity=_this.handleListSort[index].new_customer_buying_quantity
									break;
								}
							}
						} else {
							_this.popBox(res.message)
							_this.handleList[index].new_customer_buying_quantity=customer_buying_quantity
							_this.handleListSort[index].new_customer_buying_quantity=customer_buying_quantity
							return
						}
					});
				},
				//修改打印标签
				printLable(item,index,addType,e){
					if(item.is_producing_done == 0 && item.is_lock!=1){
						this.popBox('Please lock the product')
						return
					}
					if(item.is_producing_done == 0 && item.lock_type!=1){
						this.popBox('Product has been locked by someone else')
						return
					}
					//如果该订单已加工完成，则没有权限操作
					// if(item.is_producing_done==1){
					// 	this.popBox('Inoperable completed')
					// 	return
					// }
					e.currentTarget.parentElement.children.item(1).focus()
					if(addType == '+'){
						this.handleListSort[index].num1++
					}else if(addType == '-'){
						this.handleListSort[index].num1--
					}else if(addType == 'enter'){
						this.handleListSort[index].num1=e.target.value
					}
				},
				//打印
				print(item,index){
					if(item.is_producing_done == 0 && item.is_lock!=1){
						this.popBox('Please lock the product')
						return
					}
					if(item.is_producing_done == 0 && item.lock_type!=1){
						this.popBox('Product has been locked by someone else')
						return
					}
					//如果该订单已加工完成，则没有权限操作
					// if(item.is_producing_done==1){
					// 	this.popBox('Inoperable completed')
					// 	return
					// }
					//跳转到打印标签页,item-订单信息 item.num1-打印数量
					if(this.menudata2Sort[this.menudata2SortIndex]['is_has_two_cate'] == 1){
						preview(item,item.num1,this.menudata2Sort[this.menudata2SortIndex],this.menudataTwoCate[this.menudataTwoCateIndex],this.businessName,this.userName)
					}else{
						preview(item,item.num1,this.menudata2Sort[this.menudata2SortIndex],[],this.businessName,this.userName)
					}
				},
				numSub(arg1,arg2){
				    var r1,r2,m;
				    try{r1=arg1.toString().split(".")[1].length}catch(e){r1=0}
				    try{r2=arg2.toString().split(".")[1].length}catch(e){r2=0}
				    m=Math.pow(10,Math.max(r1,r2))
				    return (arg1*m-arg2*m)/m;
				},
				numAdd(arg1, arg2) {
				    var r1, r2, m;
				    try { r1 = arg1.toString().split(".")[1].length; } catch (e) { r1 = 0; }
				    try { r2 = arg2.toString().split(".")[1].length; } catch (e) { r2 = 0; }
				    m = Math.pow(10, Math.max(r1, r2));
				    return (arg1 * m + arg2 * m) / m;
				},
				//切换加工类型
				choseProductType(item,index){
					this.currentProductTypeIndex=index
					this.whichPopShow=-1
					//如果是客户订单类型，跳转到客户订单页面
					if(index==1){
						window.location.href="{:url('/product/index')}"
					}
				},
				//选择操作类型
				choseActionType(item,index){
					this.currentManageActionTypeIndex = index
					this.whichPopShow=-1
				},
				//切换日期
				choseDay(item,index){
					this.choseDate1=item
					this.currentDay=index
					this.whichPopShow=-1
					this.logistic_delivery_date=item.logistic_delivery_date
					//存储当前日期
					localStorage.logistic_delivery_date=this.logistic_delivery_date
					//重置客户默认信息-start
					this.choseDate2=this.list2[0].name
					this.current2=0
					//重置客户默认信息-end
					//重置操作员默认信息-start
					this.currentOperatorIndex=0
					this.operator_user_id=this.list4[this.currentOperatorIndex]['user_id']
					//重置操作员默认信息-end
					//重置司机默认信息-start
					this.choseDate3=this.list3[0].name
					this.current3=0
					this.logistic_truck_No=''
					//重置司机默认信息-end
					//重置产品默认信息-start
					this.currentContent=0
					this.product_id=0
					this.guige1_id=''
					//重置产品默认信息-end
					//重置加工明细排序信息-start
					this.wccSort=0
					this.wccSortType=1
					//重置加工明细排序信息-end
					this.isLoading=true
					this.inidata()
					if(this.currentPage==2){
						var cate_id = this.menudata[this.currentMenu].id
						this.cetegoryProduct(cate_id)
					}
					this.isLoading=false
				},
				choseCus(item,index){
					this.choseDate2=item.name
					this.current2=index
					this.whichPopShow=-1
					//重置操作员默认信息-start
					this.currentOperatorIndex=0
					this.operator_user_id=this.list4[this.currentOperatorIndex]['user_id']
					//重置操作员默认信息-end
					//重置司机默认信息-start
					this.choseDate3=this.list3[0].name
					this.current3=0
					this.logistic_truck_No=''
					//重置司机默认信息-end
					//重置产品默认信息-start
					this.currentContent=0
					this.product_id=0
					this.guige1_id=''
					//重置产品默认信息-end
					//重置加工明细排序信息-start
					this.wccSort=0
					this.wccSortType=1
					//重置加工明细排序信息-end
					this.isLoading=true
					this.inidata()
					if(this.currentPage==2){
						var cate_id = this.menudata[this.currentMenu].id
						this.cetegoryProduct(cate_id)
					}
					this.isLoading=false
				},
				//切换操作员
				choseOperator(item,index){
					this.currentOperatorIndex=index
					this.whichPopShow=-1
					this.operator_user_id=item.user_id
					//重置产品默认信息-start
					this.currentContent=0
					this.product_id=0
					this.guige1_id=''
					//重置产品默认信息-end
					//重置加工明细排序信息-start
					this.wccSort=0
					this.wccSortType=1
					//重置加工明细排序信息-end
					this.isLoading=true
					this.inidata()
					if(this.currentPage==2){
						var cate_id = this.menudata[this.currentMenu].id
						this.cetegoryProduct(cate_id)
					}
					this.isLoading=false
				},
				closePop(){
					this.whichPopShow=-1
				},
				chose(index){
					this.lastTime = new Date().getTime();//记录最后一次点击时间
					this.whichPopShow=index
					//获取客户数据
					if(index==2){
						var _this=this
						getData("{:url('/product/customer')}", '', function (res) {
							_this.list2 = [{"id":"","name":"All customers"}]
							_this.list2 = _this.list2.concat(res.result.all_customers)
						});
					}
					//获取操作员数据
					if(index==4){
						var _this=this
						var data = {
							'logistic_delivery_date':_this.logistic_delivery_date
						}
						getData("{:url('/product/operator')}", data , function (res) {
							if(_this.isManager == 1){
								_this.list4 = [{"user_id":"","user_name":"All Operator"}]
								_this.list4 = _this.list4.concat(res.result.all_operator)
							}else{
								_this.list4 = res.result.all_operator
							}
						});
					}
				},
				//index-1:返回首页 2:返回类目页
 				returnPage(index){
					this.currentPage=index
					//返回首页时，将默认获取第一个分类的信息
					this.currentMenu=0
					if(index == 1){
						this.inidata()
					}
					if(index == 2) {
						//获取大类
						var _this = this
						getData("{:url('/product/category')}", '', function (res) {
							res.result.unshift({"id": -1, "category_en_name": "Current Plan"}, {
								"id": 0,
								"category_en_name": "Top"
							})
							_this.menudata = res.result
							console.log('获取产品大类目---', _this.menudata)
							//获取默认的展示产品
							_this.cetegoryProduct(_this.menudata[0]['id']);
						});
					}
				},
				//切换分类
				clickMenu(item,index){
					this.isHasCateData = false
					this.currentMenu=index
					this.cetegoryProduct(item.id);
					for(var i in this.menudata2Sort){
						if(this.menudata2Sort[i]['cate_id'] == item.id){
							this.isHasCateData = true
							break;
						}
					}
				},
				//获取对应类别的产品
				cetegoryProduct(cate_id){
					// this.goods = []
					//调取获取当前备货接口
					var data = {
						"logistic_delivery_date":this.logistic_delivery_date,
						"operator_user_id":this.operator_user_id,
						"category_id":cate_id
					}
					console.log('获取大类产品参数----',data)
					switch(cate_id){
						case -1:
							var url = "{:url('/product/prepCurrentStockProduct')}"
							break;
						case 0:
							var url = "{:url('/product/topProduct')}"
							break;
						default:
							var url = "{:url('/product/categoryProduct')}"
					}
					var _this=this
					getData(url, data, function (res) {
						console.log('获取大类产品----',res)
						_this.goods = res.result
					});
				},
				//类目页面跳转到加工页面对应的产品位置  type-1:当前备货页面点击跳转+定位 2：返回此分类点击跳转+定位
				goto(item,index,selector,type=1){
					clearTimeout(this.clickTimer);  //首先清除计时器
					this.clickTimer = setTimeout(() => {
						this.currentPage=1
						if(type == 1){
							//并将该产品改为选中状态,获取该产品的索引值,如果当前选中产品不一致，则修改选中产品
							var index = $(selector).index()
							if(this.menudata2SortIndex != index){
								this.clickGoods(this.menudata2Sort[index],index)
							}
						}
						//分类跳转到首页，需要将排序改为code
						if(type == 2){
							// alert(selector)
							this.isHandle=2
							this.inidata()
						}
						this.$nextTick(()=> {
							var h = $(selector).offset().top-$(selector).height()-150
							console.log('计算出滚动的高度---',$(selector).offset().top,$(selector).height())
							$(".J_left_menu_1").animate({scrollTop:h},1000)
						})
					}, 300);   //大概时间300ms
				},
				//排序基础数据的同步
				menudata2Sync(type){
					switch (type) {
						case 1://当前选中的索引值
							for(var i in this.menudata2){
								if(this.menudata2[i]['product_id'] == this.menudata2Sort[this.menudata2SortIndex]['product_id']){
									this.currentContent=i
									break;
								}
							}
							break;
					}
				},
				clickHandle(){
					if(this.isHandle==2){
						this.isHandle=0
					}else{
						this.isHandle=this.isHandle+1
					}
					//未进行排序前当前选中的产品id
					var product_id = this.menudata2Sort[this.menudata2SortIndex].product_id
					//将产品进行排序
					this.menudata2Sort=JSON.parse(JSON.stringify(this.menudata2))
					console.log('产品排序---',this.isHandle);
					switch(this.isHandle){
						case 0:this.sortData(this.menudata2Sort,'isDone',1,'menu_id');break;
						case 1:this.sortData(this.menudata2Sort,'isDone',2,'menu_id');break;
						case 2:this.sortData(this.menudata2Sort,'menu_id',1);break;
					}
					//默认选中索引值归0
					// this.menudata2SortIndex=0
					// this.menudataTwoCateIndex=0
					//排序之后-动态改变当前选中的索引id值
					for (var i in this.menudata2Sort) {
						if(this.menudata2Sort[i].product_id == product_id){
							this.menudata2SortIndex = i
							break;
						}
					}
					for (var i in this.menudata2) {
						if(this.menudata2[i].product_id == product_id){
							this.currentContent = i
							break;
						}
					}
					//获取默认显示的二级类目
					// this.twoCateGoods(this.menudata2Sort[0].product_id)
				},
				//设置或取消置顶
				cancelZD(item,index,action_type,source=''){
					var data = {
						"product_id":item.product_id,
						"action_type":action_type
					}
					var _this=this
					getData("{:url('/product/setTopProduct')}", data, function (res) {
						if(res.status == 200){
							if(action_type == 1){
								_this.goods[index]['is_set_top'] = 1
							}else{
								_this.goods[index]['is_set_top'] = 0;
							}
							if(source=='top'&&action_type==2){
								$('.J_set_top').eq(index).remove();
							}
						}else{
							_this.popBox(res.message)
							return
						}
					});
				},
				selectProductPlaning(item,index,action_type=1,e){
					clearTimeout(this.clickTimer);  //首先清除计时器
					if(action_type == 2){
						if(item.status != 4){
							this.popBox('Cannot be deleted')
							return
						}
						swal({
							title: "Are you sure you want to delete?",
							icon: "warning",
							buttons: true,
							dangerMode: true,
						})
						.then((willDelete) => {
							if (willDelete) {
								this.setProductPlaningFun(item,index,action_type,e)
							}
						});
					}else{
						this.setProductPlaningFun(item,index,action_type,e)
					}
				},
				setProductPlaningFun(item,index,action_type,e){
					var data = {
						"logistic_delivery_date":this.logistic_delivery_date,
						"product_id":item.product_id,
						"action_type":action_type
					}
					console.log('添加与加工产品参数---',data)
					var _this=this
					getData("{:url('/product/setProductPlaning')}", data, function (res) {
						console.log('添加与加工产品结果---',res)
						_this.popBox(res.message)
						if(res.status == 200){
							_this.inidata()
							if(action_type == 2){
								if($(e.target).parents('.J_current_panel_item').siblings().length==0){
									$(e.target).parents('.J_current_panel').remove()
								}else{
									$(e.target).parents('.J_current_panel_item').remove()
								}
							}
						}
						return
					});
				},
				//关闭日志弹窗
				closeLog(){
					this.isShowLog=false
					this.isShowOperateQuantityLog=false
				},
				//弹出日志信息
				log(item,index){
					this.isShowLog=true
					var data = {
						"logistic_delivery_date":this.logistic_delivery_date,
						"product_id":item.product_id,
						"guige1_id":item.guige1_id,
						"oppd_id":item.id
					}
					console.log('获取日志参数---',data)
					var _this=this
					getData("{:url('/product/prepLogData')}", data, function (res) {
						console.log('获取日志结果---',res)
						if(res.status == 200){
							_this.logData = res.result
						}else{
							_this.popBox(res.message)
						}
					});
				},
				//光标移入div样式
				focusData(e,type,pincodeType){
					e.target.setAttribute('placeholder','')
					this.focusDatype = type
					this.pincodeType = pincodeType
				},
				//点击pincode键盘，显示输入pincode
				clickNum(number){
					this.lastTime = new Date().getTime();//记录最后一次点击时间
					switch(this.focusDatype){
						case 10:
							if(this.psd.length<4){
								this.psd+=number
								this.psd2 += new String('*',this.psd.length);
							}
							break;
						case 20:
							if(this.npsd.length<4){
								this.npsd+=number
								this.npsd2 += new String('*',this.npsd.length);
							}
							break;
						case 30:
							if(this.nrpsd.length<4){
								this.nrpsd+=number
								this.nrpsd2 += new String('*',this.nrpsd.length);
							}
							console.log(this.nrpsd,this.nrpsd.length);
							break;
					}
					//如果输入数字长度为4，可直接登录
					switch(this.pincodeType){
						case 1:
							if(this.psd.length==4){
								this.save()
							}
							break;
						case 2:
							break;
						case 3:
							break;
					}
				},
				//上锁，则退出登录
				popKeyboard(){
					this.iskeyboardShow=true
					this.isClock = true
					this.psd=this.psd2=this.npsd=this.npsd2=this.nrpsd=this.nrpsd2=''
					this.message=''
					this.editText='setting'
					//退出pincode登录
					this.loginOutPincode()
				},
				//关闭keyboard
				closeKeyboard(){
					if(!this.isClock){
						this.iskeyboardShow=false
					}
				},
				//弹出修改pincode
				editPincode(){
					this.lastTime = new Date().getTime();//记录最后一次点击时间
					this.isShowTypePincode1=!this.isShowTypePincode1
					this.isShowTypePincode3=!this.isShowTypePincode3
					if(this.isShowTypePincode1){
						this.pincodeType = 1
						this.focusDatype=10
						this.psd=this.psd2=this.npsd=this.npsd2=this.nrpsd=this.nrpsd2=''
						this.editText='setting'
					}
					if(this.isShowTypePincode3){
						this.pincodeType = 3
						this.focusDatype=''
						this.psd=this.psd2=''
						this.editText='Back'
					}
					this.message=''
					this.isPsdCorrect=false
				},
				//pincode登录
				save(){
					this.lastTime = new Date().getTime();//记录最后一次点击时间
					var _this = this
					if (_this.isDisable) {
						return
					}
					var data = {};
					var url = '';
					console.log(_this.pincodeType);
					switch(_this.pincodeType){
						case 1:
							if (_this.psd==''||_this.psd==null) {
								this.isPsdCorrect=true
								this.message='Please input pincode'
								return
							}
							data = {
								pincode: _this.psd,
							}
							url = "{:url('/product/loginByPincode')}"
							break;
						case 2:
							if (_this.npsd==''||_this.npsd==null) {
								this.isPsdCorrect=true
								this.message='Please input New pincode'
								$('.J_n_pincode').attr('placeholder',_this.placeholderNPincode);
								$('.J_nr_pincode').attr('placeholder',_this.placeholderNRPincode);
								return
							}
							if (_this.nrpsd==''||_this.nrpsd==null) {
								this.isPsdCorrect=true
								this.message='Please input Re-enter pincode'
								$('.J_n_pincode').attr('placeholder',_this.placeholderNPincode);
								$('.J_nr_pincode').attr('placeholder',_this.placeholderNRPincode);
								return
							}
							if(_this.npsd.length!=4||_this.nrpsd.length!=4){
								this.isPsdCorrect=true
								this.message='Please enter a 4-digit code'
								this.npsd=this.nrpsd=this.npsd2=this.nrpsd2=''
								$('.J_n_pincode').attr('placeholder',_this.placeholderNPincode);
								$('.J_nr_pincode').attr('placeholder',_this.placeholderNRPincode);
								return
							}
							data = {
								new_pincode: _this.npsd,
								sure_pincode: _this.nrpsd,
							}
							url = "{:url('/product/setPincode')}"
							break;
						case 3:
							if (_this.psd==''||_this.psd==null) {
								this.isPsdCorrect=true
								this.message='Please input Old pincode'
								$('.J_o_pincode').attr('placeholder',_this.placeholderOPincode);
								return
							}
							if (_this.npsd==''||_this.npsd==null) {
								this.isPsdCorrect=true
								this.message='Please input New pincode'
								$('.J_n_pincode').attr('placeholder',_this.placeholderNPincode);
								$('.J_nr_pincode').attr('placeholder',_this.placeholderNRPincode);
								return
							}
							if (_this.nrpsd==''||_this.nrpsd==null) {
								this.isPsdCorrect=true
								this.message='Please input Re-enter pincode'
								$('.J_n_pincode').attr('placeholder',_this.placeholderNPincode);
								$('.J_nr_pincode').attr('placeholder',_this.placeholderNRPincode);
								return
							}
							if(_this.npsd.length!=4||_this.nrpsd.length!=4){
								this.isPsdCorrect=true
								this.message='Please enter a 4-digit code'
								this.npsd=this.nrpsd=this.npsd2=this.nrpsd2=''
								$('.J_n_pincode').attr('placeholder',_this.placeholderNPincode);
								$('.J_nr_pincode').attr('placeholder',_this.placeholderNRPincode);
								return
							}
							data = {
								pincode: _this.psd,
								new_pincode: _this.npsd,
								sure_pincode: _this.nrpsd,
							}
							url = "{:url('/product/editPincode')}"
							break;
					}
					_this.isDisable = true
					console.log(url,data);
					getData(url, data, function (res) {
						console.log(res);
						_this.isDisable = false
						if(res.status == 200){
							_this.userInfo = res.result.user_info
							if (res.result.user_name) {
								_this.userName = res.result.user_name
								_this.businessName = res.result.business_name
							}
							//管理员登录默认进入二级页面(需要再放开)
							//如果当前登录账号的权限和上一个账号权限不一致，则重置操作员信息
							if(res.result.is_manager!=_this.isManager && res.result.is_manager==1){
								_this.list4=[{"user_id":"","user_name":"All Operator"}]
								_this.currentOperatorIndex=0
								_this.operator_user_id=""
							}
							_this.isManager = res.result.is_manager
							//重置操作员默认信息-start(如果是操作员，操作员列表只有当前用户)
							if(_this.isManager==2){
								_this.currentManageActionTypeIndex = 0
								_this.list4 = res.result.user_info
								_this.currentOperatorIndex=0
								_this.operator_user_id = res.result.user_info[0]['user_id']
							}
							// if(res.result.is_manager == 1){
							// 	_this.currentPage = 2
							// 	_this.returnPage(2)
							// }
							//登录成功，隐藏密码框
							_this.iskeyboardShow=false
							_this.isClock=false
							//显示退出登录按钮
							_this.isShowLoginOut = true
							//还原默认显示pincode登录
							_this.isShowTypePincode1 = true
							_this.isShowTypePincode2 = _this.isShowTypePincode3 = false
							_this.pincodeType = 1 //默认显示pincode登录
							_this.focusDatype = 10 //默认可直接输入密码
							//清除定时任务
							_this.clearTime()
							_this.isLoading = false
							//重置操作员默认信息-end
							_this.inidata(_this.logistic_delivery_date)
						} else {
							_this.message = res.message
							_this.isPsdCorrect=true
							switch(res.status){
								case 104://pincode输入错误
									$('.J_pincode').attr('placeholder',_this.placeholderPincode);
									_this.psd=_this.psd2=''
									break;
								case 105://pincode错误次数过多，屏幕锁屏1分钟
									$('.J_pincode').attr('placeholder',_this.placeholderPincode);
									_this.psd=_this.psd2=''
									_this.isDisable = true
									_this.isClock = true
									_this.timeLock = 60
									_this.getTimeDown()
									break;
								case 106://pincode已存在
								case 108://pincode两次输入不一致
									$('.J_n_pincode').attr('placeholder',_this.placeholderNPincode);
									$('.J_nr_pincode').attr('placeholder',_this.placeholderNRPincode);
									_this.npsd=_this.npsd2=_this.nrpsd=_this.nrpsd2=''
									break;
								case 107://old pincode输入错误
									$('.J_o_pincode').attr('placeholder',_this.placeholderOPincode);
									_this.psd=_this.psd2=''
									break;
								default:
									$('.J_pincode').attr('placeholder',_this.placeholderPincode);
									_this.psd=_this.psd2=''
							}
						}
					});
				},
				//退出登录
				LogOut(){
					var _this = this
					if (_this.isDisable) {
						return
					}
					_this.isDisable = true
					getData("{:url('/product/loginOut')}", '', function (res) {
						window.location.href = "{:url('/product/login')}"
					})
				},
				//删除code
				deletePsd(){
					this.lastTime = new Date().getTime();//记录最后一次点击时间
					switch(this.focusDatype){
						case 10:
							this.psd=this.psd.substr(0, this.psd.length - 1);
							this.psd2=this.psd2.substr(0, this.psd2.length - 1);
							break;
						case 20:
							this.npsd=this.npsd.substr(0, this.npsd.length - 1);
							this.npsd2=this.npsd2.substr(0, this.npsd2.length - 1);
							break;
						case 30:
							this.nrpsd=this.nrpsd.substr(0, this.nrpsd.length - 1);
							this.nrpsd2=this.nrpsd2.substr(0, this.nrpsd2.length - 1);
							break;
					}
				},
				//倒计时
				getTimeDown(){
					if (!this.timer) {
						this.timer = setInterval(() => {
							if (this.timeLock > 0) {
								this.timeLock--;
							} else {
								this.isDisable = !this.isDisable
								this.timeLock = 0
								clearInterval(this.timer);
								this.timer = null;
							}
						}, 1000)
					}
				},
				//聚焦时，默认全部选中文本框
				focusEvent: function (e,source='') {
					e.currentTarget.select();
					if(source == 'operatelog'){
						//当获取焦点时，计算还剩余的加工的数量
						var sum = this.quantitySum()
						if(this.total > sum){
							var main = this.numSub(this.total,sum)
							$(e.target).val(main.toFixed(2))
							this.operateQuantityLog[$(e.target).parent().index()-1].quantity = main;
							this.quantitySum()
						}
					}
				},
				handleInput2(e,source='') {
					// 通过正则过滤小数点后两位
					// e.target.value = e.target.value.match(/\d+\.?\d{0,2}/)
					var obj = e.target
					obj.value = obj.value.replace(/[^\d.]/g, "");  //清除“数字”和“.”以外的字符
					obj.value = obj.value.replace(/\.{2,}/g, "."); //只保留第一个. 清除多余的
					obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
					obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3');//只能输入两个小数
					// //以上已经过滤，此处控制的是如果没有小数点，首位不能为类似于 01、02的金额
					// if (obj.value.indexOf(".") < 0 && obj.value != "") {
					// 	obj.value = parseFloat(obj.value);
					// }
					if(source == 'operatelog'){
						this.quantitySum()
					}

				},
				quantitySum(){
					var sum = 0
					for (var i = 0; i < this.operateQuantityLog.length;i++) {
						var res = this.operateQuantityLog[i].quantity;
						sum = this.numAdd(sum,res)
					}
					$('.J_fillInSum').text(sum)
					if(this.numSub(sum,this.total) == 0){
						$('.J_fillInSum').removeClass('colred').addClass('colgreen')
						$('.J_quantity_submit').removeClass('btn-primary-disable').addClass('btn-primary')
						$('.J_quantity_submit').removeAttr("disabled")
					}else{
						$('.J_fillInSum').removeClass('colgreen').addClass('colred')
						$('.J_quantity_submit').removeClass('btn-primary').addClass('btn-primary-disable')
						$('.J_quantity_submit').attr('disabled',"true");
					}
					return sum
				},
				handleInput(e) {
					e.target.value=e.target.value.replace(/[^\d]/g,'');
				},
				//弹层提示信息
				popBox(popMessage){
					this.isShowMessage=true
					this.popMessage=popMessage
					this.timeOutEvent = setTimeout(()=>{
						this.isShowMessage=false
						this.popMessage=''
						clearTimeout(this.timeOutEvent);//清除定时器
						this.timeOutEvent=null
					},2000);//这里设置定时器，定义长按2000毫秒触发长按事件
					return
				},
			},
			created(){
				this.lastTime = new Date().getTime();   //网页第一次打开时，记录当前时间
				this.dataRefreh();
			},
			destroyed(){
				// 在页面销毁后，清除计时器
				this.clear();
			}
		})
	</script>
</html>
